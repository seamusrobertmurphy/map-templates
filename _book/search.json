[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Terrain Mapping",
    "section": "",
    "text": "Preface\nThis book provides a series templates and guides for deriving standard operational maps. The sequence of chapters was designed for data stream efficiency: site context establishes area-of-interest geometry, watershed delineation derives flow structure, stream delineation extracts hydrological features, topographic analysis conditions elevation data and computes terrain metrics, climate mapping interpolates environmental surfaces, and demographic mapping contextualizes human populations. Each stage reuses outputs from prior chapters, minimizing reprocessing and enabling iterative refinement of area-of-interest boundaries, coordinate systems, and spatial resolution.",
    "crumbs": [
      "Preface"
    ]
  },
  {
    "objectID": "index.html#chapter-1-site-maps",
    "href": "index.html#chapter-1-site-maps",
    "title": "Terrain Mapping",
    "section": "Chapter 1: Site Maps",
    "text": "Chapter 1: Site Maps\nDefine area-of-interest (AOI), establish coordinate reference system (CRS), load boundary geometries, and create reference maps. All downstream chapters inherit AOI and CRS from this stage.",
    "crumbs": [
      "Preface"
    ]
  },
  {
    "objectID": "index.html#chapter-2-watershed-maps",
    "href": "index.html#chapter-2-watershed-maps",
    "title": "Terrain Mapping",
    "section": "Chapter 2: Watershed Maps",
    "text": "Chapter 2: Watershed Maps\nDownload and condition digital elevation models. Breach channels, fill depressions. Compute flow direction and accumulation. Delineate watershed boundaries. Validate against observed drainage patterns. Watershed boundaries define the fundamental geographic unit for all subsequent analysis.",
    "crumbs": [
      "Preface"
    ]
  },
  {
    "objectID": "index.html#chapter-3-riparian-maps",
    "href": "index.html#chapter-3-riparian-maps",
    "title": "Terrain Mapping",
    "section": "Chapter 3: Riparian Maps",
    "text": "Chapter 3: Riparian Maps\nExtract stream networks from flow accumulation surfaces. Delineate riparian zones and floodplain extent. Validate stream locations against hydrographic databases and field observations. Stream networks and riparian zones structure all operational mapping.",
    "crumbs": [
      "Preface"
    ]
  },
  {
    "objectID": "index.html#chapter-4-topography-maps",
    "href": "index.html#chapter-4-topography-maps",
    "title": "Terrain Mapping",
    "section": "Chapter 4: Topography Maps",
    "text": "Chapter 4: Topography Maps\nUse conditioned DEM from Chapter 2. Compute slope and aspect. Classify terrain. Generate hillshade and relief visualization. Topographic products describe landscape geometry essential to operations and analysis.",
    "crumbs": [
      "Preface"
    ]
  },
  {
    "objectID": "index.html#chapter-5-climate-maps",
    "href": "index.html#chapter-5-climate-maps",
    "title": "Terrain Mapping",
    "section": "Chapter 5: Climate Maps",
    "text": "Chapter 5: Climate Maps\nDownload weather station data. Temporally aggregate (daily, monthly, seasonal, annual). Spatially interpolate using kriging or inverse distance weighting. Generate temperature, precipitation, humidity, and wind surfaces. Climate data provide environmental context for operations.",
    "crumbs": [
      "Preface"
    ]
  },
  {
    "objectID": "index.html#chapter-6-population-maps",
    "href": "index.html#chapter-6-population-maps",
    "title": "Terrain Mapping",
    "section": "Chapter 6: Population Maps",
    "text": "Chapter 6: Population Maps\nDownload census and settlement data. Interpolate population density. Classify settlement, visualize demographic context. Population data situate operations within human geography.\n\nGallery",
    "crumbs": [
      "Preface"
    ]
  },
  {
    "objectID": "01-field-sites/index.html",
    "href": "01-field-sites/index.html",
    "title": "Field Sites",
    "section": "",
    "text": "1.0 Overview\nSite map templates to help field teams navigate a site, illustrating settlements, boundaries, and access routs, and locator maps showing geographic locations within local and national contexts.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Field Sites</span>"
    ]
  },
  {
    "objectID": "01-field-sites/index.html#site-maps",
    "href": "01-field-sites/index.html#site-maps",
    "title": "Field Sites",
    "section": "1.1 Site Maps",
    "text": "1.1 Site Maps\nImport AOI\n\ncrs_master = sf::st_crs('epsg:4326')\naoi_site   = sf::read_sf(\"../assets/inputs/chilwa_watershed_4326.shp\") |&gt;\n  sf::st_cast() |&gt; sf::st_transform(crs_master)\nbbox_site  = terrainr::add_bbox_buffer(aoi_site, 20000, \"meters\")\nvbox_site = terra::vect(bbox_site)\n\ntmap::tmap_mode(\"view\")\ntmap::tm_shape(aoi_site) +\n  tmap::tm_borders(col = \"red\") +\n  tmap::tm_basemap(\"Esri.WorldImagery\")\n\n\n\n\n\n\nFigure 1a: Interactive map showing project boundary and ESRI’s basemap\nImport Basemap\n\n# zoom = 12 sources basemap at scale of 1:150,000\nbasemap_150k = maptiles::get_tiles(\n  bbox_site, \n  zoom      = 10, \n  crop      = T,\n  provider  = \"OpenTopoMap\"\n)\n\ntmap::tmap_mode(\"view\")\ntmap::tm_shape(basemap_150k) + tmap::tm_rgb() + \n  tmap::tm_shape(aoi_site) +\n  tmap::tm_borders(col=\"red\")\n\n\n\n\n\n\nFigure 1b: Site map showing project boundary and downloaded basemap OpenTopoMap\nBuild Map\n\ntmap::tmap_mode(\"plot\")\nsite_map = tmap::tm_shape(basemap_150k) + tmap::tm_rgb() + \n  tmap::tm_shape(aoi_site) +\n  tmap::tm_borders(lwd = 1, col = \"red\") +\n  tmap::tm_graticules(lines=T,labels.rot=c(0,90),lwd=0.2) +\n  tmap::tm_credits(\"EPSG:4326\", position = c(\"left\", \"bottom\")) +\n  tmap::tm_scale_bar(\n    c(0, 10, 20, 40), \n    position = c(\"RIGHT\", \"BOTTOM\"), \n    text.size = .5\n    ) +\n  tmap::tm_compass(\n    type = \"4star\", size = 1.5,\n    color.dark = \"gray60\", text.color = \"gray60\",\n    position = c(\"left\", \"top\")\n    ) \n\nSave output\n\n# `width` & `height` controls output resolution \n# `dpi` controls size of map attributes relative to output resolution\ntmap::tmap_save(site_map, width=15120, height=15120, asp=0, dpi=600,\n  \"/Users/seamus/Repos/map-templates/assets/outputs/01-site-draft.png\"\n  )\nsite_map\n\n\n\nFigure 1c: Site Map rendered with customized attributes and resolution (15120x15120)",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Field Sites</span>"
    ]
  },
  {
    "objectID": "01-field-sites/index.html#locator-maps",
    "href": "01-field-sites/index.html#locator-maps",
    "title": "Field Sites",
    "section": "1.2 Locator Maps",
    "text": "1.2 Locator Maps\nImport AOI\n\naoi_country = giscoR::gisco_get_countries(country = \"Malawi\", resolution = \"3\") |&gt;\n  st_cast() |&gt; st_transform(crs_master)\naoi_region = giscoR::gisco_get_countries(\n  country = c(\"Malawi\", \"Zambia\", \"Tanzania\", \"Mozambique\"), resolution = \"3\") |&gt;\n  st_cast() |&gt; st_transform(crs_master)\n\nbbox_site  = terrainr::add_bbox_buffer(aoi_site, 20000, \"meters\")\nbbox_country = terrainr::add_bbox_buffer(aoi_country, 40000, \"meters\")\nbbox_region = terrainr::add_bbox_buffer(aoi_region, 80000, \"meters\")\n\nvbox_site = vect(bbox_site)\nvbox_region = vect(bbox_region)\nvbox_country = terra::vect(terra::ext(vect(aoi_country)) * 1.3) |&gt; sf::st_as_sf()\nsf::st_crs(vbox_country) &lt;- \"epsg:4326\" \n\n# Interactive map mode: \"view\" \ntmap::tmap_mode(\"view\")\ntmap::tm_shape(vbox_country) +\n  tmap::tm_borders(lwd = 2, col = \"green\") +\n  tmap::tm_shape(aoi_region) +\n  tmap::tm_borders(lwd = 1, col = \"blue\") +\n  tmap::tm_shape(aoi_site) +\n  tmap::tm_borders(lwd = 2, col = \"red\")\n\n\n\n\n\n\nFigure 1d: Interactive map showing site boundary, national borders, and national bounding box\nImport Basemap\n\n# zoom = 8 returns scale of 1:2,000,000\nbasemap_4m = maptiles::get_tiles(\n  bbox_region, \n  zoom      = 8, \n  crop      = T,\n  provider  = \"CartoDB.Positron\"\n)\n\ntmap::tmap_mode(\"plot\")\ncountry_map = tmap::tm_shape(vbox_country) + tm_borders(lwd = 0.0, col = \"black\") +\n  tmap::tm_shape(basemap_4m) + tm_rgb(alpha=0.2) + \n  tmap::tm_shape(aoi_site) + tm_borders(lwd=2, col = \"red\", fill=\"#e28672\", fill_alpha=0.5) +\n  tmap::tm_shape(aoi_region) + tm_borders(lwd = 0.5, col = \"black\") +\n  tmap::tm_compass(type=\"4star\", size=1.1, color.dark = \"gray60\", text.color=\"gray60\",position=c(\"LEFT\", \"TOP\")\n    ) \n\ntmap::tmap_save(country_map, \n                \"/Users/seamus/Repos/map-templates/assets/outputs/02-country-map.png\"\n                )\ncountry_map\n\n\n\nFigure 1e: Interactive map showing site boundary, national borders, and downloaded basemap.\n\nBuild Map\n\nmain_map = tmap::tmap_grob(site_map)\ninset_map = tmap::tmap_grob(country_map)\n\nlocator_map = ggdraw() +\n  draw_plot(main_map) +\n  draw_plot(inset_map, x = -0.39, y=0.4, height = 0.45)\n\nSave output\n\nggsave(locator_map, \"/Users/seamus/Repos/map-templates/assets/outputs/03-locator-map.png\")",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Field Sites</span>"
    ]
  },
  {
    "objectID": "01-field-sites/index.html#render-maps",
    "href": "01-field-sites/index.html#render-maps",
    "title": "Field Sites",
    "section": "1.3 Render Maps",
    "text": "1.3 Render Maps\n\nlocator_map\n\n\n\nFigure 1f: Locator map showing site area and location at 1:4,000,000 & 1:150,000 scales\n\nEnvironment Setup\n\neasypackages::packages(\n  \"bslib\", \n  \"cols4all\", \"covr\", \"cowplot\", \n  \"dendextend\", \"digest\",\"DiagrammeR\",\"dtwclust\", \"downlit\", \n  \"e1071\", \"exactextractr\",\"elevatr\", \n  \"FNN\", \"future\", \n  \"gdalcubes\", \"gdalUtilities\", \"geojsonsf\", \"geos\", \"ggplot2\", \"ggstats\", \n  \"ggspatial\", \"ggmap\", \"ggplotify\", \"ggpubr\", \"ggrepel\", \"giscoR\", \n  \"hdf5r\", \"httr\", \"httr2\", \"htmltools\",\n  \"jsonlite\", \n  \"kohonen\", \n  \"leaflet.providers\", \"leafem\", \"libgeos\",\"luz\",\"lwgeom\", \"leaflet\", \"leafgl\",\n  \"mapedit\", \"mapview\", \"maptiles\", \"methods\", \"mgcv\", \n  \"ncdf4\", \"nnet\", \n  \"openxlsx\", \"parallel\", \"plotly\", \n  \"randomForest\", \"rasterVis\", \"raster\", \"Rcpp\", \"RcppArmadillo\", \n  \"RcppCensSpatial\",\"rayshader\", \"RcppEigen\", \"RcppParallel\", \n  \"RColorBrewer\", \"reactable\", \"rgl\", \"rsconnect\",\"RStoolbox\", \"rts\", \n  \"s2\", \"sf\", \"scales\", \"sits\",\"spdep\", \"stars\", \"stringr\",\"supercells\", \n  \"terra\", \"testthat\", \"tidyverse\", \"tidyterra\",\"tools\", \n  \"tmap\", \"tmaptools\", \"terrainr\", \n  \"xgboost\",\n  prompt = F)\n\nRuntime Log\n\ndevtools::session_info()\n## ─ Session info ───────────────────────────────────────────\n##  setting  value\n##  version  R version 4.3.0 (2023-04-21)\n##  os       macOS 15.7.1\n##  system   aarch64, darwin20\n##  ui       X11\n##  language (EN)\n##  collate  en_US.UTF-8\n##  ctype    en_US.UTF-8\n##  tz       America/Vancouver\n##  date     2025-11-03\n##  pandoc   3.8 @ /opt/local/bin/ (via rmarkdown)\n##  quarto   1.7.33 @ /usr/local/bin/quarto\n## \n## ─ Packages ───────────────────────────────────────────────\n##  package            * version    date (UTC) lib source\n##  abind              * 1.4-8      2024-09-12 [1] CRAN (R 4.3.3)\n##  ape                  5.8-1      2024-12-16 [1] CRAN (R 4.3.3)\n##  assertthat           0.2.1      2019-03-21 [1] CRAN (R 4.3.3)\n##  backports            1.5.0      2024-05-23 [1] CRAN (R 4.3.3)\n##  base64enc            0.1-3      2015-07-28 [1] CRAN (R 4.3.3)\n##  bit                  4.6.0      2025-03-06 [1] CRAN (R 4.3.3)\n##  bit64                4.6.0-1    2025-01-16 [1] CRAN (R 4.3.3)\n##  bitops               1.0-9      2024-10-03 [1] CRAN (R 4.3.3)\n##  boot                 1.3-32     2025-08-29 [1] CRAN (R 4.3.0)\n##  brew                 1.0-10     2023-12-16 [1] CRAN (R 4.3.3)\n##  brio                 1.1.5      2024-04-24 [1] CRAN (R 4.3.3)\n##  broom                1.0.8      2025-03-28 [1] CRAN (R 4.3.3)\n##  bslib              * 0.9.0      2025-01-30 [1] CRAN (R 4.3.3)\n##  cachem               1.1.0      2024-05-16 [1] CRAN (R 4.3.3)\n##  callr                3.7.6      2024-03-25 [1] CRAN (R 4.3.3)\n##  car                  3.1-3      2024-09-27 [1] CRAN (R 4.3.3)\n##  carData              3.0-5      2022-01-06 [1] CRAN (R 4.3.3)\n##  caret                7.0-1      2024-12-10 [1] CRAN (R 4.3.3)\n##  class                7.3-23     2025-01-01 [1] CRAN (R 4.3.3)\n##  classInt             0.4-11     2025-01-08 [1] CRAN (R 4.3.3)\n##  cli                  3.6.5      2025-04-23 [1] CRAN (R 4.3.3)\n##  clue                 0.3-66     2024-11-13 [1] CRAN (R 4.3.3)\n##  cluster              2.1.8.1    2025-03-12 [1] CRAN (R 4.3.3)\n##  coda                 0.19-4.1   2024-01-31 [1] CRAN (R 4.3.3)\n##  codetools            0.2-20     2024-03-31 [1] CRAN (R 4.3.1)\n##  colorspace           2.1-1      2024-07-26 [1] CRAN (R 4.3.3)\n##  cols4all           * 0.9        2025-08-28 [1] CRAN (R 4.3.0)\n##  contfrac             1.1-12     2018-05-17 [1] CRAN (R 4.3.3)\n##  coro                 1.1.0      2024-11-05 [1] CRAN (R 4.3.3)\n##  corpcor              1.6.10     2021-09-16 [1] CRAN (R 4.3.3)\n##  countrycode          1.6.1      2025-03-31 [1] CRAN (R 4.3.3)\n##  covr               * 3.6.4      2023-11-09 [1] CRAN (R 4.3.1)\n##  cowplot            * 1.2.0      2025-07-07 [1] CRAN (R 4.3.3)\n##  crayon               1.5.3      2024-06-20 [1] CRAN (R 4.3.3)\n##  crosstalk            1.2.2      2025-08-26 [1] CRAN (R 4.3.0)\n##  cubature             2.1.4      2025-06-02 [1] CRAN (R 4.3.3)\n##  data.table           1.17.8     2025-07-10 [1] CRAN (R 4.3.3)\n##  DBI                  1.2.3      2024-06-02 [1] CRAN (R 4.3.3)\n##  deldir               2.0-4      2024-02-28 [1] CRAN (R 4.3.3)\n##  dendextend         * 1.19.1     2025-07-15 [1] CRAN (R 4.3.0)\n##  deSolve              1.40       2023-11-27 [1] CRAN (R 4.3.3)\n##  devtools             2.4.5      2022-10-11 [1] CRAN (R 4.3.0)\n##  DiagrammeR         * 1.0.11     2024-02-02 [1] CRAN (R 4.3.1)\n##  dichromat            2.0-0.1    2022-05-02 [1] CRAN (R 4.3.3)\n##  digest             * 0.6.37     2024-08-19 [1] CRAN (R 4.3.3)\n##  doParallel           1.0.17     2022-02-07 [1] CRAN (R 4.3.3)\n##  downlit            * 0.4.4      2024-06-10 [1] CRAN (R 4.3.3)\n##  dplyr              * 1.1.4      2023-11-17 [1] CRAN (R 4.3.1)\n##  dtw                * 1.23-1     2022-09-19 [1] CRAN (R 4.3.3)\n##  dtwclust           * 6.0.0      2024-07-23 [1] CRAN (R 4.3.3)\n##  e1071              * 1.7-16     2024-09-16 [1] CRAN (R 4.3.3)\n##  easypackages         0.1.0      2016-12-05 [1] CRAN (R 4.3.0)\n##  elevatr            * 0.99.0     2023-09-12 [1] CRAN (R 4.3.0)\n##  ellipsis             0.3.2      2021-04-29 [1] CRAN (R 4.3.3)\n##  elliptic             1.4-0      2019-03-14 [1] CRAN (R 4.3.3)\n##  evaluate             1.0.5      2025-08-27 [1] CRAN (R 4.3.0)\n##  exactextractr      * 0.10.0     2023-09-20 [1] CRAN (R 4.3.1)\n##  extrafont            0.19       2023-01-18 [1] CRAN (R 4.3.3)\n##  extrafontdb          1.0        2012-06-11 [1] CRAN (R 4.3.3)\n##  farver               2.1.2      2024-05-13 [1] CRAN (R 4.3.3)\n##  fastmap              1.2.0      2024-05-15 [1] CRAN (R 4.3.3)\n##  flexclust            1.5.0      2025-02-28 [1] CRAN (R 4.3.3)\n##  FNN                * 1.1.4.1    2024-09-22 [1] CRAN (R 4.3.3)\n##  forcats            * 1.0.0      2023-01-29 [1] CRAN (R 4.3.0)\n##  foreach              1.5.2      2022-02-02 [1] CRAN (R 4.3.3)\n##  Formula              1.2-5      2023-02-24 [1] CRAN (R 4.3.3)\n##  fs                   1.6.6      2025-04-12 [1] CRAN (R 4.3.3)\n##  future             * 1.67.0     2025-07-29 [1] CRAN (R 4.3.0)\n##  future.apply         1.20.0     2025-06-06 [1] CRAN (R 4.3.0)\n##  FuzzyNumbers         0.4-7      2021-11-15 [1] CRAN (R 4.3.3)\n##  FuzzyNumbers.Ext.2   3.2        2017-09-05 [1] CRAN (R 4.3.3)\n##  gdalcubes          * 0.7.1      2025-03-20 [1] CRAN (R 4.3.3)\n##  gdalUtilities      * 1.2.5      2023-08-10 [1] CRAN (R 4.3.0)\n##  generics             0.1.4      2025-05-09 [1] CRAN (R 4.3.3)\n##  geojsonsf          * 2.0.3      2022-05-30 [1] CRAN (R 4.3.3)\n##  geos               * 0.2.4      2023-11-30 [1] CRAN (R 4.3.3)\n##  ggmap              * 4.0.1      2025-04-07 [1] CRAN (R 4.3.3)\n##  ggplot2            * 3.5.2      2025-04-09 [1] CRAN (R 4.3.3)\n##  ggplotify          * 0.1.2      2023-08-09 [1] CRAN (R 4.3.0)\n##  ggpubr             * 0.6.1      2025-06-27 [1] CRAN (R 4.3.3)\n##  ggrepel            * 0.9.6      2024-09-07 [1] CRAN (R 4.3.3)\n##  ggsignif             0.6.4      2022-10-13 [1] CRAN (R 4.3.0)\n##  ggspatial          * 1.1.10     2025-08-24 [1] CRAN (R 4.3.0)\n##  ggstats            * 0.10.0     2025-07-02 [1] CRAN (R 4.3.3)\n##  giscoR             * 0.6.1      2025-08-11 [1] Github (rOpenGov/giscoR@adfed30)\n##  globals              0.18.0     2025-05-08 [1] CRAN (R 4.3.0)\n##  glue                 1.8.0      2024-09-30 [1] CRAN (R 4.3.3)\n##  gmm                  1.9-1      2025-08-26 [1] CRAN (R 4.3.0)\n##  gower                1.0.2      2024-12-17 [1] CRAN (R 4.3.3)\n##  gridExtra            2.3        2017-09-09 [1] CRAN (R 4.3.3)\n##  gridGraphics         0.5-1      2020-12-13 [1] CRAN (R 4.3.3)\n##  gtable               0.3.6      2024-10-25 [1] CRAN (R 4.3.3)\n##  hardhat              1.4.2      2025-08-20 [1] CRAN (R 4.3.0)\n##  hdf5r              * 1.3.12     2025-01-20 [1] CRAN (R 4.3.3)\n##  hexbin               1.28.5     2024-11-13 [1] CRAN (R 4.3.3)\n##  hms                  1.1.3      2023-03-21 [1] CRAN (R 4.3.0)\n##  htmltools          * 0.5.8.1    2024-04-04 [1] CRAN (R 4.3.3)\n##  htmlwidgets          1.6.4      2023-12-06 [1] CRAN (R 4.3.1)\n##  httpuv               1.6.16     2025-04-16 [1] CRAN (R 4.3.3)\n##  httr               * 1.4.7      2023-08-15 [1] CRAN (R 4.3.0)\n##  httr2              * 1.2.1      2025-07-22 [1] CRAN (R 4.3.0)\n##  hypergeo             1.2-14     2025-03-24 [1] CRAN (R 4.3.3)\n##  interp               1.1-6      2024-01-26 [1] CRAN (R 4.3.3)\n##  ipred                0.9-15     2024-07-18 [1] CRAN (R 4.3.3)\n##  iterators            1.0.14     2022-02-05 [1] CRAN (R 4.3.3)\n##  jpeg                 0.1-11     2025-03-21 [1] CRAN (R 4.3.3)\n##  jquerylib            0.1.4      2021-04-26 [1] CRAN (R 4.3.3)\n##  jsonlite           * 2.0.0      2025-03-27 [1] CRAN (R 4.3.3)\n##  KernSmooth           2.23-26    2025-01-01 [1] CRAN (R 4.3.3)\n##  knitr                1.50       2025-03-16 [1] CRAN (R 4.3.3)\n##  kohonen            * 3.0.12     2023-06-09 [1] CRAN (R 4.3.3)\n##  later                1.4.4      2025-08-27 [1] CRAN (R 4.3.0)\n##  lattice            * 0.22-7     2025-04-02 [1] CRAN (R 4.3.3)\n##  latticeExtra         0.6-30     2022-07-04 [1] CRAN (R 4.3.3)\n##  lava                 1.8.1      2025-01-12 [1] CRAN (R 4.3.3)\n##  lazyeval             0.2.2      2019-03-15 [1] CRAN (R 4.3.3)\n##  leafem             * 0.2.5      2025-08-28 [1] CRAN (R 4.3.0)\n##  leafgl             * 0.2.2      2024-11-13 [1] CRAN (R 4.3.3)\n##  leaflegend           1.2.1      2024-05-09 [1] CRAN (R 4.3.3)\n##  leaflet            * 2.2.2      2024-03-26 [1] CRAN (R 4.3.1)\n##  leaflet.providers  * 2.0.0      2023-10-17 [1] CRAN (R 4.3.3)\n##  leafpop              0.1.0      2021-05-22 [1] CRAN (R 4.3.0)\n##  leafsync             0.1.0      2019-03-05 [1] CRAN (R 4.3.0)\n##  libgeos            * 3.11.1-3   2025-03-19 [1] CRAN (R 4.3.3)\n##  lifecycle            1.0.4      2023-11-07 [1] CRAN (R 4.3.3)\n##  listenv              0.9.1      2024-01-29 [1] CRAN (R 4.3.3)\n##  logger               0.4.0      2024-10-22 [1] CRAN (R 4.3.3)\n##  lubridate          * 1.9.4      2024-12-08 [1] CRAN (R 4.3.3)\n##  luz                * 0.5.0      2025-07-29 [1] CRAN (R 4.3.0)\n##  lwgeom             * 0.2-14     2024-02-21 [1] CRAN (R 4.3.1)\n##  magrittr             2.0.4      2025-09-12 [1] CRAN (R 4.3.0)\n##  mapedit            * 0.7.0      2025-04-20 [1] CRAN (R 4.3.3)\n##  maptiles           * 0.10.0     2025-05-07 [1] CRAN (R 4.3.3)\n##  mapview            * 2.11.2     2023-10-13 [1] CRAN (R 4.3.1)\n##  MASS                 7.3-60.0.1 2024-01-13 [1] CRAN (R 4.3.1)\n##  Matrix               1.6-5      2024-01-11 [1] CRAN (R 4.3.1)\n##  matrixcalc           1.0-6      2022-09-14 [1] CRAN (R 4.3.3)\n##  MCMCglmm             2.36       2024-05-06 [1] CRAN (R 4.3.1)\n##  memoise              2.0.1      2021-11-26 [1] CRAN (R 4.3.3)\n##  mgcv               * 1.9-3      2025-04-04 [1] CRAN (R 4.3.0)\n##  microbenchmark       1.5.0      2024-09-04 [1] CRAN (R 4.3.3)\n##  mime                 0.13       2025-03-17 [1] CRAN (R 4.3.3)\n##  miniUI               0.1.2      2025-04-17 [1] CRAN (R 4.3.3)\n##  ModelMetrics         1.2.2.2    2020-03-17 [1] CRAN (R 4.3.3)\n##  modeltools           0.2-24     2025-05-02 [1] CRAN (R 4.3.3)\n##  MomTrunc             6.1        2024-10-28 [1] CRAN (R 4.3.3)\n##  mvtnorm              1.3-3      2025-01-10 [1] CRAN (R 4.3.3)\n##  ncdf4              * 1.24       2025-03-25 [1] CRAN (R 4.3.3)\n##  nlme               * 3.1-168    2025-03-31 [1] CRAN (R 4.3.3)\n##  nnet               * 7.3-20     2025-01-01 [1] CRAN (R 4.3.3)\n##  openxlsx           * 4.2.8      2025-01-25 [1] CRAN (R 4.3.3)\n##  parallelly           1.45.1     2025-07-24 [1] CRAN (R 4.3.0)\n##  pillar               1.11.0     2025-07-04 [1] CRAN (R 4.3.3)\n##  pkgbuild             1.4.8      2025-05-26 [1] CRAN (R 4.3.3)\n##  pkgconfig            2.0.3      2019-09-22 [1] CRAN (R 4.3.3)\n##  pkgload              1.4.0      2024-06-28 [1] CRAN (R 4.3.3)\n##  plotly             * 4.11.0     2025-06-19 [1] CRAN (R 4.3.3)\n##  plyr                 1.8.9      2023-10-02 [1] CRAN (R 4.3.3)\n##  png                  0.1-8      2022-11-29 [1] CRAN (R 4.3.3)\n##  prettyunits          1.2.0      2023-09-24 [1] CRAN (R 4.3.3)\n##  pROC                 1.19.0.1   2025-07-31 [1] CRAN (R 4.3.0)\n##  processx             3.8.6      2025-02-21 [1] CRAN (R 4.3.3)\n##  prodlim              2025.04.28 2025-04-28 [1] CRAN (R 4.3.3)\n##  profvis              0.4.0      2024-09-20 [1] CRAN (R 4.3.3)\n##  progress             1.2.3      2023-12-06 [1] CRAN (R 4.3.1)\n##  progressr            0.15.1     2024-11-22 [1] CRAN (R 4.3.3)\n##  promises             1.3.3      2025-05-29 [1] CRAN (R 4.3.3)\n##  proxy              * 0.4-27     2022-06-09 [1] CRAN (R 4.3.3)\n##  ps                   1.9.1      2025-04-12 [1] CRAN (R 4.3.3)\n##  purrr              * 1.1.0      2025-07-10 [1] CRAN (R 4.3.0)\n##  R6                   2.6.1      2025-02-15 [1] CRAN (R 4.3.3)\n##  randomForest       * 4.7-1.2    2024-09-22 [1] CRAN (R 4.3.3)\n##  rappdirs             0.3.3      2021-01-31 [1] CRAN (R 4.3.3)\n##  raster             * 3.6-32     2025-03-28 [1] CRAN (R 4.3.3)\n##  rasterVis          * 0.51.6     2023-11-01 [1] CRAN (R 4.3.3)\n##  rayshader          * 0.37.3     2024-02-21 [1] CRAN (R 4.3.1)\n##  rbibutils            2.3        2024-10-04 [1] CRAN (R 4.3.3)\n##  RColorBrewer       * 1.1-3      2022-04-03 [1] CRAN (R 4.3.3)\n##  Rcpp               * 1.1.0      2025-07-02 [1] CRAN (R 4.3.3)\n##  RcppArmadillo      * 14.6.0-1   2025-07-02 [1] CRAN (R 4.3.3)\n##  RcppCensSpatial    * 0.3.0      2022-06-27 [1] CRAN (R 4.3.0)\n##  RcppEigen          * 0.3.4.0.2  2024-08-24 [1] CRAN (R 4.3.3)\n##  RcppParallel       * 5.1.11-1   2025-08-27 [1] CRAN (R 4.3.0)\n##  RCurl                1.98-1.17  2025-03-22 [1] CRAN (R 4.3.3)\n##  Rdpack               2.6.4      2025-04-09 [1] CRAN (R 4.3.3)\n##  reactable          * 0.4.4      2023-03-12 [1] CRAN (R 4.3.0)\n##  readr              * 2.1.5      2024-01-10 [1] CRAN (R 4.3.1)\n##  recipes              1.3.1      2025-05-21 [1] CRAN (R 4.3.3)\n##  relliptical          1.3.0      2024-02-07 [1] CRAN (R 4.3.1)\n##  remotes              2.5.0      2024-03-17 [1] CRAN (R 4.3.3)\n##  reshape2             1.4.4      2020-04-09 [1] CRAN (R 4.3.0)\n##  rex                  1.2.1      2021-11-26 [1] CRAN (R 4.3.3)\n##  rgl                * 1.3.24     2025-06-25 [1] CRAN (R 4.3.3)\n##  rlang                1.1.6      2025-04-11 [1] CRAN (R 4.3.3)\n##  rmarkdown            2.29       2024-11-04 [1] CRAN (R 4.3.3)\n##  rpart                4.1.24     2025-01-07 [1] CRAN (R 4.3.3)\n##  rsconnect          * 1.5.1      2025-08-28 [1] CRAN (R 4.3.0)\n##  RSpectra             0.16-2     2024-07-18 [1] CRAN (R 4.3.3)\n##  rstatix              0.7.2      2023-02-01 [1] CRAN (R 4.3.0)\n##  RStoolbox          * 1.0.2.1    2025-02-03 [1] CRAN (R 4.3.3)\n##  rstudioapi           0.17.1     2024-10-22 [1] CRAN (R 4.3.3)\n##  rts                * 1.1-14     2023-10-01 [1] CRAN (R 4.3.3)\n##  Rttf2pt1             1.3.12     2023-01-22 [1] CRAN (R 4.3.3)\n##  Ryacas0              0.4.4      2023-01-12 [1] CRAN (R 4.3.3)\n##  s2                 * 1.1.9      2025-05-23 [1] CRAN (R 4.3.3)\n##  sandwich             3.1-1      2024-09-15 [1] CRAN (R 4.3.3)\n##  sass                 0.4.10     2025-04-11 [1] CRAN (R 4.3.3)\n##  satellite            1.0.6      2025-08-21 [1] CRAN (R 4.3.0)\n##  scales             * 1.4.0      2025-04-24 [1] CRAN (R 4.3.3)\n##  sessioninfo          1.2.3      2025-02-05 [1] CRAN (R 4.3.3)\n##  settings             0.2.7      2021-05-07 [1] CRAN (R 4.3.3)\n##  sf                 * 1.0-22     2025-08-25 [1] Github (r-spatial/sf@3660edf)\n##  shiny                1.11.1     2025-07-03 [1] CRAN (R 4.3.3)\n##  shinyjs              2.1.0      2021-12-23 [1] CRAN (R 4.3.0)\n##  shinyWidgets         0.9.0      2025-02-21 [1] CRAN (R 4.3.3)\n##  sits               * 1.5.2      2025-02-12 [1] CRAN (R 4.3.3)\n##  sp                 * 2.2-0      2025-02-01 [1] CRAN (R 4.3.3)\n##  spacesXYZ            1.6-0      2025-06-06 [1] CRAN (R 4.3.3)\n##  spData             * 2.3.4      2025-01-08 [1] CRAN (R 4.3.3)\n##  spdep              * 1.4-1      2025-08-31 [1] CRAN (R 4.3.0)\n##  stars              * 0.6-8      2025-02-01 [1] CRAN (R 4.3.3)\n##  StempCens            1.2.0      2025-06-11 [1] CRAN (R 4.3.3)\n##  stringi              1.8.7      2025-03-27 [1] CRAN (R 4.3.3)\n##  stringr            * 1.5.2      2025-09-08 [1] CRAN (R 4.3.0)\n##  supercells         * 1.0.0      2024-02-11 [1] CRAN (R 4.3.1)\n##  survival             3.8-3      2024-12-17 [1] CRAN (R 4.3.3)\n##  svglite              2.2.1      2025-05-12 [1] CRAN (R 4.3.3)\n##  systemfonts          1.2.3      2025-04-30 [1] CRAN (R 4.3.3)\n##  tensorA              0.36.2.1   2023-12-13 [1] CRAN (R 4.3.3)\n##  terra              * 1.8-60     2025-07-21 [1] CRAN (R 4.3.0)\n##  terrainr           * 0.7.6      2025-07-25 [1] CRAN (R 4.3.0)\n##  testthat           * 3.2.3      2025-01-13 [1] CRAN (R 4.3.3)\n##  textshaping          1.0.3      2025-09-02 [1] CRAN (R 4.3.0)\n##  tibble             * 3.3.0      2025-06-08 [1] CRAN (R 4.3.3)\n##  tidyr              * 1.3.1      2024-01-24 [1] CRAN (R 4.3.1)\n##  tidyselect           1.2.1      2024-03-11 [1] CRAN (R 4.3.1)\n##  tidyterra          * 0.7.2      2025-04-14 [1] CRAN (R 4.3.3)\n##  tidyverse          * 2.0.0      2023-02-22 [1] CRAN (R 4.3.0)\n##  timechange           0.3.0      2024-01-18 [1] CRAN (R 4.3.3)\n##  timeDate             4041.110   2024-09-22 [1] CRAN (R 4.3.3)\n##  tlrmvnmvt            1.1.2      2022-06-09 [1] CRAN (R 4.3.3)\n##  tmap               * 4.1        2025-05-12 [1] CRAN (R 4.3.3)\n##  tmaptools          * 3.2        2025-01-13 [1] CRAN (R 4.3.3)\n##  tmvtnorm             1.6        2023-12-05 [1] CRAN (R 4.3.3)\n##  torch                0.16.0     2025-08-21 [1] CRAN (R 4.3.0)\n##  tzdb                 0.5.0      2025-03-15 [1] CRAN (R 4.3.3)\n##  unifir               0.2.4      2024-02-01 [1] CRAN (R 4.3.3)\n##  units                0.8-7      2025-03-11 [1] CRAN (R 4.3.3)\n##  urlchecker           1.0.1      2021-11-30 [1] CRAN (R 4.3.3)\n##  usethis              3.1.0      2024-11-26 [1] CRAN (R 4.3.3)\n##  uuid                 1.2-1      2024-07-29 [1] CRAN (R 4.3.3)\n##  vctrs                0.6.5      2023-12-01 [1] CRAN (R 4.3.3)\n##  viridis              0.6.5      2024-01-29 [1] CRAN (R 4.3.1)\n##  viridisLite          0.4.2      2023-05-02 [1] CRAN (R 4.3.3)\n##  visNetwork           2.1.2      2022-09-29 [1] CRAN (R 4.3.0)\n##  withr                3.0.2      2024-10-28 [1] CRAN (R 4.3.3)\n##  wk                   0.9.4      2024-10-11 [1] CRAN (R 4.3.3)\n##  xfun                 0.53       2025-08-19 [1] CRAN (R 4.3.0)\n##  xgboost            * 1.7.11.1   2025-05-15 [1] CRAN (R 4.3.3)\n##  XML                  3.99-0.18  2025-01-01 [1] CRAN (R 4.3.3)\n##  xml2                 1.4.0      2025-08-20 [1] CRAN (R 4.3.0)\n##  xtable               1.8-4      2019-04-21 [1] CRAN (R 4.3.3)\n##  xts                * 0.14.1     2024-10-15 [1] CRAN (R 4.3.3)\n##  yaml                 2.3.10     2024-07-26 [1] CRAN (R 4.3.3)\n##  yulab.utils          0.2.1      2025-08-19 [1] CRAN (R 4.3.0)\n##  zeallot              0.2.0      2025-05-27 [1] CRAN (R 4.3.3)\n##  zip                  2.3.3      2025-05-13 [1] CRAN (R 4.3.3)\n##  zoo                * 1.8-14     2025-04-10 [1] CRAN (R 4.3.3)\n## \n##  [1] /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/library\n##  * ── Packages attached to the search path.\n## \n## ──────────────────────────────────────────────────────────",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Field Sites</span>"
    ]
  },
  {
    "objectID": "02-watersheds/index.html",
    "href": "02-watersheds/index.html",
    "title": "Watersheds",
    "section": "",
    "text": "2.0 Overview\nThe following compares two R-based workflows for watershed delineation and hydrological network extraction from digital elevation models (DEMs). We implement parallel processing pipelines using flowdem (Martinsen, 2023) and whitebox (Wu & Brown, 2025) packages to evaluate algorithmic differences in depression handling, flow routing, and stream network generation. Both workflows leverage high-performance geospatial libraries including RichDEM (Barnes, 2016), WhiteboxTools, GDAL 3.11 (contributors, 2020), and the r-spatial ecosystem (Hijmans, 2025; Pebesma & Bivand, 2023a, 2023b).\nThe comparative approach serves two purposes: (1) validating watershed boundaries through algorithmic consensus, and (2) identifying optimal processing strategies for challenging terrain features such as endorheic basins and artificial depressions. Performance benchmarks and visual comparisons guide selection between rapid exploratory analysis (flowdem) and fine-tuned parametric control (whitebox).",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Watersheds</span>"
    ]
  },
  {
    "objectID": "02-watersheds/index.html#overview",
    "href": "02-watersheds/index.html#overview",
    "title": "Watersheds",
    "section": "",
    "text": "Environment Setup\n\npacman::p_load(\n  \"bslib\",\n  \"cli\", \"cols4all\", \"covr\", \"cowplot\",\n  \"dendextend\", \"digest\", \"DiagrammeR\", \n  \"dtwclust\", \"downlit\",\n  \"exactextractr\", \"elevatr\",\n  \"FNN\", \"future\", \"flowdem\",\n  \"gdalUtilities\", \"geojsonsf\", \"geos\", \"geodata\", \n  \"ggplot2\", \"ggstats\",\"ggspatial\", \"ggmap\", \n  \"ggplotify\", \"ggpubr\", \"ggrepel\", \"giscoR\",\n  \"hdf5r\", \"httr\", \"httr2\", \"htmltools\",\n  \"jsonlite\",\n  \"leafem\", \"leaflet.providers\", \"libgeos\", \n  \"luz\", \"lwgeom\", \"leaflet\", \"leafgl\",\n  \"mapedit\", \"mapview\", \"maptiles\", \n  \"methods\", \"mgcv\", \"MPI\",\n  \"ncdf4\", \"nnet\",\n  \"openxlsx\",\n  \"parallel\", \"plotly\", \"proj4\", \"PROJ\", \"progress\", \"purrr\",\n  \"randomForest\", \"rasterVis\", \"raster\", \n  \"rayshader\", \"rayvertex\", \n  \"RColorBrewer\", \"rgl\", \"rmapshaper\", \"rsconnect\", \n  \"RStoolbox\", \"rts\", \"rgrass\",\n  \"s2\", \"sf\", \"scales\", \"spdep\", \"stars\", \n  \"stringr\", \"supercells\",\n  \"terra\", \"terrainr\", \"testthat\", \"traudem\", \"taudem\", \n  \"tidyverse\", \"tidyterra\", \"tools\",\n  \"tmap\", \"tmaptools\", \"terrainr\",\n  \"whitebox\", \"xgboost\"\n  )",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Watersheds</span>"
    ]
  },
  {
    "objectID": "02-watersheds/index.html#declare-aois",
    "href": "02-watersheds/index.html#declare-aois",
    "title": "Watersheds",
    "section": "2.1 Declare AOIs",
    "text": "2.1 Declare AOIs\n\ncrs_master = sf::st_crs(\"EPSG:3857\")\ncountry = giscoR::gisco_get_countries(\n  country = \"Malawi\", resolution = \"3\") |&gt;\n  sf::st_cast() |&gt; sf::st_transform(crs_master)\nlake  = sf::st_read(\"../assets/inputs/lakes_site.shp\") |&gt;\n  sf::st_cast() |&gt; sf::st_transform(crs_master)\nNA Reading layer `lakes_site' from data source \nNA   `/Users/seamus/repos/map-templates/assets/inputs/lakes_site.shp' \nNA   using driver `ESRI Shapefile'\nNA Simple feature collection with 1 feature and 22 fields\nNA Geometry type: POLYGON\nNA Dimension:     XY\nNA Bounding box:  xmin: 35.6 ymin: -15.5 xmax: 35.9 ymax: -15\nNA Geodetic CRS:  WGS 84\n\nbbox = lake |&gt;\n  sf::st_buffer(dist = 60000) |&gt; \n  sf::st_bbox() |&gt;\n  sf::st_as_sfc() |&gt;\n  sf::st_sf()\n\n# Interactive map mode: \"view\"\ntmap::tmap_mode(\"view\")\ntmap::tm_shape(country) + tmap::tm_borders(lwd=1, col= \"green\") +\n  tmap::tm_shape(bbox) + tmap::tm_borders(lwd=2, col= \"orange\") +\n  tmap::tm_shape(lake) + tmap::tm_borders(lwd=2, col= \"blue\") +\n  tmap::tm_basemap(\"Esri.WorldImagery\")\n\n\n\n\n\n\nFigure 2a: Interactive map illustrating layout of area of interest polygons (AOI)",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Watersheds</span>"
    ]
  },
  {
    "objectID": "02-watersheds/index.html#download-dem",
    "href": "02-watersheds/index.html#download-dem",
    "title": "Watersheds",
    "section": "2.2 Download DEM",
    "text": "2.2 Download DEM\nWe acquired elevation data using the elevatr package (Hollister et al., 2023) that accesses via Amazon Web Services Terrain Tiles and the Open Topography Global DEM API collections of global digital elevation models including SRTMGL3, SRTMGL1, AW3D30, and SRTM15Plus. Depending on source, OSM’s Slippy Tiling syntax1 is used where zoom represents number of vertical tiles counting from top-left corner in a Pseudo-Mercator grid (EPSG:3857).\nAt our study latitude, zoom=11 returns approximately 3-arc-second resolution (~76m at the equator). We then resample to a standardized 100m grid to facilitate downstream metrics computed at landscape scale. The crs_master variable ensures coordinate reference system consistency throughout subsequent operations.\n\n# z = 12: 1-Arc Second Resolution\n# z = 11: 3-Arc Second Resolution\n# z = 10: 5-Arc Second Resolution\ndem = elevatr::get_elev_raster(bbox, z=10, clip=\"locations\") |&gt; terra::rast() \nnames(dem) = \"elevation\" \n\ndem_100m  = stars::st_warp(\n  stars::st_as_stars(dem), \n  cellsize=100, crs=sf::st_crs(crs_master)) |&gt;\n  terra::rast()\n\n# Outputs\nterra::writeRaster(dem_100m, overwrite = TRUE,\n  \"../assets/TIF/dem_chilwa_00_raw.tif\")",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Watersheds</span>"
    ]
  },
  {
    "objectID": "02-watersheds/index.html#hydraulic-conditioning",
    "href": "02-watersheds/index.html#hydraulic-conditioning",
    "title": "Watersheds",
    "section": "2.3 Hydraulic Conditioning",
    "text": "2.3 Hydraulic Conditioning\nBoth flowdem and whitebox workflows follow the standard hydrological processing sequence: (1) hydraulic conditioning through depression handling, (2) flow direction and accumulation calculation, and (4) stream network extraction. However, they differ fundamentally in algorithmic implementation and parametric control.\nflowdem integrates RichDEM operations using priority-flood algorithms (Barnes et al., 2014) with minimal parameters that are optimized for computational efficiency and exploratory analysis. Meanwhile, whitebox provides granular control through extensive tools, enabling parameter tuning for complex terrain such as karst formations or anthropogenic modifications (Hasan et al., 2021).\n2.3.1 Depression Breaching\nDEMs contain spurious depressions from acquisition artifacts, interpolation errors, and measurement limitations (Lindsay, 2016). These disrupt flow connectivity essential for watershed delineation. Hydraulic conditioning removes artifacts while preserving genuine topographic features like Lake Chilwa’s endorheic basin.\nThe flowdem workflow implements Barnes et al.’s priority-flood algorithm (Barnes et al., 2014) via the RichDEM library, which processes depressions via optimized queue-based operations. The breach() function carves minimal-depth channels through topographic barriers, improving efficiency with in-memory operations.\nThe whitebox workflow provides additional parameter controls with which we add a breaching constraint (max_depth=3m) and a slope component (flat_increment=0.001) to ensure monotonic descent along breach channels. This parameter-controlled approach enables selective breaching based on depression characteristics. The flat_increment parameter performs similar function as epsilon used in subsequent flowdem::breach operations, only with greater manual controls of the slope gradient (Lindsay, 2016).\nPerformance benchmarking reveals whitebox breaching completes in 2.3 seconds versus 8.8 seconds for flowdem, likely reflecting differences between compiled C++ (WhiteboxTools) versus R-wrapped operations (RichDEM). However, flowdem’s approach requires fewer parameters, facilitating rapid exploratory workflows.\n\n# Compare breaching algorithms \ntime_wb &lt;- system.time({\n  whitebox::wbt_breach_depressions(\n    dem     = \"dem_chilwa_00_raw.tif\",\n    output  = \"dem_chilwa_11_breached_flat.tif\",\n    wd      = \"../assets/TIF/\",\n    max_depth = 3,\n    flat_increment = 0.001)\n})\n\ntime_fd &lt;- system.time({\n  dem_breach_fd &lt;- flowdem::breach(\n    terra::rast(\"../assets/TIF/dem_chilwa_00_raw.tif\"))\n  terra::writeRaster(dem_breach_fd, overwrite = TRUE,\n    \"../assets/TIF/dem_chilwa_01_breached.tif\")\n})\n\n# Compare runtimes\ncat(\"\\n=== Runtime Comparison ===\\n\")\nNA \nNA === Runtime Comparison ===\ncat(\"Whitebox breach:\\n\")\nNA Whitebox breach:\ncat(sprintf(\"  Elapsed time: %.3f seconds\\n\", time_wb[\"elapsed\"]))\nNA   Elapsed time: 2.344 seconds\ncat(sprintf(\"  User time:    %.3f seconds\\n\", time_wb[\"user.self\"]))\nNA   User time:    0.014 seconds\ncat(sprintf(\"  System time:  %.3f seconds\\n\\n\", time_wb[\"sys.self\"]))\nNA   System time:  0.009 seconds\n\ncat(\"flowdem breach:\\n\")\nNA flowdem breach:\ncat(sprintf(\"  Elapsed time: %.3f seconds\\n\", time_fd[\"elapsed\"]))\nNA   Elapsed time: 8.772 seconds\ncat(sprintf(\"  User time:    %.3f seconds\\n\", time_fd[\"user.self\"]))\nNA   User time:    8.577 seconds\ncat(sprintf(\"  System time:  %.3f seconds\\n\\n\", time_fd[\"sys.self\"]))\nNA   System time:  0.181 seconds\n\n\n# Compare spatially\ndem_100m   = terra::rast(\"../assets/TIF/dem_chilwa_00_raw.tif\")\ndem_breach_fd = terra::rast(\"../assets/TIF/dem_chilwa_01_breached.tif\")\ndem_breach_wb = terra::rast(\"../assets/TIF/dem_chilwa_11_breached_flat.tif\")\ndem_breach_diff_fd &lt;- dem_100m - dem_breach_fd\ndem_breach_diff_wb &lt;- dem_100m - dem_breach_wb\ndem_breach_diff_fd[dem_breach_diff_fd == 0] &lt;- NA\ndem_breach_diff_wb[dem_breach_diff_wb == 0] &lt;- NA\n\ntmap::tmap_mode(\"view\")\ntmap::tm_shape(dem_breach_diff_fd) + tmap::tm_raster(values=\"Blues\", title = \"Change (m)\",\n    breaks = c(-400, -100, -10, 0, 10, 100, 400),\n    labels = c(\"-400 to -100\", \"-100 to -10\", \"-10 to 0\", \"0 to 10\", \"10 to 100\", \"&gt;100\")) +\n  tmap::tm_layout(legend.text.size = 0.5, legend.title.size = 0.7) +\n  tmap::tm_scalebar(position=c(\"RIGHT\", \"BOTTOM\"), text.size = .5) +\n#  tmap::tm_compass(color.dark=\"gray60,position=c(\"RIGHT\", \"top\")) +\n#  tmap::tm_graticules(lines=T,labels.rot=c(0,90),lwd=0.2) +\n  tmap::tm_title(\"Breaching Effects (Barnes, 2016)\", size=.8) -&gt; tm_breach_fd\n\ntmap::tm_shape(dem_breach_diff_wb) + tmap::tm_raster(values=\"Blues\", title = \"Change (m)\",\n    breaks = c(-400, -100, -10, 0, 10, 100, 400),\n    labels = c(\"-400 to -100\", \"-100 to -10\", \"-10 to 0\", \"0 to 10\", \"10 to 100\", \"&gt;100\")) +\n  tmap::tm_layout(legend.text.size = 0.5, legend.title.size = 0.7) +  \n  tmap::tm_scalebar(position=c(\"RIGHT\", \"BOTTOM\"), text.size = .5) +\n#  tmap::tm_compass(color.dark=\"gray60\",position=c(\"RIGHT\", \"top\")) +\n#  tmap::tm_graticules(lines=T,labels.rot=c(0,90),lwd=0.2) +\n  tmap::tm_title(\"Breaching Effects (Lindsay, 2016a)\", size=.8) -&gt; tm_breach_wb\n\ntmap::tmap_arrange(tm_breach_fd, tm_breach_wb, nrow=1)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 2b: Maps comparing effects of breaching algorithms (Barnes, 2016; Lindsay, 2016). Both algorithms target similar depression features but with different modification magnitudes controlled by respective parameters.\nTable 2a: Runtime comparison of breaching algorithms applied to Lake Chilwa watershed DEM (100m resolution, ~1.3M cells)\n\n\nMetric\nWhitebox\nflowdem\nPerformance Ratio\n\n\n\nElapsed time\n2.30s\n8.83s\n3.8× faster\n\n\nUser CPU time\n0.01s\n8.59s\n859× faster\n\n\nSystem time\n0.01s\n0.21s\n21× faster\n\n\n\nThe performance advantage of whitebox likely reflects architectural differences: WhiteboxTools implements breaching in compiled C++ with optimized spatial indexing, while flowdem wraps RichDEM operations through R interfaces that incur marshalling overhead. The high user CPU time in flowdem (97% of elapsed time) suggests computational delays in the R-wrapped priority-flood implementation, whereas whitebox delegates processing to external compiled binaries with minimal R overhead (0.4% of elapsed time).\nDespite longer execution times, flowdem’s parameter-free interface eliminates decisions about depth thresholds and flat increments, potentially reducing workflow development time for exploratory analyses. For production workflows requiring repeated processing or large spatial extents (&gt;10M cells), whitebox’s computational efficiency becomes increasingly critical.\nBoth algorithms targeted similar depression features across the study area (Figure 2b), though with different modification patterns. Whitebox’s max_depth constraint preserved deeper basin structures (&gt;3m) while breaching shallow artifacts, producing elevation changes ranging from -10m to +10m in modified areas. Flowdem’s uniform breaching approach modified a broader spatial extent without depth discrimination, resulting in elevation changes up to ±100m in some locations. The hybrid nature of Lindsay’s algorithm, which combines selective breaching with subsequent filling, highlights whitebox’s more conservative modifications. In contrast, the priority-flood approach in RichDEM implements aggressive breaching to ensure complete depression removal (Barnes et al., 2014), which may be undesirable when preserving hydrological features like endorheic basins.\n2.3.2 Depression Filling\nFollowing breaching, remaining flat areas require treatment to ensure continuous flow paths. This step is particularly critical for endorheic basins like Lake Chilwa, where water accumulates through inflow and evaporation without surface outflow. Standard watershed algorithms typically assume exorheic drainage systems with defined outlet points (O’Callaghan & Mark, 1984; Wu et al., 2015). For closed basins, depression filling must preserve the terminal sink while ensuring flow connectivity throughout the contributing watershed.\nflowdem implementation uses epsilon-gradient filling via fill(epsilon=T). This function adds infinitesimal elevation increments (typically 10⁻⁶ to 10⁻⁴ m) to flat surfaces, ensuring strict monotonic descent along flow paths (Barnes et al., 2014). The epsilon value also prevents ambiguous flow directions in perfectly flat terrain common to marshland environments surrounding endorheic lakes. Critically, the algorithm preserves major depressions like Lake Chilwa while establishing flow pathways toward this terminal sink.\nwhitebox implementation applies the scan-line algorithm (Wang & Liu, 2006) via wbt_fill_depressions_wang_and_liu() function. This method uses an efficient line-by-line approach optimized for low-relief terrain, filling remaining depressions after the initial breaching operation. When combined with conservative breaching (max_depth=3m), this two-step approach maintains the integrity of genuine hydrological features while removing artifacts that would fragment the drainage network.\nThe challenge for endorheic systems is distinguishing between genuine terminal sinks requiring preservation and spurious depressions requiring removal. Our approach addresses this through:\n\nConservative breaching: Using depth constraints to preserve deep basins while removing shallow artifacts\nSelective filling: Applying fill operations to remaining flat areas without eliminating the primary drainage terminus\nFlow direction validation: Ensuring all cells establish flow paths toward the identified terminal sink\n\nThis conditioning strategy enables subsequent flow accumulation to correctly identify Lake Chilwa as the watershed’s convergence point rather than fragmenting drainage into multiple isolated depressions.\n\n# Compare filling algorithms \ntime_wb &lt;- system.time({\n  whitebox::wbt_fill_depressions_wang_and_liu(\n  dem    = \"dem_chilwa_11_breached_flat.tif\",\n  output = \"dem_chilwa_12_filled_wang.tif\",\n  wd     = \"../assets/TIF/\")\n})\n\ntime_fd &lt;- system.time({\n  dem_fill_fd &lt;- flowdem::fill(\n    terra::rast(\"../assets/TIF/dem_chilwa_00_raw.tif\"), epsilon=T)\n  terra::writeRaster(dem_fill_fd, overwrite = T,\n    \"../assets/TIF/dem_chilwa_02_filled.tif\")\n})\n\n# Compare runtimes\ncat(\"\\n=== Runtime Comparison ===\\n\")\nNA \nNA === Runtime Comparison ===\ncat(\"Whitebox fill:\\n\")\nNA Whitebox fill:\ncat(sprintf(\"  Elapsed time: %.3f seconds\\n\", time_wb[\"elapsed\"]))\nNA   Elapsed time: 1.930 seconds\ncat(sprintf(\"  User time:    %.3f seconds\\n\", time_wb[\"user.self\"]))\nNA   User time:    0.008 seconds\ncat(sprintf(\"  System time:  %.3f seconds\\n\\n\", time_wb[\"sys.self\"]))\nNA   System time:  0.006 seconds\n\ncat(\"flowdem fill:\\n\")\nNA flowdem fill:\ncat(sprintf(\"  Elapsed time: %.3f seconds\\n\", time_fd[\"elapsed\"]))\nNA   Elapsed time: 3.411 seconds\ncat(sprintf(\"  User time:    %.3f seconds\\n\", time_fd[\"user.self\"]))\nNA   User time:    3.362 seconds\ncat(sprintf(\"  System time:  %.3f seconds\\n\\n\", time_fd[\"sys.self\"]))\nNA   System time:  0.044 seconds\n\n# Compare spatially\ndem_100m   = terra::rast(\"../assets/TIF/dem_chilwa_00_raw.tif\")\ndem_fill_fd = terra::rast(\"../assets/TIF/dem_chilwa_02_filled.tif\")\ndem_fill_wb = terra::rast(\"../assets/TIF/dem_chilwa_12_filled_wang.tif\")\ndem_fill_diff_fd &lt;- dem_100m - dem_fill_fd\ndem_fill_diff_wb &lt;- dem_100m - dem_fill_wb\ndem_fill_diff_fd[dem_fill_diff_fd == 0] &lt;- NA\ndem_fill_diff_wb[dem_fill_diff_wb == 0] &lt;- NA\n\ntmap::tmap_mode(\"view\")\ntmap::tm_shape(dem_fill_diff_fd) + tmap::tm_raster(\n  palette = \"pi_yg\",, title = \"Change (m)\", midpoint = 0,\n  breaks = c(-400, -100, -10, 0, 10, 100, 400),\n  labels = c(\"-400 to -100\", \"-100 to -10\", \"-10 to 0\", \"0 to 10\", \"10 to 100\", \"&gt;100\")) +\n  tmap::tm_scalebar(position=c(\"RIGHT\", \"BOTTOM\"), text.size = .5) +\n  tmap::tm_layout(legend.text.size = 0.5, legend.title.size = 0.7) +\n#  tmap::tm_compass(color.dark=\"gray60\",position=c(\"RIGHT\", \"top\")) +\n#  tmap::tm_graticules(lines=T,labels.rot=c(0,90),lwd=0.2) +\n  tmap::tm_title(\"Filling Effects (Barnes, 2016)\", size=.8) -&gt; tm_fill_fd\n\ntmap::tm_shape(dem_fill_diff_wb) + tmap::tm_raster(\n  palette = \"pi_yg\",, title = \"Change (m)\", midpoint = 0,\n  breaks = c(-400, -100, -10, 0, 10, 100, 400),\n  labels = c(\"-400 to -100\", \"-100 to -10\", \"-10 to 0\", \"0 to 10\", \"10 to 100\", \"&gt;100\")) +\n  tmap::tm_layout(legend.text.size = 0.5, legend.title.size = 0.7) +\n  tmap::tm_scalebar(position=c(\"RIGHT\", \"BOTTOM\"), text.size = .5) +\n#  tmap::tm_compass(color.dark=\"gray60\",position=c(\"RIGHT\", \"top\")) +\n#  tmap::tm_graticules(lines=T,labels.rot=c(0,90),lwd=0.2) +\n  tmap::tm_title(\"Filling Effects (Wang & Liu, 2006)\", size=.8) -&gt; tm_fill_wb\n\ntmap::tmap_arrange(tm_fill_fd, tm_fill_wb, nrow=1)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 2c: Interactive maps comparing effects of filling algorithms (Lindsay, 2016; Wang & Liu, 2006).\nDepression filling showed similar performance patterns to breaching (Table 2a). Whitebox completed filling in 2.0 seconds compared to 3.4 seconds for flowdem, representing a 1.7× speedup. Both algorithms maintained low system overhead, though flowdem again showed higher user CPU consumption.\nTable 2b: Runtime comparison of filling algorithms\n\n\nMetric\nWhitebox\nflowdem\nPerformance Ratio\n\n\n\nElapsed time\n2.01s\n3.42s\n1.7× faster\n\n\nUser CPU time\n0.01s\n3.36s\n336× faster\n\n\nSystem time\n0.01s\n0.05s\n5× faster\n\n\n\nThe more modest performance difference compared to breaching (1.7× vs 3.8×) suggests Wang and Liu’s scan-line algorithm and RichDEM’s epsilon-gradient method have comparable computational complexity, with efficiency differences primarily attributable to implementation architecture rather than algorithmic approaches.\nBoth filling algorithms effectively smoothed flat areas while preserving Lake Chilwa’s endorheic basin structure (Figure 2c). Whitebox modifications concentrated along identified flat areas with conservative elevation adjustments (-10m to +10m), while flowdem produced more extensive modifications (up to ±100m) across broader spatial extents. The resulting elevation models from both methods achieved hydrological connectivity, though through different numerical pathways.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Watersheds</span>"
    ]
  },
  {
    "objectID": "02-watersheds/index.html#flow-accumulation",
    "href": "02-watersheds/index.html#flow-accumulation",
    "title": "Watersheds",
    "section": "2.4 Flow Accumulation",
    "text": "2.4 Flow Accumulation\nFlow routing was calculated using the D8 method applied in the flowdem::dirs() and whitebox::wbt_d8_pointer() functions. The D8 single-flow-direction algorithm (O’Callaghan & Mark, 1984) routes flow from each cell to its steepest downslope neighbor among eight adjacent cells. Flow direction pointers are then used to compute flow accumulation values, which represent the number of upstream cells contributing flow to each location. At 100m resolution, each cell represents 0.01 km² (1 hectare) of contributing area, enabling direct conversion between cell counts and drainage area in km².\nFlow accumulation calculations reveal critical differences between workflows. Whitebox achieves maximum accumulation of 1,152,591 cells (11,526 km²), indicating successful watershed-scale convergence to Lake Chilwa. In contrast, flowdem produces maximum accumulation of only 5,017 cells (50.2 km²), suggesting potential flow routing issues or incomplete drainage network development. This 230× difference warrants investigation, as both workflows used identical D8 algorithms and spatial resolution.\nRuntime performance shows comparable efficiency: whitebox completes flow direction and accumulation in 2.0 seconds versus 2.8 seconds for flowdem, indicating both implementations efficiently handle D8 calculations at 100m resolution across the study extent.\n\ntime_wb &lt;- system.time({\n  whitebox::wbt_d8_pointer(\n  dem = \"dem_chilwa_12_filled_wang.tif\",\n  output = \"dem_chilwa_13_flow_direction_D8.tif\",\n  wd = \"../assets/TIF/\")\n  whitebox::wbt_d8_flow_accumulation(\n  input = \"dem_chilwa_13_flow_direction_D8.tif\", \n  output= \"dem_chilwa_14_flow_accumulation_D8.tif\",\n  wd    = \"../assets/TIF/\", pntr=T)\n  })\n\ntime_fd &lt;- system.time({\n  dem_dir_fd &lt;- flowdem::dirs(\n    terra::rast(\"../assets/TIF/dem_chilwa_02_filled.tif\"), mode=\"d8\")\n  dem_acc_fd &lt;- flowdem::accum(dem_dir_fd, mode=\"d8\")\n  terra::writeRaster(dem_dir_fd, overwrite=T,\n    \"../assets/TIF/dem_chilwa_03_flow_direction.tif\")\n  terra::writeRaster(dem_acc_fd, overwrite=T, \n  \"../assets/TIF/dem_chilwa_04_flow_accumulation.tif\")\n  })\n\n# Compare runtimes\ndem_acc_fd = terra::rast(\"../assets/TIF/dem_chilwa_04_flow_accumulation.tif\")\ndem_acc_wb = terra::rast(\"../assets/TIF/dem_chilwa_14_flow_accumulation_D8.tif\")\n\ncat(\"\\n=== Runtime Comparison ===\\n\")\nNA \nNA === Runtime Comparison ===\ncat(\"whitebox flow directions:\\n\")\nNA whitebox flow directions:\ncat(sprintf(\"  Elapsed time: %.3f seconds\\n\", time_wb[\"elapsed\"]))\nNA   Elapsed time: 2.023 seconds\ncat(sprintf(\"  User time:    %.3f seconds\\n\", time_wb[\"user.self\"]))\nNA   User time:    0.016 seconds\ncat(sprintf(\"  System time:  %.3f seconds\\n\\n\", time_wb[\"sys.self\"]))\nNA   System time:  0.013 seconds\n\ncat(\"flowdem flow directions:\\n\")\nNA flowdem flow directions:\ncat(sprintf(\"  Elapsed time: %.3f seconds\\n\", time_fd[\"elapsed\"]))\nNA   Elapsed time: 2.862 seconds\ncat(sprintf(\"  User time:    %.3f seconds\\n\", time_fd[\"user.self\"]))\nNA   User time:    2.791 seconds\ncat(sprintf(\"  System time:  %.3f seconds\\n\\n\", time_fd[\"sys.self\"]))\nNA   System time:  0.066 seconds\n\ncat(\"whitebox flow accumulation:\\n\")\nNA whitebox flow accumulation:\ncat(\"Minimum:\", min(values(dem_acc_wb), na.rm = TRUE),\"cells\\n\") \nNA Minimum: 1 cells\ncat(\"Median:\", median(values(dem_acc_wb), na.rm =TRUE), \"cells\\n\") \nNA Median: 2 cells\ncat(\"Maximum:\", max(values(dem_acc_wb), na.rm= TRUE), \"cells\\n\") \nNA Maximum: 1152591 cells\ncat(\"Max contributing area:\", round(max(values(dem_acc_wb), na.rm=T) * 0.01, 1), \"km²\\n\")\nNA Max contributing area: 11526 km²\n\ncat(\"flowdem flow accumulation:\\n\")\nNA flowdem flow accumulation:\ncat(\"Minimum:\", min(values(dem_acc_fd), na.rm = TRUE),\"cells\\n\") \nNA Minimum: 1 cells\ncat(\"Median:\", median(values(dem_acc_fd), na.rm =TRUE), \"cells\\n\") \nNA Median: 1 cells\ncat(\"Maximum:\", max(values(dem_acc_fd), na.rm= TRUE), \"cells\\n\") \nNA Maximum: 5017 cells\ncat(\"Max contributing area:\", round(max(values(dem_acc_fd), na.rm=T) * 0.01, 1), \"km²\\n\")\nNA Max contributing area: 50.2 km²\n\ntmap::tmap_mode(\"view\")\ntmap::tm_shape(dem_acc_wb) + tmap::tm_raster(\n  values=\"OrRd\", title = \"Flow Acc.\\n(whitebox)\",\n  breaks = c(1, 2, 3, 5, 10, 50, 100, 1000, 1200000),\n  labels = c(\"1-2\", \"2-3\", \"3-5\", \"5-10\", \"10-50\", \"50-100\", \"100-1K\", \"&gt;1K\")) +\n  tmap::tm_shape(lake) + tmap::tm_polygons(fill = \"turquoise\", lwd = 2) +  \n#  tmap::tm_scalebar(position=c(\"RIGHT\", \"BOTTOM\"), text.size = .5) +\n#  tmap::tm_compass(color.dark=\"gray60\",position=c(\"RIGHT\", \"top\")) +\n#  tmap::tm_graticules(lines=T,labels.rot=c(0,90),lwd=0.2) +\n  tmap::tm_layout(legend.text.size = 0.5, legend.title.size = 0.7) -&gt; tm_acc_wb\n\ntmap::tm_shape(dem_acc_fd) + tmap::tm_raster(\n  values=\"OrRd\", title = \"Flow Acc. \\n(flowdem)\",\n  breaks = c(1, 2, 3, 5, 10, 50, 100, 1000, 1200000),\n  labels = c(\"1-2\", \"2-3\", \"3-5\", \"5-10\", \"10-50\", \"50-100\", \"100-1K\", \"&gt;1K\")) +\n  tmap::tm_shape(lake) + tmap::tm_polygons(fill = \"turquoise\", lwd = 2) +  \n#  tmap::tm_scalebar(position=c(\"RIGHT\", \"BOTTOM\"), text.size = .5) +\n#  tmap::tm_compass(color.dark=\"gray60\",position=c(\"RIGHT\", \"top\")) +\n#  tmap::tm_graticules(lines=T,labels.rot=c(0,90),lwd=0.2) +\n  tmap::tm_layout(legend.text.size = 0.5, legend.title.size = 0.7) -&gt; tm_acc_fd\n\ntmap::tmap_arrange(tm_acc_wb, tm_acc_fd, nrow=1)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 2d: Maps comparing flow accumulation results derived from whitebox (left) and flowdem workflows (right).",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Watersheds</span>"
    ]
  },
  {
    "objectID": "02-watersheds/index.html#stochastic-depression-analysis",
    "href": "02-watersheds/index.html#stochastic-depression-analysis",
    "title": "Watersheds",
    "section": "2.5 Stochastic Depression Analysis",
    "text": "2.5 Stochastic Depression Analysis\nGiven the technical challenges of delineating endorheic watersheds without surface outflows, we apply several additional checks below. Specifically, we attempt to characterize depression structures with complementary topographic metrics to account for DEM uncertainty. Specific to this study area, the stochastic approach provides necessary confidence estimates for depression features, which is critical for distinguishing Lake Chilwa’s genuine endorheic basin from spurious artifacts.\nSurface depressions in DEMs contain inherent uncertainty from acquisition artifacts, interpolation errors, and measurement precision limitations. The Stochastic Depression Analysis Tool developed in the whitebox library (Lindsay & Creed, 2005) maps topographic depressions while accounting for uncertainty in depression shape resulting from DEM error (Lindsay & Creed, 2006).\nThe tool uses a Monte Carlo approach where each grid cell follows a Gaussian error probability distribution function (PDF) with mean of zero and standard deviation equal to the LiDAR RMSE. For our 100m DEM derived from multiple sources, we estimate RMSE conservatively at 3m based on vertical accuracy specifications for SRTM data.\nWe apply 50 iterations following established protocols (Lindsay & Creed, 2005). With each iteration, random samples are drawn from the Gaussian error PDF and added to the original DEM. Depressions in the error-added DEM are filled using Wang and Liu’s efficient algorithm (Wang & Liu, 2006), and affected cells are flagged cumulatively. We classify depressions appearing in ≥80% of iterations as “true depressions” following Lindsay & Creed (Lindsay & Creed, 2006), providing 95% confidence that identified features are not artifacts of DEM error.\n\n# Compute uncertainty using raw and conditioned DEMs\nwhitebox::wbt_stochastic_depression_analysis(\n  dem = \"dem_chilwa_00_raw.tif\",\n  output = \"dem_chilwa_15a_depressions_prob.tif\",\n  wd = \"../assets/TIF/\",\n  rmse = 3.0,\n  range = 10.0,\n  iterations = 50\n)\n\n# Derive binary mask from probability of sinks (~20-80%)\nsink_prob = terra::rast(\"../assets/TIF/dem_chilwa_15a_depressions_prob.tif\")\nsink_mask_Q1 = sink_prob &gt;= 0.2\nsink_mask_Q2 = sink_prob &gt;= 0.4\nsink_mask_Q3 = sink_prob &gt;= 0.6\nsink_mask_Q4 = sink_prob &gt;= 0.8\nsink_mask_Q1[sink_mask_Q1 == 0] &lt;- NA\nsink_mask_Q2[sink_mask_Q2 == 0] &lt;- NA\nsink_mask_Q3[sink_mask_Q3 == 0] &lt;- NA\nsink_mask_Q4[sink_mask_Q4 == 0] &lt;- NA\n\nterra::writeRaster(sink_mask_Q1, overwrite = TRUE,\n  \"../assets/TIF/dem_chilwa_15a_depressions_Q1.tif\")\nterra::writeRaster(sink_mask_Q2, overwrite = TRUE,\n  \"../assets/TIF/dem_chilwa_15a_depressions_Q2.tif\")\nterra::writeRaster(sink_mask_Q3, overwrite = TRUE,\n  \"../assets/TIF/dem_chilwa_15a_depressions_Q3.tif\")\nterra::writeRaster(sink_mask_Q4, overwrite = TRUE,\n  \"../assets/TIF/dem_chilwa_15a_depressions_Q4.tif\")\n\ntmap::tmap_mode(\"plot\")\ntmap::tm_shape(sink_mask_Q1) + tmap::tm_raster(\n  values=\"Greens\", title = \"Predicted Sinks (&gt;0.2)\") +\n  tmap::tm_shape(lake) + tmap::tm_polygons(fill = \"turquoise\", lwd = 2) +  \n  tmap::tm_scalebar(position=c(\"RIGHT\", \"BOTTOM\"), text.size = .5) +\n  tmap::tm_compass(color.dark=\"gray60\",position=c(\"RIGHT\", \"top\")) +\n  tmap::tm_graticules(lines=T,labels.rot=c(0,90),lwd=0.2) +\n  tmap::tm_layout(legend.text.size = 0.5, legend.title.size = 0.7) -&gt; tm_sink_mask_Q1\n\ntmap::tm_shape(sink_mask_Q2) + tmap::tm_raster(\n  values=\"Greens\", title = \"Predicted Sinks (&gt;0.4)\") +\n  tmap::tm_shape(lake) + tmap::tm_polygons(fill = \"turquoise\", lwd = 2) +  \n  tmap::tm_scalebar(position=c(\"RIGHT\", \"BOTTOM\"), text.size = .5) +\n  tmap::tm_compass(color.dark=\"gray60\",position=c(\"RIGHT\", \"top\")) +\n  tmap::tm_graticules(lines=T,labels.rot=c(0,90),lwd=0.2) +\n  tmap::tm_layout(legend.text.size = 0.5, legend.title.size = 0.7) -&gt; tm_sink_mask_Q2\n\ntmap::tm_shape(sink_mask_Q3) + tmap::tm_raster(\n  values=\"Greens\", title = \"Predicted Sinks (&gt;0.6)\") +\n  tmap::tm_shape(lake) + tmap::tm_polygons(fill = \"turquoise\", lwd = 2) +  \n  tmap::tm_scalebar(position=c(\"RIGHT\", \"BOTTOM\"), text.size = .5) +\n  tmap::tm_compass(color.dark=\"gray60\",position=c(\"RIGHT\", \"top\")) +\n  tmap::tm_graticules(lines=T,labels.rot=c(0,90),lwd=0.2) +\n  tmap::tm_layout(legend.text.size = 0.5, legend.title.size = 0.7) -&gt; tm_sink_mask_Q3\n\ntmap::tm_shape(sink_mask_Q4) + tmap::tm_raster(\n  values=\"Greens\", title = \"Predicted Sinks (&gt;0.8)\") +\n  tmap::tm_shape(lake) + tmap::tm_polygons(fill = \"turquoise\", lwd = 2) +  \n  tmap::tm_scalebar(position=c(\"RIGHT\", \"BOTTOM\"), text.size = .5) +\n  tmap::tm_compass(color.dark=\"gray60\",position=c(\"RIGHT\", \"top\")) +\n  tmap::tm_graticules(lines=T,labels.rot=c(0,90),lwd=0.2) +\n  tmap::tm_layout(legend.text.size = 0.5, legend.title.size = 0.7) -&gt; tm_sink_mask_Q4\n\ntmap::tmap_arrange(\n  tm_sink_mask_Q4, \n  tm_sink_mask_Q3, \n  tm_sink_mask_Q2, \n  tm_sink_mask_Q1, \n  nrow=2\n  )\n\n\n\n\n\n\n\nFigure 2e: Maps comparing thresholds of sink probabilities derived from Monte Carlo simulation of Gaussian distribution (Lindsay & Creed, 2005)\n2.5.1 Sink Depth and Wetness\nBuilding on stochastic depression identification, we quantify two complementary metrics:\n\n\nSink depth - vertical distance from each cell to spillover point\n\nTopographic wetness index (TWI) - water accumulation potential based on upslope contributing area and local slope\n\nSink depth uses the raw DEM to preserve actual depression depths below spillover points. TWI calculation uses the conditioned DEM and flow accumulation to ensure topologically consistent routing. Together with stochastic mapping, these metrics characterize spatial extent and hydrological characteristics needed to identify terminal drainage points for watershed delineation.\n\n\n\n\n\n\nTip\n\n\n\nWhen visually checking results in interactive mapping below, try switching a single layer off using top left drop down button in interactive map windows. Toggling between a stack rasters like this enables quick identification of discrepancies derived from candidate algorithms.\n\n\n\n# Calulcate depth of sinks\nwhitebox::wbt_depth_in_sink(\n  dem = \"dem_chilwa_00_raw.tif\",\n  output = \"dem_chilwa_15_sink_depth.tif\", \n  wd = \"../assets/TIF/\",\n  zero_background = F\n)\n\n# Calculate topographic wetness index \nwhitebox::wbt_wetness_index(\n  sca = \"dem_chilwa_14_flow_accumulation_D8.tif\",\n  slope = \"dem_chilwa_12_filled_wang.tif\",  \n  output = \"dem_chilwa_16_wetness_index.tif\",\n  wd = \"../assets/TIF/\"\n)\n\nsink_depth &lt;- terra::rast(\"../assets/TIF/dem_chilwa_15_sink_depth.tif\")\nwetness_idx &lt;- terra::rast(\"../assets/TIF/dem_chilwa_16_wetness_index.tif\")\nflow_accum &lt;- terra::rast(\"../assets/TIF/dem_chilwa_14_flow_accumulation_D8.tif\")\n\ntmap::tmap_mode(\"view\")\ntmap::tm_shape(sink_depth) + tmap::tm_raster(values = \"steelblue\", \n  alpha=1, title = \"Sink Depths\", style = \"quantile\", n=7) +\n  tmap::tm_shape(wetness_idx) + tmap::tm_raster(values=\"darkgreen\", \n  alpha=1, title=\"Wetness Index\", style = \"quantile\", n=7) +\n  tmap::tm_shape(lake) + tmap::tm_borders(col = \"turquoise\", lwd = 2) +\n  tmap::tm_layout(legend.text.size = 0.8, legend.title.size = 1)\n\n\n\n\n\n\npar(mfrow = c(1, 2))\nhist(sink_depth[sink_depth &lt;= 25], breaks = 30,\n     main = \"Depths 0-10m\", xlab = \"Depth (m)\", col = \"steelblue\")\nhist(values(wetness_idx), breaks = 50, xlab = \"TWI Value\", \n     main = \"Topographic Wetness Index\", col = \"darkgreen\")\n\n\n\n\n\n\n\nFigure 2f: Depression sink depths and their surrounding topographic wetness index scores.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Watersheds</span>"
    ]
  },
  {
    "objectID": "02-watersheds/index.html#terminal-pour-points",
    "href": "02-watersheds/index.html#terminal-pour-points",
    "title": "Watersheds",
    "section": "2.6 Terminal Pour Points",
    "text": "2.6 Terminal Pour Points\nEndorheic basins require identification of terminal drainage points representing the ultimate destination of surface flow (Lehner et al., 2022; Zhang et al., 2020) (Li et al., 2025). Unlike exorheic systems with defined outlet pour points, closed basins necessitate locating the convergence point of all inflowing drainage.\nWe identify terminal points adjacent to maximum flow accumulation within the Lake Chilwa basin. Flow accumulation analysis reveals a critical difference between workflows: whitebox achieves maximum accumulation of 1,152,591 cells (11,526 km²), indicating successful watershed-scale convergence, while flowdem produces only 5,017 cells (50.2 km²), suggesting incomplete drainage network development. This 230-fold discrepancy indicates the flowdem workflow requires troubleshooting before terminal point identification.\nProceeding with the whitebox-derived flow accumulation, we locate terminal points where convergence exceeds 1,000,000 cells, confirming watershed-scale drainage integration (Figure 2g). We test both single-point and multi-point configurations to assess delineation sensitivity to outlet placement in flat terrain. Points are digitized interactively using the flow accumulation raster as reference, positioning outlets at local maxima within the lake basin where multiple drainage pathways converge. The multi-point configuration places four terminal points around the lake perimeter to capture distributed inflow patterns characteristic of endorheic systems with extensive shallow margins.\nTerminal points were identified through the following workflow: \n\nVisual inspection: Examine flow accumulation raster to identify convergence zones exceeding 1,000,000 cells\nPoint placement: Use mapedit::editMap() to enable rapid digitization of pour points at accumulation maxima\nMulti-point validation: Add supplementary points around lake perimeter to test sensitivity to outlet configuration\nReproducibility: Save point locations as shapefiles for workflow replication\n\nThe resulting terminal points establish the drainage terminus for watershed delineation, enabling the flowdem::watershed() function to trace all contributing areas converging on Lake Chilwa.\n\n# Inputs\ndem_acc = terra::rast(\"../assets/TIF/dem_chilwa_14_flow_accumulation.tif\")\nstreams = dem_acc &gt;= 1000 \nstreams[streams == 0] &lt;- NA \n\n# Manually derive terminal pour points\noutlets = mapedit::editMap(mapview::mapView(dem_acc)) \noutlets = outlets$all |&gt; # convert to sf\n  sf::st_transform(crs_master) |&gt;\n  dplyr::select(geometry)\noutlets$id &lt;- \"terminal_flow\"\n\noutlets_add = mapedit::editMap(mapview::mapView(dem_acc)) \noutlets_add = outlets_add$all |&gt; # convert to sf\n  sf::st_transform(crs_master) |&gt;\n  dplyr::select(geometry)\noutlets_add$id &lt;- \"terminal_flow\"\n\n# Outputs\nsf::st_write(outlets, \"../assets/SHP/outlets.shp\", delete_layer=T, quiet=T)\nsf::st_write(outlets_add, \"../assets/SHP/outlets_multiple.shp\", delete_layer=T)\n\n# Visualize\ntmap::tmap_mode(\"view\")\ntmap::tm_shape(lake) + tmap::tm_borders(col=\"royalblue\") +\n  tmap::tm_shape(outlets) + tmap::tm_symbols(shape=\"id\",fill=\"orange\", size=0.8) +\n  tmap::tm_shape(streams) + tmap::tm_raster(values=\"brewer.reds\")\n\n\nNA Reading layer `watershed_chilwa_05_flowdem' from data source `/Users/seamus/repos/map-templates/assets/SHP/watershed_chilwa_05_flowdem.shp' \nNA   using driver `ESRI Shapefile'\nNA Simple feature collection with 1 feature and 1 field\nNA Geometry type: POLYGON\nNA Dimension:     XY\nNA Bounding box:  xmin: 3910000 ymin: -1790000 xmax: 4040000 ymax: -1660000\nNA Projected CRS: WGS 84 / Pseudo-Mercator\nNA Reading layer `outlets_multiple' from data source \nNA   `/Users/seamus/repos/map-templates/assets/SHP/outlets_multiple.shp' \nNA   using driver `ESRI Shapefile'\nNA Simple feature collection with 4 features and 1 field\nNA Geometry type: POINT\nNA Dimension:     XY\nNA Bounding box:  xmin: 3970000 ymin: -1740000 xmax: 3990000 ymax: -1720000\nNA Projected CRS: WGS 84 / Pseudo-Mercator\n\n\n\n\n\n\nFigure 2g: Terminal pour points positioned at maximum flow accumulation within Lake Chilwa basin.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Watersheds</span>"
    ]
  },
  {
    "objectID": "02-watersheds/index.html#watershed-delineation",
    "href": "02-watersheds/index.html#watershed-delineation",
    "title": "Watersheds",
    "section": "2.7 Watershed Delineation",
    "text": "2.7 Watershed Delineation\nWe delineate the watershed using flowdem::watershed() polygon-based approach, which differs from traditional point-based methods by using the entire lake perimeter as drainage terminus. For spatially extensive terminal sinks such as Lake Chilwa, this function better captures multiple convergent flow paths around the perimeter than a single pour point.\nThe resulting watershed represents the complete catchment draining to Lake Chilwa through D8-identified surface flow pathways. Post-processing converts the raster watershed output to vector format for integration with other spatial datasets and area calculations. For validation purposes, we present below these flowdem watershed and stream outputs below alongside shapefiles downlaoded externally from OpenTopography collections global datasets.\n\n# Inputs\ndem_dir         = terra::rast(\"../assets/TIF/dem_chilwa_03_flow_direction.tif\")\ndem_acc         = terra::rast(\"../assets/TIF/dem_chilwa_14_flow_accumulation.tif\")\nstreams_test    = sf::st_read(\"../assets/inputs/rivers_site.shp\") \nwatershed_test  = sf::st_read(\"../assets/inputs/watershed_site.shp\")\n\n# Delineate flowdem streams\nstreams = dem_acc &gt;= 1000 \nstreams[streams == 0] &lt;- NA \n\n# Delineate flowdem watershed \nwatershed = flowdem::watershed(dem_dir, lake) |&gt;\n  terra::as.polygons() |&gt;\n  sf::st_as_sf()\nstreams = terra::crop(\n  streams, watershed, mask=T)\n\n# Visual check\ntmap::tmap_mode(\"view\")\ntmap::tm_shape(watershed) + tmap::tm_borders(col = \"blue\", lwd = 2) +\n  tmap::tm_shape(streams) + tmap::tm_lines(col = \"royalblue\", lwd=0.8) +\n  tmap::tm_shape(lake) + tmap::tm_polygons(fill = \"royalblue\") +\n  #tmap::tm_scalebar(position=c(\"RIGHT\", \"BOTTOM\"), text.size = .5) +\n  #tmap::tm_compass(color.dark=\"gray60\",position=c(\"RIGHT\", \"top\")) +\n  #tmap::tm_graticules(lines=T,labels.rot=c(0,90),lwd=0.2) +\n  tmap::tm_title(\"Watershed & Streams (Flowdem)\", size=0.8) + \n  tmap::tm_layout(legend.text.size = 0.5, legend.title.size = 0.7) -&gt; tm_watershed_fd\n\ntmap::tm_shape(watershed_test) + tmap::tm_borders(col = \"blue\", lwd = 2) +\n  tmap::tm_shape(streams_test) + tmap::tm_lines(col = \"royalblue\", lwd=0.8) +\n  tmap::tm_shape(lake) + tmap::tm_polygons(fill = \"royalblue\") +\n  #tmap::tm_scalebar(position=c(\"RIGHT\", \"BOTTOM\"), text.size = .5) +\n  #tmap::tm_compass(color.dark=\"gray60\",position=c(\"RIGHT\", \"top\")) +\n  #tmap::tm_graticules(lines=T,labels.rot=c(0,90),lwd=0.2) +\n  tmap::tm_title(\"Watershed & Streams (OpenTopography)\", size=0.8) + \n  tmap::tm_layout(legend.text.size = 0.5, legend.title.size = 0.7) -&gt; tm_watershed_test\ntmap::tmap_arrange(tm_watershed_fd, tm_watershed_test, nrow=1)\n\n# Outputs\nsf::st_write(watershed, \"../assets/SHP/watershed_chilwa_05_flowdem.shp\", delete_dsn=T)\nterra::writeRaster(streams, \"../assets/TIF/streams_chilwa_20a_flowdem.tif\", overwrite=T)\n#sf::st_write(streams, \"../assets/SHP/streams_chilwa_20a_flowdem.shp\", delete_dsn=T)\nwhitebox::wbt_raster_streams_to_vector(\n   streams = \"streams_chilwa_20a_flowdem.tif\",\n   d8_pntr = \"dem_chilwa_13_flow_direction_D8.tif\",\n   output = \"../assets/SHP/streams_chilwa_20a_flowdem.shp\",\n   wd = \"../assets/TIF/\")\n\n\nNA Reading layer `streams_chilwa_20a_flowdem' from data source \nNA   `/Users/seamus/repos/map-templates/assets/SHP/streams_chilwa_20a_flowdem.shp' \nNA   using driver `ESRI Shapefile'\nNA Simple feature collection with 6886 features and 1 field\nNA Geometry type: MULTILINESTRING\nNA Dimension:     XY\nNA Bounding box:  xmin: 3910000 ymin: -1790000 xmax: 4040000 ymax: -1670000\nNA Projected CRS: WGS 84 / Pseudo-Mercator\nNA Reading layer `rivers_site' from data source \nNA   `/Users/seamus/repos/map-templates/assets/inputs/rivers_site.shp' \nNA   using driver `ESRI Shapefile'\nNA Simple feature collection with 554 features and 14 fields\nNA Geometry type: MULTILINESTRING\nNA Dimension:     XY\nNA Bounding box:  xmin: 3910000 ymin: -1790000 xmax: 4040000 ymax: -1660000\nNA Projected CRS: WGS 84 / Pseudo-Mercator\nNA Reading layer `watershed_site' from data source \nNA   `/Users/seamus/repos/map-templates/assets/inputs/watershed_site.shp' \nNA   using driver `ESRI Shapefile'\nNA Simple feature collection with 1 feature and 16 fields\nNA Geometry type: POLYGON\nNA Dimension:     XY\nNA Bounding box:  xmin: 3910000 ymin: -1790000 xmax: 4040000 ymax: -1660000\nNA Projected CRS: WGS 84 / Pseudo-Mercator\nNA Reading layer `watershed_chilwa_05_flowdem' from data source `/Users/seamus/repos/map-templates/assets/SHP/watershed_chilwa_05_flowdem.shp' \nNA   using driver `ESRI Shapefile'\nNA Simple feature collection with 1 feature and 1 field\nNA Geometry type: POLYGON\nNA Dimension:     XY\nNA Bounding box:  xmin: 3910000 ymin: -1790000 xmax: 4040000 ymax: -1660000\nNA Projected CRS: WGS 84 / Pseudo-Mercator\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 2h: Map illustrating watershed delineation derived in flowdem",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Watersheds</span>"
    ]
  },
  {
    "objectID": "02-watersheds/index.html#streams-delineation",
    "href": "02-watersheds/index.html#streams-delineation",
    "title": "Watersheds",
    "section": "2.8 Streams Delineation",
    "text": "2.8 Streams Delineation\nStream networks are extracted and classified using hierarchical whitebox processing: (1) extraction by sensitive accumulation threshold, (2) short segment removal, (3) main stem identification, and (4) vectorization.\nWe apply a sensitive threshold (25 cells) to capture ephemeral channels in marshland, then filter streams shorter than 200m to remove artifacts while preserving primary drainage structure. Main stem identification isolates trunk channels for hydrological modeling applications.\nStream ordering follows Strahler’s method (Strahler, 1957), where first-order streams have no tributaries, and stream order increases when two streams of equal order merge. We retain streams of order ≥3, representing primary drainage channels with contributing areas &gt;10 km².\n\n# Stream Classification \nwhitebox::wbt_extract_streams(\n  flow_accum= \"dem_chilwa_14_flow_accumulation_D8.tif\", \n  output    = \"dem_chilwa_18_streams_sensitive.tif\",\n  wd        = \"../assets/TIF/\", \n  zero_background = T,\n  threshold = 25, \n  )\n\nwhitebox::wbt_remove_short_streams(\n  d8_pntr = \"dem_chilwa_13_flow_direction_D8.tif\",  \n  streams = \"dem_chilwa_18_streams_sensitive.tif\",\n  output = \"dem_chilwa_19_streams_filtered.tif\",\n  wd = \"../assets/TIF/\",\n  min_length = 200\n)\n\nwhitebox::wbt_strahler_stream_order(\n  d8_pntr = \"dem_chilwa_13_flow_direction_D8.tif\",\n  streams = \"dem_chilwa_19_streams_filtered.tif\",\n  output = \"dem_chilwa_20_streams_ordered.tif\",\n  wd = \"../assets/TIF/\",\n  esri_pntr = FALSE\n)\n\nwhitebox::wbt_raster_streams_to_vector(\n  streams = \"dem_chilwa_20_streams_ordered.tif\",\n  d8_pntr = \"dem_chilwa_13_flow_direction_D8.tif\",\n  output = \"../assets/SHP/streams_chilwa.shp\",\n  wd = \"../assets/TIF/\"\n)\n\n# TEST: print(unique(streams_ordered)) &gt;&gt; 8 orders expected\nstreams_ordered = terra::rast(\n  \"../assets/TIF/dem_chilwa_20_streams_ordered.tif\")\nstreams_major = streams_ordered\nstreams_major[streams_major &lt; 3] &lt;- 0\nstreams_major[streams_major == 0] &lt;- NA\nterra::writeRaster(streams_major, overwrite = T,\n  \"../assets/TIF/dem_chilwa_21_streams_major.tif\")\n\n# Vectorize major streams of interest only\nwhitebox::wbt_raster_streams_to_vector(\n  streams = \"dem_chilwa_21_streams_major.tif\",\n  d8_pntr = \"dem_chilwa_13_flow_direction_D8.tif\",\n  output = \"../assets/SHP/dem_chilwa_21_streams_strahler.shp\",\n  wd = \"../assets/TIF/\"\n)\n\n# Tidy \nstreams_major_sf &lt;- sf::st_read(\"../assets/SHP/dem_chilwa_21_streams_strahler.shp\") \nstreams_major_sf = st_intersection(streams_major_sf, watershed) |&gt; \n  dplyr::select(\"FID\") |&gt; dplyr::rename(streams_strahler = FID)\n\n# Outputs\nsf::st_write(streams_major_sf, delete_dsn=T,\n  \"../assets/SHP/dem_chilwa_21_streams_strahler.shp\")\n\n\n# Inputs\ndem       = terra::rast(\"../assets/TIF/dem_chilwa_12_filled_wang.tif\")\nstreams   = sf::st_read(\"../assets/SHP/dem_chilwa_21_streams_strahler.shp\")\nNA Reading layer `dem_chilwa_21_streams_strahler' from data source `/Users/seamus/repos/map-templates/assets/SHP/dem_chilwa_21_streams_strahler.shp' \nNA   using driver `ESRI Shapefile'\nNA Simple feature collection with 788 features and 1 field\nNA Geometry type: MULTILINESTRING\nNA Dimension:     XY\nNA Bounding box:  xmin: 3910000 ymin: -1790000 xmax: 4040000 ymax: -1670000\nNA Projected CRS: WGS 84 / Pseudo-Mercator\nwatershed = sf::st_read(\"../assets/SHP/watershed_chilwa_05_flowdem.shp\")\nNA Reading layer `watershed_chilwa_05_flowdem' from data source `/Users/seamus/repos/map-templates/assets/SHP/watershed_chilwa_05_flowdem.shp' \nNA   using driver `ESRI Shapefile'\nNA Simple feature collection with 1 feature and 1 field\nNA Geometry type: POLYGON\nNA Dimension:     XY\nNA Bounding box:  xmin: 3910000 ymin: -1790000 xmax: 4040000 ymax: -1660000\nNA Projected CRS: WGS 84 / Pseudo-Mercator\nwetness   = terra::rast(\"../assets/TIF/dem_chilwa_16_wetness_index.tif\")\n\n# Visualize\ntmap::tmap_mode(\"plot\")\n#tmap::tm_shape(wetness_idx) + tmap::tm_raster(values=\"darkgreen\", \n#  alpha=1, title=\"Wetness Index\", style = \"quantile\", n=7) +\n  tmap::tm_shape(streams) + tmap::tm_lines(col = \"blue\", lwd=0.8) +\n  tmap::tm_shape(watershed) + tmap::tm_borders(col = \"darkblue\", lwd=1.1) +\n  tmap::tm_shape(lake) + tmap::tm_polygons(fill = \"steelblue\") +\n  tmap::tm_layout(legend.text.size = 0.7, legend.title.size = 0.5) +\n  tmap::tm_scalebar(position=c(\"RIGHT\", \"BOTTOM\"), text.size = .5) +\n  tmap::tm_compass(color.dark=\"gray60\",position=c(\"RIGHT\", \"top\")) +\n  tmap::tm_graticules(lines=T,labels.rot=c(0,90),lwd=0.2) +\n  tmap::tm_basemap(\"Esri.WorldTerrain\") +\n  tmap::tm_title(\"Lake Chilwa's Endorheic Drainage and Stream Network\", size=0.8)\n\n\n\n\n\n\n\nFigure 2i: Delineation of Lake Chilwa Drainage Watershed & Classified Stream Network.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Watersheds</span>"
    ]
  },
  {
    "objectID": "02-watersheds/index.html#build-3d-map",
    "href": "02-watersheds/index.html#build-3d-map",
    "title": "Watersheds",
    "section": "2.9 Build 3D map",
    "text": "2.9 Build 3D map\n\nrivers_strahler = rivers_site |&gt;\n  dplyr::mutate(\n    width = as.numeric(\n      ORD_FLOW\n    ),\n    width = dplyr::case_when(\n      width == 3 ~ 16,\n      width == 4 ~ 14,\n      width == 5 ~ 12,\n      width == 6 ~ 10,\n      width == 7 ~ 6,\n      TRUE ~ 0\n    )\n  ) |&gt;\n  sf::st_as_sf() |&gt;\n  sf::st_transform(crs = \"epsg:4326\")\n\nh &lt;- nrow(dem_site)\nw &lt;- ncol(dem_site)\n\ndem_matrix = rayshader::raster_to_matrix(dem_site)\n\ndem_matrix |&gt;\n  rayshader:: height_shade() |&gt;\n  rayshader::add_overlay(\n    rayshader::generate_line_overlay(\n      geometry   = rivers_strahler,\n      extent     = dem_site,\n      heightmap  = dem_matrix,\n      color      = \"#387B9C\",\n      linewidth  = rivers_strahler$width,\n      data_column_width = \"width\"\n      ), alphalayer = 1\n    ) |&gt;\n  rayshader::add_overlay(\n    rayshader::generate_line_overlay(\n      geometry   = lakes_site,\n      extent     = dem_site,\n      heightmap  = dem_matrix,\n      color      = \"#387B9C\"\n      ), alphalayer = 1\n    ) |&gt;\n  rayshader::plot_3d(\n    dem_matrix,\n    zscale       = 14,\n    solid        = T,\n    shadow       = T,\n    shadow_darkness = 2,\n    background   = \"white\",\n    windowsize   = c(600, 600),\n    zoom         = 0.6,\n    phi          = 40,\n    theta        = 0 \n  )",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Watersheds</span>"
    ]
  },
  {
    "objectID": "02-watersheds/index.html#render-3d-map",
    "href": "02-watersheds/index.html#render-3d-map",
    "title": "Watersheds",
    "section": "2.10 Render 3D map",
    "text": "2.10 Render 3D map\n\nrayshader::render_highquality(\n  preview        = T,\n  light          = F,\n  lightdirection = c(135, 45),\n  lightcolor = c(\"white\"),\n  lightaltitude = 25,\n  ambient_light = 0.1,\n  rotate_env     = 0.4,\n  intensity_env  = 0.85,\n  interactive    = F,\n  parallel       = T,\n  width          = w,\n  height         = h,\n  backgroundhigh=\"#FFFFFF\",\n  backgroundlow=\"#FFFFFF\"\n  )\n\n\n\nFigure 4: Three-dimensional map of Lake Chilwa watershed\n\nRuntime Log\n\ndevtools::session_info()\n## ─ Session info ───────────────────────────────────────────\n##  setting  value\n##  version  R version 4.3.0 (2023-04-21)\n##  os       macOS 15.7.1\n##  system   aarch64, darwin20\n##  ui       X11\n##  language (EN)\n##  collate  en_US.UTF-8\n##  ctype    en_US.UTF-8\n##  tz       America/Vancouver\n##  date     2025-11-03\n##  pandoc   3.8 @ /opt/local/bin/ (via rmarkdown)\n##  quarto   1.7.33 @ /usr/local/bin/quarto\n## \n## ─ Packages ───────────────────────────────────────────────\n##  package           * version    date (UTC) lib source\n##  abind             * 1.4-8      2024-09-12 [1] CRAN (R 4.3.3)\n##  backports           1.5.0      2024-05-23 [1] CRAN (R 4.3.3)\n##  base64enc           0.1-3      2015-07-28 [1] CRAN (R 4.3.3)\n##  bit                 4.6.0      2025-03-06 [1] CRAN (R 4.3.3)\n##  bit64               4.6.0-1    2025-01-16 [1] CRAN (R 4.3.3)\n##  bitops              1.0-9      2024-10-03 [1] CRAN (R 4.3.3)\n##  boot                1.3-32     2025-08-29 [1] CRAN (R 4.3.0)\n##  brew                1.0-10     2023-12-16 [1] CRAN (R 4.3.3)\n##  brio                1.1.5      2024-04-24 [1] CRAN (R 4.3.3)\n##  broom               1.0.8      2025-03-28 [1] CRAN (R 4.3.3)\n##  bslib             * 0.9.0      2025-01-30 [1] CRAN (R 4.3.3)\n##  cachem              1.1.0      2024-05-16 [1] CRAN (R 4.3.3)\n##  callr               3.7.6      2024-03-25 [1] CRAN (R 4.3.3)\n##  car                 3.1-3      2024-09-27 [1] CRAN (R 4.3.3)\n##  carData             3.0-5      2022-01-06 [1] CRAN (R 4.3.3)\n##  caret               7.0-1      2024-12-10 [1] CRAN (R 4.3.3)\n##  class               7.3-23     2025-01-01 [1] CRAN (R 4.3.3)\n##  classInt            0.4-11     2025-01-08 [1] CRAN (R 4.3.3)\n##  cli               * 3.6.5      2025-04-23 [1] CRAN (R 4.3.3)\n##  clue                0.3-66     2024-11-13 [1] CRAN (R 4.3.3)\n##  cluster             2.1.8.1    2025-03-12 [1] CRAN (R 4.3.3)\n##  codetools           0.2-20     2024-03-31 [1] CRAN (R 4.3.1)\n##  colorblindcheck   * 1.0.2      2023-05-13 [1] CRAN (R 4.3.3)\n##  colorspace          2.1-1      2024-07-26 [1] CRAN (R 4.3.3)\n##  cols4all          * 0.9        2025-08-28 [1] CRAN (R 4.3.0)\n##  coro                1.1.0      2024-11-05 [1] CRAN (R 4.3.3)\n##  countrycode         1.6.1      2025-03-31 [1] CRAN (R 4.3.3)\n##  covr              * 3.6.4      2023-11-09 [1] CRAN (R 4.3.1)\n##  cowplot           * 1.2.0      2025-07-07 [1] CRAN (R 4.3.3)\n##  crayon              1.5.3      2024-06-20 [1] CRAN (R 4.3.3)\n##  crosstalk           1.2.2      2025-08-26 [1] CRAN (R 4.3.0)\n##  curl                7.0.0      2025-08-19 [1] CRAN (R 4.3.0)\n##  data.table          1.17.8     2025-07-10 [1] CRAN (R 4.3.3)\n##  DBI                 1.2.3      2024-06-02 [1] CRAN (R 4.3.3)\n##  deldir              2.0-4      2024-02-28 [1] CRAN (R 4.3.3)\n##  dendextend        * 1.19.1     2025-07-15 [1] CRAN (R 4.3.0)\n##  devtools            2.4.5      2022-10-11 [1] CRAN (R 4.3.0)\n##  DiagrammeR        * 1.0.11     2024-02-02 [1] CRAN (R 4.3.1)\n##  dichromat           2.0-0.1    2022-05-02 [1] CRAN (R 4.3.3)\n##  digest            * 0.6.37     2024-08-19 [1] CRAN (R 4.3.3)\n##  doParallel          1.0.17     2022-02-07 [1] CRAN (R 4.3.3)\n##  downlit           * 0.4.4      2024-06-10 [1] CRAN (R 4.3.3)\n##  dplyr             * 1.1.4      2023-11-17 [1] CRAN (R 4.3.1)\n##  dtw               * 1.23-1     2022-09-19 [1] CRAN (R 4.3.3)\n##  dtwclust          * 6.0.0      2024-07-23 [1] CRAN (R 4.3.3)\n##  e1071               1.7-16     2024-09-16 [1] CRAN (R 4.3.3)\n##  elevatr           * 0.99.0     2023-09-12 [1] CRAN (R 4.3.0)\n##  ellipsis            0.3.2      2021-04-29 [1] CRAN (R 4.3.3)\n##  evaluate            1.0.5      2025-08-27 [1] CRAN (R 4.3.0)\n##  exactextractr     * 0.10.0     2023-09-20 [1] CRAN (R 4.3.1)\n##  extrafont           0.19       2023-01-18 [1] CRAN (R 4.3.3)\n##  extrafontdb         1.0        2012-06-11 [1] CRAN (R 4.3.3)\n##  farver              2.1.2      2024-05-13 [1] CRAN (R 4.3.3)\n##  fastmap             1.2.0      2024-05-15 [1] CRAN (R 4.3.3)\n##  flexclust           1.5.0      2025-02-28 [1] CRAN (R 4.3.3)\n##  flowdem           * 0.2        2025-09-14 [1] Github (KennethTM/flowdem@98cdb20)\n##  FNN               * 1.1.4.1    2024-09-22 [1] CRAN (R 4.3.3)\n##  forcats           * 1.0.0      2023-01-29 [1] CRAN (R 4.3.0)\n##  foreach             1.5.2      2022-02-02 [1] CRAN (R 4.3.3)\n##  Formula             1.2-5      2023-02-24 [1] CRAN (R 4.3.3)\n##  fs                  1.6.6      2025-04-12 [1] CRAN (R 4.3.3)\n##  future            * 1.67.0     2025-07-29 [1] CRAN (R 4.3.0)\n##  future.apply        1.20.0     2025-06-06 [1] CRAN (R 4.3.0)\n##  gdalUtilities     * 1.2.5      2023-08-10 [1] CRAN (R 4.3.0)\n##  generics            0.1.4      2025-05-09 [1] CRAN (R 4.3.3)\n##  geodata           * 0.6-2      2024-06-10 [1] CRAN (R 4.3.3)\n##  geojsonsf         * 2.0.3      2022-05-30 [1] CRAN (R 4.3.3)\n##  geos              * 0.2.4      2023-11-30 [1] CRAN (R 4.3.3)\n##  ggmap             * 4.0.1      2025-04-07 [1] CRAN (R 4.3.3)\n##  ggplot2           * 3.5.2      2025-04-09 [1] CRAN (R 4.3.3)\n##  ggplotify         * 0.1.2      2023-08-09 [1] CRAN (R 4.3.0)\n##  ggpubr            * 0.6.1      2025-06-27 [1] CRAN (R 4.3.3)\n##  ggrepel           * 0.9.6      2024-09-07 [1] CRAN (R 4.3.3)\n##  ggsignif            0.6.4      2022-10-13 [1] CRAN (R 4.3.0)\n##  ggspatial         * 1.1.10     2025-08-24 [1] CRAN (R 4.3.0)\n##  ggstats           * 0.10.0     2025-07-02 [1] CRAN (R 4.3.3)\n##  giscoR            * 0.6.1      2025-08-11 [1] Github (rOpenGov/giscoR@adfed30)\n##  globals             0.18.0     2025-05-08 [1] CRAN (R 4.3.0)\n##  glue                1.8.0      2024-09-30 [1] CRAN (R 4.3.3)\n##  gower               1.0.2      2024-12-17 [1] CRAN (R 4.3.3)\n##  gridExtra           2.3        2017-09-09 [1] CRAN (R 4.3.3)\n##  gridGraphics        0.5-1      2020-12-13 [1] CRAN (R 4.3.3)\n##  gtable              0.3.6      2024-10-25 [1] CRAN (R 4.3.3)\n##  hardhat             1.4.2      2025-08-20 [1] CRAN (R 4.3.0)\n##  hdf5r             * 1.3.12     2025-01-20 [1] CRAN (R 4.3.3)\n##  hexbin              1.28.5     2024-11-13 [1] CRAN (R 4.3.3)\n##  hms                 1.1.3      2023-03-21 [1] CRAN (R 4.3.0)\n##  htmltools         * 0.5.8.1    2024-04-04 [1] CRAN (R 4.3.3)\n##  htmlwidgets         1.6.4      2023-12-06 [1] CRAN (R 4.3.1)\n##  httpuv              1.6.16     2025-04-16 [1] CRAN (R 4.3.3)\n##  httr              * 1.4.7      2023-08-15 [1] CRAN (R 4.3.0)\n##  httr2             * 1.2.1      2025-07-22 [1] CRAN (R 4.3.0)\n##  interp              1.1-6      2024-01-26 [1] CRAN (R 4.3.3)\n##  ipred               0.9-15     2024-07-18 [1] CRAN (R 4.3.3)\n##  iterators           1.0.14     2022-02-05 [1] CRAN (R 4.3.3)\n##  jpeg                0.1-11     2025-03-21 [1] CRAN (R 4.3.3)\n##  jquerylib           0.1.4      2021-04-26 [1] CRAN (R 4.3.3)\n##  jsonify             1.2.2      2022-11-09 [1] CRAN (R 4.3.3)\n##  jsonlite          * 2.0.0      2025-03-27 [1] CRAN (R 4.3.3)\n##  KernSmooth          2.23-26    2025-01-01 [1] CRAN (R 4.3.3)\n##  knitr               1.50       2025-03-16 [1] CRAN (R 4.3.3)\n##  later               1.4.4      2025-08-27 [1] CRAN (R 4.3.0)\n##  lattice           * 0.22-7     2025-04-02 [1] CRAN (R 4.3.3)\n##  latticeExtra        0.6-30     2022-07-04 [1] CRAN (R 4.3.3)\n##  lava                1.8.1      2025-01-12 [1] CRAN (R 4.3.3)\n##  lazyeval            0.2.2      2019-03-15 [1] CRAN (R 4.3.3)\n##  leafem            * 0.2.5      2025-08-28 [1] CRAN (R 4.3.0)\n##  leafgl            * 0.2.2      2024-11-13 [1] CRAN (R 4.3.3)\n##  leaflegend          1.2.1      2024-05-09 [1] CRAN (R 4.3.3)\n##  leaflet           * 2.2.2      2024-03-26 [1] CRAN (R 4.3.1)\n##  leaflet.providers * 2.0.0      2023-10-17 [1] CRAN (R 4.3.3)\n##  leafpop             0.1.0      2021-05-22 [1] CRAN (R 4.3.0)\n##  leafsync            0.1.0      2019-03-05 [1] CRAN (R 4.3.0)\n##  libgeos           * 3.11.1-3   2025-03-19 [1] CRAN (R 4.3.3)\n##  lifecycle           1.0.4      2023-11-07 [1] CRAN (R 4.3.3)\n##  listenv             0.9.1      2024-01-29 [1] CRAN (R 4.3.3)\n##  logger              0.4.0      2024-10-22 [1] CRAN (R 4.3.3)\n##  lubridate         * 1.9.4      2024-12-08 [1] CRAN (R 4.3.3)\n##  luz               * 0.5.0      2025-07-29 [1] CRAN (R 4.3.0)\n##  lwgeom            * 0.2-14     2024-02-21 [1] CRAN (R 4.3.1)\n##  magrittr            2.0.4      2025-09-12 [1] CRAN (R 4.3.0)\n##  mapedit           * 0.7.0      2025-04-20 [1] CRAN (R 4.3.3)\n##  maptiles          * 0.10.0     2025-05-07 [1] CRAN (R 4.3.3)\n##  mapview           * 2.11.2     2023-10-13 [1] CRAN (R 4.3.1)\n##  MASS                7.3-60.0.1 2024-01-13 [1] CRAN (R 4.3.1)\n##  Matrix              1.6-5      2024-01-11 [1] CRAN (R 4.3.1)\n##  memoise             2.0.1      2021-11-26 [1] CRAN (R 4.3.3)\n##  mgcv              * 1.9-3      2025-04-04 [1] CRAN (R 4.3.0)\n##  microbenchmark      1.5.0      2024-09-04 [1] CRAN (R 4.3.3)\n##  mime                0.13       2025-03-17 [1] CRAN (R 4.3.3)\n##  miniUI              0.1.2      2025-04-17 [1] CRAN (R 4.3.3)\n##  ModelMetrics        1.2.2.2    2020-03-17 [1] CRAN (R 4.3.3)\n##  modeltools          0.2-24     2025-05-02 [1] CRAN (R 4.3.3)\n##  MPI               * 0.1.0      2022-04-05 [1] CRAN (R 4.3.0)\n##  ncdf4             * 1.24       2025-03-25 [1] CRAN (R 4.3.3)\n##  nlme              * 3.1-168    2025-03-31 [1] CRAN (R 4.3.3)\n##  nnet              * 7.3-20     2025-01-01 [1] CRAN (R 4.3.3)\n##  openxlsx          * 4.2.8      2025-01-25 [1] CRAN (R 4.3.3)\n##  pacman              0.5.1      2019-03-11 [1] CRAN (R 4.3.3)\n##  parallelly          1.45.1     2025-07-24 [1] CRAN (R 4.3.0)\n##  pillar              1.11.0     2025-07-04 [1] CRAN (R 4.3.3)\n##  pkgbuild            1.4.8      2025-05-26 [1] CRAN (R 4.3.3)\n##  pkgconfig           2.0.3      2019-09-22 [1] CRAN (R 4.3.3)\n##  pkgload             1.4.0      2024-06-28 [1] CRAN (R 4.3.3)\n##  plotly            * 4.11.0     2025-06-19 [1] CRAN (R 4.3.3)\n##  plyr                1.8.9      2023-10-02 [1] CRAN (R 4.3.3)\n##  png                 0.1-8      2022-11-29 [1] CRAN (R 4.3.3)\n##  prettyunits         1.2.0      2023-09-24 [1] CRAN (R 4.3.3)\n##  pROC                1.19.0.1   2025-07-31 [1] CRAN (R 4.3.0)\n##  processx            3.8.6      2025-02-21 [1] CRAN (R 4.3.3)\n##  prodlim             2025.04.28 2025-04-28 [1] CRAN (R 4.3.3)\n##  profvis             0.4.0      2024-09-20 [1] CRAN (R 4.3.3)\n##  progress          * 1.2.3      2023-12-06 [1] CRAN (R 4.3.1)\n##  progressr           0.15.1     2024-11-22 [1] CRAN (R 4.3.3)\n##  PROJ              * 0.6.0      2025-04-03 [1] CRAN (R 4.3.3)\n##  proj4             * 1.0-15     2025-03-21 [1] CRAN (R 4.3.3)\n##  promises            1.3.3      2025-05-29 [1] CRAN (R 4.3.3)\n##  proxy             * 0.4-27     2022-06-09 [1] CRAN (R 4.3.3)\n##  ps                  1.9.1      2025-04-12 [1] CRAN (R 4.3.3)\n##  purrr             * 1.1.0      2025-07-10 [1] CRAN (R 4.3.0)\n##  R6                  2.6.1      2025-02-15 [1] CRAN (R 4.3.3)\n##  randomForest      * 4.7-1.2    2024-09-22 [1] CRAN (R 4.3.3)\n##  rappdirs            0.3.3      2021-01-31 [1] CRAN (R 4.3.3)\n##  raster            * 3.6-32     2025-03-28 [1] CRAN (R 4.3.3)\n##  rasterVis         * 0.51.6     2023-11-01 [1] CRAN (R 4.3.3)\n##  rayshader         * 0.37.3     2024-02-21 [1] CRAN (R 4.3.1)\n##  rayvertex         * 0.12.0     2025-02-03 [1] CRAN (R 4.3.3)\n##  RColorBrewer      * 1.1-3      2022-04-03 [1] CRAN (R 4.3.3)\n##  Rcpp                1.1.0      2025-07-02 [1] CRAN (R 4.3.3)\n##  RcppParallel        5.1.11-1   2025-08-27 [1] CRAN (R 4.3.0)\n##  RCurl               1.98-1.17  2025-03-22 [1] CRAN (R 4.3.3)\n##  readr             * 2.1.5      2024-01-10 [1] CRAN (R 4.3.1)\n##  recipes             1.3.1      2025-05-21 [1] CRAN (R 4.3.3)\n##  remotes             2.5.0      2024-03-17 [1] CRAN (R 4.3.3)\n##  reshape2            1.4.4      2020-04-09 [1] CRAN (R 4.3.0)\n##  rex                 1.2.1      2021-11-26 [1] CRAN (R 4.3.3)\n##  rgl               * 1.3.24     2025-06-25 [1] CRAN (R 4.3.3)\n##  rgrass            * 0.5-2      2025-02-14 [1] CRAN (R 4.3.3)\n##  rlang               1.1.6      2025-04-11 [1] CRAN (R 4.3.3)\n##  rmapshaper        * 0.5.0      2023-04-11 [1] CRAN (R 4.3.0)\n##  rmarkdown           2.29       2024-11-04 [1] CRAN (R 4.3.3)\n##  rpart               4.1.24     2025-01-07 [1] CRAN (R 4.3.3)\n##  rsconnect         * 1.5.1      2025-08-28 [1] CRAN (R 4.3.0)\n##  RSpectra            0.16-2     2024-07-18 [1] CRAN (R 4.3.3)\n##  rstatix             0.7.2      2023-02-01 [1] CRAN (R 4.3.0)\n##  RStoolbox         * 1.0.2.1    2025-02-03 [1] CRAN (R 4.3.3)\n##  rstudioapi          0.17.1     2024-10-22 [1] CRAN (R 4.3.3)\n##  rts               * 1.1-14     2023-10-01 [1] CRAN (R 4.3.3)\n##  Rttf2pt1            1.3.12     2023-01-22 [1] CRAN (R 4.3.3)\n##  s2                * 1.1.9      2025-05-23 [1] CRAN (R 4.3.3)\n##  sass                0.4.10     2025-04-11 [1] CRAN (R 4.3.3)\n##  satellite           1.0.6      2025-08-21 [1] CRAN (R 4.3.0)\n##  scales            * 1.4.0      2025-04-24 [1] CRAN (R 4.3.3)\n##  sessioninfo         1.2.3      2025-02-05 [1] CRAN (R 4.3.3)\n##  sf                * 1.0-22     2025-08-25 [1] Github (r-spatial/sf@3660edf)\n##  shiny               1.11.1     2025-07-03 [1] CRAN (R 4.3.3)\n##  shinyjs             2.1.0      2021-12-23 [1] CRAN (R 4.3.0)\n##  shinyWidgets        0.9.0      2025-02-21 [1] CRAN (R 4.3.3)\n##  slippymath          0.3.1      2019-06-28 [1] CRAN (R 4.3.0)\n##  sp                * 2.2-0      2025-02-01 [1] CRAN (R 4.3.3)\n##  spacesXYZ           1.6-0      2025-06-06 [1] CRAN (R 4.3.3)\n##  spData            * 2.3.4      2025-01-08 [1] CRAN (R 4.3.3)\n##  spdep             * 1.4-1      2025-08-31 [1] CRAN (R 4.3.0)\n##  stars             * 0.6-8      2025-02-01 [1] CRAN (R 4.3.3)\n##  stringi             1.8.7      2025-03-27 [1] CRAN (R 4.3.3)\n##  stringr           * 1.5.2      2025-09-08 [1] CRAN (R 4.3.0)\n##  supercells        * 1.0.0      2024-02-11 [1] CRAN (R 4.3.1)\n##  survival            3.8-3      2024-12-17 [1] CRAN (R 4.3.3)\n##  svglite             2.2.1      2025-05-12 [1] CRAN (R 4.3.3)\n##  systemfonts         1.2.3      2025-04-30 [1] CRAN (R 4.3.3)\n##  terra             * 1.8-60     2025-07-21 [1] CRAN (R 4.3.0)\n##  terrainr          * 0.7.6      2025-07-25 [1] CRAN (R 4.3.0)\n##  testthat          * 3.2.3      2025-01-13 [1] CRAN (R 4.3.3)\n##  textshaping         1.0.3      2025-09-02 [1] CRAN (R 4.3.0)\n##  tibble            * 3.3.0      2025-06-08 [1] CRAN (R 4.3.3)\n##  tidyr             * 1.3.1      2024-01-24 [1] CRAN (R 4.3.1)\n##  tidyselect          1.2.1      2024-03-11 [1] CRAN (R 4.3.1)\n##  tidyterra         * 0.7.2      2025-04-14 [1] CRAN (R 4.3.3)\n##  tidyverse         * 2.0.0      2023-02-22 [1] CRAN (R 4.3.0)\n##  timechange          0.3.0      2024-01-18 [1] CRAN (R 4.3.3)\n##  timeDate            4041.110   2024-09-22 [1] CRAN (R 4.3.3)\n##  tmap              * 4.1        2025-05-12 [1] CRAN (R 4.3.3)\n##  tmaptools         * 3.2        2025-01-13 [1] CRAN (R 4.3.3)\n##  torch               0.16.0     2025-08-21 [1] CRAN (R 4.3.0)\n##  traudem           * 1.0.3      2025-10-28 [1] Github (lucarraro/traudem@a30c9c9)\n##  tzdb                0.5.0      2025-03-15 [1] CRAN (R 4.3.3)\n##  unifir              0.2.4      2024-02-01 [1] CRAN (R 4.3.3)\n##  units               0.8-7      2025-03-11 [1] CRAN (R 4.3.3)\n##  urlchecker          1.0.1      2021-11-30 [1] CRAN (R 4.3.3)\n##  usethis             3.1.0      2024-11-26 [1] CRAN (R 4.3.3)\n##  uuid                1.2-1      2024-07-29 [1] CRAN (R 4.3.3)\n##  V8                  6.0.4      2025-06-04 [1] CRAN (R 4.3.3)\n##  vctrs               0.6.5      2023-12-01 [1] CRAN (R 4.3.3)\n##  viridis             0.6.5      2024-01-29 [1] CRAN (R 4.3.1)\n##  viridisLite         0.4.2      2023-05-02 [1] CRAN (R 4.3.3)\n##  visNetwork          2.1.2      2022-09-29 [1] CRAN (R 4.3.0)\n##  whitebox          * 2.4.3      2025-10-28 [1] Github (opengeos/whiteboxR@294ea4b)\n##  withr               3.0.2      2024-10-28 [1] CRAN (R 4.3.3)\n##  wk                  0.9.4      2024-10-11 [1] CRAN (R 4.3.3)\n##  xfun                0.53       2025-08-19 [1] CRAN (R 4.3.0)\n##  xgboost           * 1.7.11.1   2025-05-15 [1] CRAN (R 4.3.3)\n##  XML                 3.99-0.18  2025-01-01 [1] CRAN (R 4.3.3)\n##  xml2                1.4.0      2025-08-20 [1] CRAN (R 4.3.0)\n##  xtable              1.8-4      2019-04-21 [1] CRAN (R 4.3.3)\n##  xts               * 0.14.1     2024-10-15 [1] CRAN (R 4.3.3)\n##  yaml                2.3.10     2024-07-26 [1] CRAN (R 4.3.3)\n##  yulab.utils         0.2.1      2025-08-19 [1] CRAN (R 4.3.0)\n##  zeallot             0.2.0      2025-05-27 [1] CRAN (R 4.3.3)\n##  zip                 2.3.3      2025-05-13 [1] CRAN (R 4.3.3)\n##  zoo               * 1.8-14     2025-04-10 [1] CRAN (R 4.3.3)\n## \n##  [1] /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/library\n##  * ── Packages attached to the search path.\n## \n## ──────────────────────────────────────────────────────────\n\n\n\n\n\n\n\nBarnes, R. (2016). RichDEM: Terrain analysis software. http://github.com/r-barnes/richdem\n\n\nBarnes, R., Lehman, C., & Mulla, D. (2014). Priority-flood: An optimal depression-filling and watershed-labeling algorithm for digital elevation models. Computers & Geosciences, 62, 117–127.\n\n\ncontributors, G. (2020). GDAL/OGR geospatial data abstraction software library. Open Source Geospatial Foundation. https://gdal.org\n\n\nHasan, M. M., Ullah, M. S., Saha, A. K., & Amin, M. M. (2021). Comparing the performances of multiple rainfall-runoff models of a karst watershed. Asian-Australasian Journal of Bioscience and Biotechnology, 6(1), 26–39.\n\n\nHijmans, R. J. (2025). Terra: Spatial data analysis. https://CRAN.R-project.org/package=terra\n\n\nHollister, J., Shah, T., Nowosad, J., Robitaille, A. L., Beck, M. W., & Johnson, M. (2023). Elevatr: Access elevation data from various APIs. https://doi.org/10.5281/zenodo.8335450\n\n\nLehner, B., Messager, M. L., Korver, M. C., & Linke, S. (2022). Global hydro-environmental lake characteristics at high spatial resolution. Scientific Data, 9(1), 351.\n\n\nLi, Y., Huang, C., Wang, N., Chen, Y., Zhang, S., & Duan, H. (2025). Enhanced understanding of hydrological connectivity among lakes on the qiangtang plateau. International Journal of Digital Earth, 18(1), 2450845.\n\n\nLindsay, J. B. (2016). Efficient hybrid breaching-filling sink removal methods for flow path enforcement in digital elevation models. Hydrological Processes, 30(6), 846–857.\n\n\nLindsay, J. B., & Creed, I. F. (2005). Removal of artifact depressions from digital elevation models: Towards a minimum impact approach. Hydrological Processes: An International Journal, 19(16), 3113–3126.\n\n\nLindsay, J. B., & Creed, I. F. (2006). Distinguishing actual and artefact depressions in digital elevation data. Computers & Geosciences, 32(8), 1192–1204.\n\n\nMartinsen, K. T. (2023). Flowdem: Flow routing on digital elevation models.\n\n\nO’Callaghan, J. F., & Mark, D. M. (1984). The extraction of drainage networks from digital elevation data. Computer Vision, Graphics, and Image Processing, 28(3), 323–344.\n\n\nPebesma, E., & Bivand, R. (2023a). Spatial data science: With applications in r. https://doi.org/10.1201/9780429459016\n\n\nPebesma, E., & Bivand, R. (2023b). Spatial data science: With applications in r. 352. https://doi.org/10.1201/9780429459016\n\n\nStrahler, A. N. (1957). Quantitative analysis of watershed geomorphology. Eos, Transactions American Geophysical Union, 38(6), 913–920.\n\n\nWang, L., & Liu, H. (2006). An efficient method for identifying and filling surface depressions in digital elevation models for hydrologic analysis and modelling. International Journal of Geographical Information Science, 20(2), 193–213.\n\n\nWu, Q., & Brown, A. (2025). ’Whitebox’: ’WhiteboxTools’ r frontend. https://CRAN.R-project.org/package=whitebox\n\n\nWu, Q., Liu, H., Wang, S., Yu, B., Beck, R., & Hinkel, K. (2015). A localized contour tree method for deriving geometric and topological properties of complex surface depressions based on high-resolution topographical data. International Journal of Geographical Information Science, 29(12), 2041–2060.\n\n\nZhang, J., Condon, L. E., Tran, H., & Maxwell, R. M. (2020). A national topographic dataset for hydrological modeling over contiguous united states. Earth System Science Data Discussions, 2020, 1–26.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Watersheds</span>"
    ]
  },
  {
    "objectID": "02-watersheds/index.html#footnotes",
    "href": "02-watersheds/index.html#footnotes",
    "title": "Watersheds",
    "section": "",
    "text": "https://wiki.openstreetmap.org/wiki/Slippy_map↩︎",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Watersheds</span>"
    ]
  },
  {
    "objectID": "03-streams/index.html",
    "href": "03-streams/index.html",
    "title": "Streams",
    "section": "",
    "text": "3.0 Overview",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Streams</span>"
    ]
  },
  {
    "objectID": "03-streams/index.html#overview",
    "href": "03-streams/index.html#overview",
    "title": "Streams",
    "section": "",
    "text": "Environment Setup\n\npacman::p_load(\n  \"cli\", \"cols4all\", \"covr\", \"cowplot\",\n  \"dendextend\", \"digest\", \"DiagrammeR\", \"dtwclust\", \"downlit\",\n  \"exactextractr\", \"elevatr\",\n  \"FNN\", \"future\", \"flowdem\",\n  \"gdalUtilities\", \"geojsonsf\", \"geos\", \"geodata\", \n  \"ggplot2\", \"ggstats\",\"ggspatial\", \"ggmap\", \n  \"ggplotify\", \"ggpubr\", \"ggrepel\", \"giscoR\",\n  \"hdf5r\", \"httr\", \"httr2\", \"htmltools\",\n  \"jsonlite\",\n  \"leafem\", \"leaflet.providers\", \"libgeos\", \"luz\", \"lwgeom\", \"leaflet\", \"leafgl\",\n  \"mapedit\", \"mapview\", \"maptiles\", \"methods\", \"mgcv\",\n  \"ncdf4\", \"nnet\",\n  \"openxlsx\",\n  \"parallel\", \"plotly\", \"proj4\", \"PROJ\",\n  \"randomForest\", \"rasterVis\", \"raster\",\n  \"rayshader\", \"rayvertex\", \n  \"RColorBrewer\", \"rgl\", \"rsconnect\", \"RStoolbox\", \"rts\",\n  \"s2\", \"sf\", \"scales\", \"spdep\", \"stars\", \"stringr\", \"supercells\",\n  \"terra\", \"testthat\", \"tidyverse\", \"tidyterra\", \"tools\",\n  \"tmap\", \"tmaptools\", \"terrainr\",\n  \"xgboost\"\n)",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Streams</span>"
    ]
  },
  {
    "objectID": "03-streams/index.html#import-aoi",
    "href": "03-streams/index.html#import-aoi",
    "title": "Streams",
    "section": "3.1 Import AOI",
    "text": "3.1 Import AOI\n\nlibrary(sf)\n\naoi_00 = geodata::gadm(\n  country=\"CAN\", level=0, \n  path=\"./assets/SHP/\") |&gt; \n  sf::st_as_sf()\n\naoi_01  = geodata::gadm(\n  country=\"CAN\", level=1, \n  path=\"../assets/SHP/\") |&gt; \n  sf::st_as_sf()\n\naoi_02  = geodata::gadm(\n  country=\"CAN\", level=2, \n  path=\"../assets/SHP/\") |&gt; \n  sf::st_as_sf()\n\naoi_03  = geodata::gadm(\n  country=\"CAN\", level=3, \n  path=\"../assets/SHP/\") |&gt; \n  sf::st_as_sf()\n\n# ------------ #\n# BC Albers    #\n# ------------ #\ncrs_master = \"EPSG:3005\"\nsf::st_transform(aoi_00, crs_master)\nsf::st_transform(aoi_01, crs_master)\nsf::st_transform(aoi_02, crs_master)\nsf::st_transform(aoi_03, crs_master)\n\nsf::st_write(aoi_00, \"../assets/SHP/aoi_00.shp\", delete_dsn = T)\nsf::st_write(aoi_01, \"../assets/SHP/aoi_01.shp\", delete_dsn = T)\nsf::st_write(aoi_02, \"../assets/SHP/aoi_02.shp\", delete_dsn = T)\nsf::st_write(aoi_03, \"../assets/SHP/aoi_03.shp\", delete_dsn = T)",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Streams</span>"
    ]
  },
  {
    "objectID": "03-streams/index.html#extract-shoreline",
    "href": "03-streams/index.html#extract-shoreline",
    "title": "Streams",
    "section": "3.2 Extract Shoreline",
    "text": "3.2 Extract Shoreline\n\nbc_province = sf::st_read(\"../assets/SHP/aoi_01.shp\", quiet=T) |&gt;\n  sf::st_make_valid() |&gt; dplyr::filter(NAME_1 == \"British Columbia\") \nbc_districts = sf::st_read(\"../assets/SHP/aoi_02.shp\", quiet=T)|&gt;\n  sf::st_make_valid() |&gt; dplyr::filter(NAME_1 == \"British Columbia\")\nbc_counties = sf::st_read(\"../assets/SHP/aoi_03.shp\", quiet=T)|&gt;\n  sf::st_make_valid() |&gt; dplyr::filter(NAME_1 == \"British Columbia\")\n\n# ---------------------------  #\n# Note: BBOX needs CRS forcing #\nisland_extent = sf::st_bbox(c(\n  xmin = -129.5, ymin = 48.1, \n  xmax = -123.0, ymax = 51.0), \n  crs = st_crs(4326)) |&gt; \n  sf::st_as_sfc()\nisland_extent_sf = sf::st_as_sf(island_extent) \n\nshoreline_input &lt;- osmdata::opq(bbox = sf::st_bbox(island_extent_sf)) |&gt;\n  osmdata::add_osm_feature(key = \"natural\", value = \"coastline\") |&gt;\n  osmdata::osmdata_sf() |&gt; {\\(x) x$osm_lines}() |&gt;\n  sf::st_intersection(island_extent_sf) |&gt;\n  sf::st_union() |&gt;\n  sf::st_polygonize() |&gt;\n  sf::st_collection_extract(\"POLYGON\")\n\n# `rmapshaper::ms_clip()` requires perimiter polygon shell only\nshoreline_shell &lt;- shoreline_input %&gt;%\n  sf::st_union() %&gt;%\n  sf::st_as_sf()|&gt; \n  sf::st_transform(crs_master)\n\nisland_shoreline &lt;- bc_districts %&gt;%\n  sf::st_filter(shoreline_input, .predicate = st_intersects) %&gt;%\n  rmapshaper::ms_dissolve() %&gt;% \n  rmapshaper::ms_clip(shoreline_shell)|&gt; \n  sf::st_transform(crs_master)\n\nisland_districts &lt;- bc_districts %&gt;%\n  sf::st_filter(shoreline_input, .predicate = st_intersects) %&gt;%\n  rmapshaper::ms_simplify(keep = 0.95) %&gt;%        \n  rmapshaper::ms_clip(shoreline_shell)|&gt; \n  sf::st_transform(crs_master)             \n\nisland_counties &lt;- bc_counties %&gt;%\n  sf::st_filter(shoreline_input, .predicate = st_intersects) %&gt;%\n  rmapshaper::ms_simplify(keep = 0.95) %&gt;%        \n  rmapshaper::ms_clip(shoreline_shell)|&gt; \n  sf::st_transform(crs_master)             \n\nsf::st_write(island_districts, \"../assets/SHP/island_districts.shp\", delete_dsn=T)\nsf::st_write(island_counties, \"../assets/SHP/island_counties.shp\", delete_dsn=T)\nsf::st_write(island_shoreline, \"../assets/SHP/island_shoreline.shp\", delete_dsn=T)\nsf::st_write(shoreline_input, \"../assets/SHP/shoreline_input.shp\", delete_dsn=T)\nsf::st_write(shoreline_shell, \"../assets/SHP/shoreline_shell.shp\", delete_dsn=T)\n\ntmap::tmap_mode(\"view\")\ntmap::tm_shape(island_counties) + tm_borders(lwd=0) +\n  tmap::tm_shape(island_shoreline) + tm_borders(col = \"black\", lwd=4) +\n  tmap::tm_shape(island_districts) + tm_borders(col = \"purple\", lwd=1.5) +\n  tmap::tm_shape(island_counties) + tm_borders(col = \"yellow\", lwd=0.5) +\n  tmap::tm_basemap(\"Esri.WorldImagery\") -&gt; tm01_live\ntm01_live\n\n\n\n\n\n\n\n\nFigure 3a Interactive map of delineated shoreline and administrative boundaries",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Streams</span>"
    ]
  },
  {
    "objectID": "03-streams/index.html#process-dem",
    "href": "03-streams/index.html#process-dem",
    "title": "Streams",
    "section": "3.3 Process DEM",
    "text": "3.3 Process DEM\nAdditional conditioning algorithms are available within the RichDEM library 1\n\n# Inputs\nisland_shoreline = sf::st_read(\"../assets/SHP/island_shoreline.shp\", quiet=T)\ndem_7arc = elevatr::get_elev_raster(island_shoreline, z=9,clip=\"locations\")|&gt;\n  terra::rast()|&gt; \n  terra::crop(terra::vect(island_shoreline)) |&gt;  \n  terra::project(crs_master)\n\n# Apply breaching & filling algorithms\ndem_condt_7arc  = dem_7arc |&gt; \n  flowdem::breach() |&gt;\n  flowdem::fill(epsilon=T) |&gt;\n  flowdem::fill_basins() # costal basins\n\n# Calculate flow direction & accumulation\ndem_dir_7arc = dem_condt_7arc |&gt; flowdem::dirs(mode=\"d8\")\ndem_acc_7arc = dem_dir_7arc |&gt; flowdem::accum(mode=\"d8\")\n\ntmap::tm_shape(dem) + \n  tmap::tm_raster(\n    col.scale = tm_scale_continuous(values = \"viridis\"),\n    col.legend = tm_legend(title = \"Elevation (m)\", reverse = T)) + \n  tmap::tm_graticules(lines = T, labels.rot = c(0, 90), lwd = 0.2) +\n  tmap::tm_scalebar(position = c(\"LEFT\", \"BOTTOM\"), text.size = 0.5) + \n  tmap::tm_compass(color.dark=\"gray60\",text.color=\"gray60\",position=c(\"top\",\"left\"))+\n  tmap::tm_basemap(\"Esri.WorldImagery\")\n\n# Outputs\nwriteRaster(dem_condt_7arc, \"../assets/TIF/dem_7arc_condt.tif\", overwrite=T)\nwriteRaster(dem_condt_5arc, \"../assets/TIF/dem_5arc_condt.tif\", overwrite=T)\nwriteRaster(dem_dir_7arc, \"../assets/TIF/dem_7arc_dir.tif\", overwrite=T)\nwriteRaster(dem_dir_5arc, \"../assets/TIF/dem_5arc_dir.tif\", overwrite=T)\nwriteRaster(dem_acc_7arc, \"../assets/TIF/dem_7arc_acc.tif\", overwrite=T)\nwriteRaster(dem_acc_5arc, \"../assets/TIF/dem_5arc_acc.tif\", overwrite=T)\n\n\n\n\n\nFigure 3b Map of conditioned elevation model clipped to extracted shoreline",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Streams</span>"
    ]
  },
  {
    "objectID": "03-streams/index.html#extract-sub-basin",
    "href": "03-streams/index.html#extract-sub-basin",
    "title": "Streams",
    "section": "3.4 Extract Sub-basin",
    "text": "3.4 Extract Sub-basin\n\ndem = terra::rast(\"../assets/TIF/dem_7arc_condt.tif\")",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Streams</span>"
    ]
  },
  {
    "objectID": "03-streams/index.html#delineate-streams",
    "href": "03-streams/index.html#delineate-streams",
    "title": "Streams",
    "section": "3.5 Delineate Streams",
    "text": "3.5 Delineate Streams\n\n# Calculate Flow Accumulation Distribution\npar(mfrow = c(2, 2))\nthresholds &lt;- c(1, 2, 10, 20, 50, 100)\n\nfor(thresholds in c(1, 2, 10, 20, 50, 100)) {\n  count &lt;- sum(acc_values &gt;= thresholds, na.rm = TRUE)\n   percent &lt;- (count / length(acc_values)) * 100\n   cat(\"Threshold\", thresholds, \":\", count, \"cells (\", round(percent, 2), \"%)\\n\")\n}\n\nacc_values &lt;- values(dem_acc, na.rm = TRUE)\nquantile(acc_values, probs = c(0.5, 0.9, 0.95, 0.99, 0.995, 0.999), na.rm = TRUE)\nupper_limit &lt;- quantile(acc_values, 0.99, na.rm = TRUE)\nacc_subset &lt;- acc_values[acc_values &lt;= upper_limit]\nlow_vals &lt;- acc_values[acc_values &lt;= 10 & acc_values &gt;= 2]\nmed_vals &lt;- acc_values[acc_values &lt;= 50 & acc_values &gt;= 2]\nhigh_vals &lt;- acc_values[acc_values &lt;= 100 & acc_values &gt;= 2]\nhist(low_vals, breaks = 10, main = \"Flow Accumulation: 1-10\", xlab = \"Accumulation\")\nhist(med_vals, breaks = 25, main = \"Flow Accumulation: 1-50\", xlab = \"Accumulation\")\nhist(high_vals, breaks = 50, main = \"Flow Accumulation: 1-100\", xlab = \"Accumulation\")\n#hist(acc_subset, breaks = 500, main=\"Flow Accumulation (&lt;99%)\", xlab=\"Flow Accumulation\")\nhist(log10(acc_values+1),breaks=50,main=\"Log10 Accumulation)\", xlab=\"Log10 Accumulation\")\n\n# Delineate streams using flow accumulation\nstreams_binary = dem_acc &gt; 100\nstreams = sf::st_as_sf(as.polygons(streams_binary == 1))\nst_write(streams, \"../assets/SHP/streams_100.shp\", delete_dsn=T)\n\n\nNA Threshold 1 : 3803857 cells ( 100 %)\nNA Threshold 2 : 2858053 cells ( 75.1 %)\nNA Threshold 10 : 590109 cells ( 15.5 %)\nNA Threshold 20 : 362517 cells ( 9.53 %)\nNA Threshold 50 : 236072 cells ( 6.21 %)\nNA Threshold 100 : 171608 cells ( 4.51 %)\nNA   50%   90%   95%   99% 99.5% 99.9% \nNA     3    18    79  2147  6578 41239",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Streams</span>"
    ]
  },
  {
    "objectID": "03-streams/index.html#build-3d-map",
    "href": "03-streams/index.html#build-3d-map",
    "title": "Streams",
    "section": "3.6 Build 3D Map",
    "text": "3.6 Build 3D Map\n\nlakes = sf::st_read(\"../assets/SHP/lakes.shp\") |&gt; sf::st_cast(\"POLYGON\")\nbasins= sf::st_read(\"../assets/SHP/basins.shp\") |&gt; sf::st_cast(\"MULTIPOLYGON\")\nrivers= sf::st_read(\"../assets/SHP/streams.shp\")|&gt; sf::st_cast(\"MULTILINESTRING\")\ndem   = terra::rast(\"../assets/TIF/dem_7arc_condt.tif\") \nh &lt;- nrow(dem)\nw &lt;- ncol(dem)\n\nmatrix = rayshader::raster_to_matrix(dem) \n\nmatrix |&gt;\n  rayshader::height_shade() |&gt;\n  rayshader::add_overlay(\n    rayshader::generate_line_overlay(\n      geometry   = rivers,\n      extent     = dem,\n      heightmap  = matrix,\n      color      = \"royalblue\",\n      linewidth  = 3,\n      ), alphalayer = 1\n    ) |&gt;\n  rayshader::plot_3d(\n    matrix,\n    zscale       = 69,\n    solid        = T,\n    shadow       = T,\n    shadow_darkness = 2,\n    background   = \"white\",\n    windowsize   = 800,\n    zoom         = 0.8,\n    phi          = 89.9,\n    theta        = 0 \n  )\n\n#rayshader::render_snapshot(\n#  rayvertex_lighting  = T,\n#  rayvertex_lights    = \n#    rayvertex::directional_light(\n#      intensity       = 1.5, \n#      color           = \"#F3EEE1\", \n#      direction       = c(-1.5,1,-1.5)\n#      ),\n#  rayvertex_shadow_map= T, \n#  software_render     = T\n#  )",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Streams</span>"
    ]
  },
  {
    "objectID": "03-streams/index.html#render-3d-map",
    "href": "03-streams/index.html#render-3d-map",
    "title": "Streams",
    "section": "3.7 Render 3D Map",
    "text": "3.7 Render 3D Map\n\nrayshader::render_highquality(\n  samples           = 400, \n  sample_method     = \"sobol\", \n  parallel          = T, \n  environment_light = \"kiara_1_dawn_2k.hdr\", \n  light             = T, \n  width             = w, \n  height            = h,\n  preview           = T, \n  interactive       = F,\n  backgroundhigh=\"#FFFFFF\",\n  backgroundlow=\"#FFFFFF\"\n  )\n\n\nRuntime Log\n\ndevtools::session_info()\n## ─ Session info ───────────────────────────────────────────\n##  setting  value\n##  version  R version 4.3.0 (2023-04-21)\n##  os       macOS 15.7.1\n##  system   aarch64, darwin20\n##  ui       X11\n##  language (EN)\n##  collate  en_US.UTF-8\n##  ctype    en_US.UTF-8\n##  tz       America/Vancouver\n##  date     2025-11-03\n##  pandoc   3.8 @ /opt/local/bin/ (via rmarkdown)\n##  quarto   1.7.33 @ /usr/local/bin/quarto\n## \n## ─ Packages ───────────────────────────────────────────────\n##  package           * version    date (UTC) lib source\n##  abind             * 1.4-8      2024-09-12 [1] CRAN (R 4.3.3)\n##  backports           1.5.0      2024-05-23 [1] CRAN (R 4.3.3)\n##  base64enc           0.1-3      2015-07-28 [1] CRAN (R 4.3.3)\n##  bit                 4.6.0      2025-03-06 [1] CRAN (R 4.3.3)\n##  bit64               4.6.0-1    2025-01-16 [1] CRAN (R 4.3.3)\n##  bitops              1.0-9      2024-10-03 [1] CRAN (R 4.3.3)\n##  boot                1.3-32     2025-08-29 [1] CRAN (R 4.3.0)\n##  brew                1.0-10     2023-12-16 [1] CRAN (R 4.3.3)\n##  brio                1.1.5      2024-04-24 [1] CRAN (R 4.3.3)\n##  broom               1.0.8      2025-03-28 [1] CRAN (R 4.3.3)\n##  bslib               0.9.0      2025-01-30 [1] CRAN (R 4.3.3)\n##  cachem              1.1.0      2024-05-16 [1] CRAN (R 4.3.3)\n##  callr               3.7.6      2024-03-25 [1] CRAN (R 4.3.3)\n##  car                 3.1-3      2024-09-27 [1] CRAN (R 4.3.3)\n##  carData             3.0-5      2022-01-06 [1] CRAN (R 4.3.3)\n##  caret               7.0-1      2024-12-10 [1] CRAN (R 4.3.3)\n##  class               7.3-23     2025-01-01 [1] CRAN (R 4.3.3)\n##  classInt            0.4-11     2025-01-08 [1] CRAN (R 4.3.3)\n##  cli               * 3.6.5      2025-04-23 [1] CRAN (R 4.3.3)\n##  clue                0.3-66     2024-11-13 [1] CRAN (R 4.3.3)\n##  cluster             2.1.8.1    2025-03-12 [1] CRAN (R 4.3.3)\n##  codetools           0.2-20     2024-03-31 [1] CRAN (R 4.3.1)\n##  colorspace          2.1-1      2024-07-26 [1] CRAN (R 4.3.3)\n##  cols4all          * 0.9        2025-08-28 [1] CRAN (R 4.3.0)\n##  coro                1.1.0      2024-11-05 [1] CRAN (R 4.3.3)\n##  covr              * 3.6.4      2023-11-09 [1] CRAN (R 4.3.1)\n##  cowplot           * 1.2.0      2025-07-07 [1] CRAN (R 4.3.3)\n##  crayon              1.5.3      2024-06-20 [1] CRAN (R 4.3.3)\n##  crosstalk           1.2.2      2025-08-26 [1] CRAN (R 4.3.0)\n##  data.table          1.17.8     2025-07-10 [1] CRAN (R 4.3.3)\n##  DBI                 1.2.3      2024-06-02 [1] CRAN (R 4.3.3)\n##  deldir              2.0-4      2024-02-28 [1] CRAN (R 4.3.3)\n##  dendextend        * 1.19.1     2025-07-15 [1] CRAN (R 4.3.0)\n##  devtools            2.4.5      2022-10-11 [1] CRAN (R 4.3.0)\n##  DiagrammeR        * 1.0.11     2024-02-02 [1] CRAN (R 4.3.1)\n##  dichromat           2.0-0.1    2022-05-02 [1] CRAN (R 4.3.3)\n##  digest            * 0.6.37     2024-08-19 [1] CRAN (R 4.3.3)\n##  doParallel          1.0.17     2022-02-07 [1] CRAN (R 4.3.3)\n##  downlit           * 0.4.4      2024-06-10 [1] CRAN (R 4.3.3)\n##  dplyr             * 1.1.4      2023-11-17 [1] CRAN (R 4.3.1)\n##  dtw               * 1.23-1     2022-09-19 [1] CRAN (R 4.3.3)\n##  dtwclust          * 6.0.0      2024-07-23 [1] CRAN (R 4.3.3)\n##  e1071               1.7-16     2024-09-16 [1] CRAN (R 4.3.3)\n##  elevatr           * 0.99.0     2023-09-12 [1] CRAN (R 4.3.0)\n##  ellipsis            0.3.2      2021-04-29 [1] CRAN (R 4.3.3)\n##  evaluate            1.0.5      2025-08-27 [1] CRAN (R 4.3.0)\n##  exactextractr     * 0.10.0     2023-09-20 [1] CRAN (R 4.3.1)\n##  extrafont           0.19       2023-01-18 [1] CRAN (R 4.3.3)\n##  extrafontdb         1.0        2012-06-11 [1] CRAN (R 4.3.3)\n##  farver              2.1.2      2024-05-13 [1] CRAN (R 4.3.3)\n##  fastmap             1.2.0      2024-05-15 [1] CRAN (R 4.3.3)\n##  flexclust           1.5.0      2025-02-28 [1] CRAN (R 4.3.3)\n##  flowdem           * 0.2        2025-09-14 [1] Github (KennethTM/flowdem@98cdb20)\n##  FNN               * 1.1.4.1    2024-09-22 [1] CRAN (R 4.3.3)\n##  forcats           * 1.0.0      2023-01-29 [1] CRAN (R 4.3.0)\n##  foreach             1.5.2      2022-02-02 [1] CRAN (R 4.3.3)\n##  Formula             1.2-5      2023-02-24 [1] CRAN (R 4.3.3)\n##  fs                  1.6.6      2025-04-12 [1] CRAN (R 4.3.3)\n##  future            * 1.67.0     2025-07-29 [1] CRAN (R 4.3.0)\n##  future.apply        1.20.0     2025-06-06 [1] CRAN (R 4.3.0)\n##  gdalUtilities     * 1.2.5      2023-08-10 [1] CRAN (R 4.3.0)\n##  generics            0.1.4      2025-05-09 [1] CRAN (R 4.3.3)\n##  geodata           * 0.6-2      2024-06-10 [1] CRAN (R 4.3.3)\n##  geojsonsf         * 2.0.3      2022-05-30 [1] CRAN (R 4.3.3)\n##  geos              * 0.2.4      2023-11-30 [1] CRAN (R 4.3.3)\n##  ggmap             * 4.0.1      2025-04-07 [1] CRAN (R 4.3.3)\n##  ggplot2           * 3.5.2      2025-04-09 [1] CRAN (R 4.3.3)\n##  ggplotify         * 0.1.2      2023-08-09 [1] CRAN (R 4.3.0)\n##  ggpubr            * 0.6.1      2025-06-27 [1] CRAN (R 4.3.3)\n##  ggrepel           * 0.9.6      2024-09-07 [1] CRAN (R 4.3.3)\n##  ggsignif            0.6.4      2022-10-13 [1] CRAN (R 4.3.0)\n##  ggspatial         * 1.1.10     2025-08-24 [1] CRAN (R 4.3.0)\n##  ggstats           * 0.10.0     2025-07-02 [1] CRAN (R 4.3.3)\n##  giscoR            * 0.6.1      2025-08-11 [1] Github (rOpenGov/giscoR@adfed30)\n##  globals             0.18.0     2025-05-08 [1] CRAN (R 4.3.0)\n##  glue                1.8.0      2024-09-30 [1] CRAN (R 4.3.3)\n##  gower               1.0.2      2024-12-17 [1] CRAN (R 4.3.3)\n##  gridExtra           2.3        2017-09-09 [1] CRAN (R 4.3.3)\n##  gridGraphics        0.5-1      2020-12-13 [1] CRAN (R 4.3.3)\n##  gtable              0.3.6      2024-10-25 [1] CRAN (R 4.3.3)\n##  hardhat             1.4.2      2025-08-20 [1] CRAN (R 4.3.0)\n##  hdf5r             * 1.3.12     2025-01-20 [1] CRAN (R 4.3.3)\n##  hexbin              1.28.5     2024-11-13 [1] CRAN (R 4.3.3)\n##  hms                 1.1.3      2023-03-21 [1] CRAN (R 4.3.0)\n##  htmltools         * 0.5.8.1    2024-04-04 [1] CRAN (R 4.3.3)\n##  htmlwidgets         1.6.4      2023-12-06 [1] CRAN (R 4.3.1)\n##  httpuv              1.6.16     2025-04-16 [1] CRAN (R 4.3.3)\n##  httr              * 1.4.7      2023-08-15 [1] CRAN (R 4.3.0)\n##  httr2             * 1.2.1      2025-07-22 [1] CRAN (R 4.3.0)\n##  interp              1.1-6      2024-01-26 [1] CRAN (R 4.3.3)\n##  ipred               0.9-15     2024-07-18 [1] CRAN (R 4.3.3)\n##  iterators           1.0.14     2022-02-05 [1] CRAN (R 4.3.3)\n##  jpeg                0.1-11     2025-03-21 [1] CRAN (R 4.3.3)\n##  jquerylib           0.1.4      2021-04-26 [1] CRAN (R 4.3.3)\n##  jsonlite          * 2.0.0      2025-03-27 [1] CRAN (R 4.3.3)\n##  KernSmooth          2.23-26    2025-01-01 [1] CRAN (R 4.3.3)\n##  knitr               1.50       2025-03-16 [1] CRAN (R 4.3.3)\n##  later               1.4.4      2025-08-27 [1] CRAN (R 4.3.0)\n##  lattice           * 0.22-7     2025-04-02 [1] CRAN (R 4.3.3)\n##  latticeExtra        0.6-30     2022-07-04 [1] CRAN (R 4.3.3)\n##  lava                1.8.1      2025-01-12 [1] CRAN (R 4.3.3)\n##  lazyeval            0.2.2      2019-03-15 [1] CRAN (R 4.3.3)\n##  leafem            * 0.2.5      2025-08-28 [1] CRAN (R 4.3.0)\n##  leafgl            * 0.2.2      2024-11-13 [1] CRAN (R 4.3.3)\n##  leaflegend          1.2.1      2024-05-09 [1] CRAN (R 4.3.3)\n##  leaflet           * 2.2.2      2024-03-26 [1] CRAN (R 4.3.1)\n##  leaflet.providers * 2.0.0      2023-10-17 [1] CRAN (R 4.3.3)\n##  leafpop             0.1.0      2021-05-22 [1] CRAN (R 4.3.0)\n##  leafsync            0.1.0      2019-03-05 [1] CRAN (R 4.3.0)\n##  libgeos           * 3.11.1-3   2025-03-19 [1] CRAN (R 4.3.3)\n##  lifecycle           1.0.4      2023-11-07 [1] CRAN (R 4.3.3)\n##  listenv             0.9.1      2024-01-29 [1] CRAN (R 4.3.3)\n##  logger              0.4.0      2024-10-22 [1] CRAN (R 4.3.3)\n##  lubridate         * 1.9.4      2024-12-08 [1] CRAN (R 4.3.3)\n##  luz               * 0.5.0      2025-07-29 [1] CRAN (R 4.3.0)\n##  lwgeom            * 0.2-14     2024-02-21 [1] CRAN (R 4.3.1)\n##  magrittr            2.0.4      2025-09-12 [1] CRAN (R 4.3.0)\n##  mapedit           * 0.7.0      2025-04-20 [1] CRAN (R 4.3.3)\n##  maptiles          * 0.10.0     2025-05-07 [1] CRAN (R 4.3.3)\n##  mapview           * 2.11.2     2023-10-13 [1] CRAN (R 4.3.1)\n##  MASS                7.3-60.0.1 2024-01-13 [1] CRAN (R 4.3.1)\n##  Matrix              1.6-5      2024-01-11 [1] CRAN (R 4.3.1)\n##  memoise             2.0.1      2021-11-26 [1] CRAN (R 4.3.3)\n##  mgcv              * 1.9-3      2025-04-04 [1] CRAN (R 4.3.0)\n##  microbenchmark      1.5.0      2024-09-04 [1] CRAN (R 4.3.3)\n##  mime                0.13       2025-03-17 [1] CRAN (R 4.3.3)\n##  miniUI              0.1.2      2025-04-17 [1] CRAN (R 4.3.3)\n##  ModelMetrics        1.2.2.2    2020-03-17 [1] CRAN (R 4.3.3)\n##  modeltools          0.2-24     2025-05-02 [1] CRAN (R 4.3.3)\n##  ncdf4             * 1.24       2025-03-25 [1] CRAN (R 4.3.3)\n##  nlme              * 3.1-168    2025-03-31 [1] CRAN (R 4.3.3)\n##  nnet              * 7.3-20     2025-01-01 [1] CRAN (R 4.3.3)\n##  openxlsx          * 4.2.8      2025-01-25 [1] CRAN (R 4.3.3)\n##  pacman              0.5.1      2019-03-11 [1] CRAN (R 4.3.3)\n##  parallelly          1.45.1     2025-07-24 [1] CRAN (R 4.3.0)\n##  pillar              1.11.0     2025-07-04 [1] CRAN (R 4.3.3)\n##  pkgbuild            1.4.8      2025-05-26 [1] CRAN (R 4.3.3)\n##  pkgconfig           2.0.3      2019-09-22 [1] CRAN (R 4.3.3)\n##  pkgload             1.4.0      2024-06-28 [1] CRAN (R 4.3.3)\n##  plotly            * 4.11.0     2025-06-19 [1] CRAN (R 4.3.3)\n##  plyr                1.8.9      2023-10-02 [1] CRAN (R 4.3.3)\n##  png                 0.1-8      2022-11-29 [1] CRAN (R 4.3.3)\n##  prettyunits         1.2.0      2023-09-24 [1] CRAN (R 4.3.3)\n##  pROC                1.19.0.1   2025-07-31 [1] CRAN (R 4.3.0)\n##  processx            3.8.6      2025-02-21 [1] CRAN (R 4.3.3)\n##  prodlim             2025.04.28 2025-04-28 [1] CRAN (R 4.3.3)\n##  profvis             0.4.0      2024-09-20 [1] CRAN (R 4.3.3)\n##  progress            1.2.3      2023-12-06 [1] CRAN (R 4.3.1)\n##  progressr           0.15.1     2024-11-22 [1] CRAN (R 4.3.3)\n##  PROJ              * 0.6.0      2025-04-03 [1] CRAN (R 4.3.3)\n##  proj4             * 1.0-15     2025-03-21 [1] CRAN (R 4.3.3)\n##  promises            1.3.3      2025-05-29 [1] CRAN (R 4.3.3)\n##  proxy             * 0.4-27     2022-06-09 [1] CRAN (R 4.3.3)\n##  ps                  1.9.1      2025-04-12 [1] CRAN (R 4.3.3)\n##  purrr             * 1.1.0      2025-07-10 [1] CRAN (R 4.3.0)\n##  R6                  2.6.1      2025-02-15 [1] CRAN (R 4.3.3)\n##  randomForest      * 4.7-1.2    2024-09-22 [1] CRAN (R 4.3.3)\n##  rappdirs            0.3.3      2021-01-31 [1] CRAN (R 4.3.3)\n##  raster            * 3.6-32     2025-03-28 [1] CRAN (R 4.3.3)\n##  rasterVis         * 0.51.6     2023-11-01 [1] CRAN (R 4.3.3)\n##  rayshader         * 0.37.3     2024-02-21 [1] CRAN (R 4.3.1)\n##  rayvertex         * 0.12.0     2025-02-03 [1] CRAN (R 4.3.3)\n##  RColorBrewer      * 1.1-3      2022-04-03 [1] CRAN (R 4.3.3)\n##  Rcpp                1.1.0      2025-07-02 [1] CRAN (R 4.3.3)\n##  RcppParallel        5.1.11-1   2025-08-27 [1] CRAN (R 4.3.0)\n##  RCurl               1.98-1.17  2025-03-22 [1] CRAN (R 4.3.3)\n##  readr             * 2.1.5      2024-01-10 [1] CRAN (R 4.3.1)\n##  recipes             1.3.1      2025-05-21 [1] CRAN (R 4.3.3)\n##  remotes             2.5.0      2024-03-17 [1] CRAN (R 4.3.3)\n##  reshape2            1.4.4      2020-04-09 [1] CRAN (R 4.3.0)\n##  rex                 1.2.1      2021-11-26 [1] CRAN (R 4.3.3)\n##  rgl               * 1.3.24     2025-06-25 [1] CRAN (R 4.3.3)\n##  rlang               1.1.6      2025-04-11 [1] CRAN (R 4.3.3)\n##  rmarkdown           2.29       2024-11-04 [1] CRAN (R 4.3.3)\n##  rpart               4.1.24     2025-01-07 [1] CRAN (R 4.3.3)\n##  rsconnect         * 1.5.1      2025-08-28 [1] CRAN (R 4.3.0)\n##  RSpectra            0.16-2     2024-07-18 [1] CRAN (R 4.3.3)\n##  rstatix             0.7.2      2023-02-01 [1] CRAN (R 4.3.0)\n##  RStoolbox         * 1.0.2.1    2025-02-03 [1] CRAN (R 4.3.3)\n##  rstudioapi          0.17.1     2024-10-22 [1] CRAN (R 4.3.3)\n##  rts               * 1.1-14     2023-10-01 [1] CRAN (R 4.3.3)\n##  Rttf2pt1            1.3.12     2023-01-22 [1] CRAN (R 4.3.3)\n##  s2                * 1.1.9      2025-05-23 [1] CRAN (R 4.3.3)\n##  sass                0.4.10     2025-04-11 [1] CRAN (R 4.3.3)\n##  satellite           1.0.6      2025-08-21 [1] CRAN (R 4.3.0)\n##  scales            * 1.4.0      2025-04-24 [1] CRAN (R 4.3.3)\n##  sessioninfo         1.2.3      2025-02-05 [1] CRAN (R 4.3.3)\n##  sf                * 1.0-22     2025-08-25 [1] Github (r-spatial/sf@3660edf)\n##  shiny               1.11.1     2025-07-03 [1] CRAN (R 4.3.3)\n##  shinyjs             2.1.0      2021-12-23 [1] CRAN (R 4.3.0)\n##  shinyWidgets        0.9.0      2025-02-21 [1] CRAN (R 4.3.3)\n##  sp                * 2.2-0      2025-02-01 [1] CRAN (R 4.3.3)\n##  spacesXYZ           1.6-0      2025-06-06 [1] CRAN (R 4.3.3)\n##  spData            * 2.3.4      2025-01-08 [1] CRAN (R 4.3.3)\n##  spdep             * 1.4-1      2025-08-31 [1] CRAN (R 4.3.0)\n##  stars             * 0.6-8      2025-02-01 [1] CRAN (R 4.3.3)\n##  stringi             1.8.7      2025-03-27 [1] CRAN (R 4.3.3)\n##  stringr           * 1.5.2      2025-09-08 [1] CRAN (R 4.3.0)\n##  supercells        * 1.0.0      2024-02-11 [1] CRAN (R 4.3.1)\n##  survival            3.8-3      2024-12-17 [1] CRAN (R 4.3.3)\n##  svglite             2.2.1      2025-05-12 [1] CRAN (R 4.3.3)\n##  systemfonts         1.2.3      2025-04-30 [1] CRAN (R 4.3.3)\n##  terra             * 1.8-60     2025-07-21 [1] CRAN (R 4.3.0)\n##  terrainr          * 0.7.6      2025-07-25 [1] CRAN (R 4.3.0)\n##  testthat          * 3.2.3      2025-01-13 [1] CRAN (R 4.3.3)\n##  textshaping         1.0.3      2025-09-02 [1] CRAN (R 4.3.0)\n##  tibble            * 3.3.0      2025-06-08 [1] CRAN (R 4.3.3)\n##  tidyr             * 1.3.1      2024-01-24 [1] CRAN (R 4.3.1)\n##  tidyselect          1.2.1      2024-03-11 [1] CRAN (R 4.3.1)\n##  tidyterra         * 0.7.2      2025-04-14 [1] CRAN (R 4.3.3)\n##  tidyverse         * 2.0.0      2023-02-22 [1] CRAN (R 4.3.0)\n##  timechange          0.3.0      2024-01-18 [1] CRAN (R 4.3.3)\n##  timeDate            4041.110   2024-09-22 [1] CRAN (R 4.3.3)\n##  tmap              * 4.1        2025-05-12 [1] CRAN (R 4.3.3)\n##  tmaptools         * 3.2        2025-01-13 [1] CRAN (R 4.3.3)\n##  torch               0.16.0     2025-08-21 [1] CRAN (R 4.3.0)\n##  tzdb                0.5.0      2025-03-15 [1] CRAN (R 4.3.3)\n##  unifir              0.2.4      2024-02-01 [1] CRAN (R 4.3.3)\n##  units               0.8-7      2025-03-11 [1] CRAN (R 4.3.3)\n##  urlchecker          1.0.1      2021-11-30 [1] CRAN (R 4.3.3)\n##  usethis             3.1.0      2024-11-26 [1] CRAN (R 4.3.3)\n##  uuid                1.2-1      2024-07-29 [1] CRAN (R 4.3.3)\n##  vctrs               0.6.5      2023-12-01 [1] CRAN (R 4.3.3)\n##  viridis             0.6.5      2024-01-29 [1] CRAN (R 4.3.1)\n##  viridisLite         0.4.2      2023-05-02 [1] CRAN (R 4.3.3)\n##  visNetwork          2.1.2      2022-09-29 [1] CRAN (R 4.3.0)\n##  withr               3.0.2      2024-10-28 [1] CRAN (R 4.3.3)\n##  wk                  0.9.4      2024-10-11 [1] CRAN (R 4.3.3)\n##  xfun                0.53       2025-08-19 [1] CRAN (R 4.3.0)\n##  xgboost           * 1.7.11.1   2025-05-15 [1] CRAN (R 4.3.3)\n##  XML                 3.99-0.18  2025-01-01 [1] CRAN (R 4.3.3)\n##  xtable              1.8-4      2019-04-21 [1] CRAN (R 4.3.3)\n##  xts               * 0.14.1     2024-10-15 [1] CRAN (R 4.3.3)\n##  yaml                2.3.10     2024-07-26 [1] CRAN (R 4.3.3)\n##  yulab.utils         0.2.1      2025-08-19 [1] CRAN (R 4.3.0)\n##  zeallot             0.2.0      2025-05-27 [1] CRAN (R 4.3.3)\n##  zip                 2.3.3      2025-05-13 [1] CRAN (R 4.3.3)\n##  zoo               * 1.8-14     2025-04-10 [1] CRAN (R 4.3.3)\n## \n##  [1] /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/library\n##  * ── Packages attached to the search path.\n## \n## ──────────────────────────────────────────────────────────",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Streams</span>"
    ]
  },
  {
    "objectID": "03-streams/index.html#footnotes",
    "href": "03-streams/index.html#footnotes",
    "title": "Streams",
    "section": "",
    "text": "Breach-fill algorithm by Lindsay’s paper (2016) “Efficient hybrid breaching-filling sink removal methods for flow path enforcement in digital elevation models: Efficient Hybrid Sink Removal Methods for Flow Path Enforcement: (Hydrological Processes 30, 846–857. doi:10.1002/hyp.10648) -&gt; flowdem::comp_breach_lindsay2016(dem)↩︎",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Streams</span>"
    ]
  },
  {
    "objectID": "04-topography/index.html",
    "href": "04-topography/index.html",
    "title": "\n4  Topography\n",
    "section": "",
    "text": "4.1 1. Import AOI\ncrs_master= sf::st_crs('EPSG:3857')\nrivers    = sf::st_read(\"../assets/inputs/rivers_site.shp\", quiet=T) |&gt; \n  sf::st_cast(\"LINESTRING\") |&gt; sf::st_transform(crs_master) \nlakes     = sf::st_read(\"../assets/inputs/lakes_site.shp\", quiet=T)  |&gt; \n  sf::st_cast(\"POLYGON\") |&gt; sf::st_transform(crs_master)\naoi       = sf::read_sf(\"../assets/inputs/chilwa_watershed_4326.shp\", quiet=T) |&gt; \n  sf::st_cast(\"POLYGON\") |&gt; sf::st_transform(crs_master)\nbbox_aoi  = terrainr::add_bbox_buffer(aoi, 20000, \"meters\")\nvbox_aoi  = terra::vect(bbox_aoi)\n\ntmap::tmap_mode(\"view\")\ntmap::tm_shape(aoi) + tmap::tm_borders(col = \"red\") +\n  tmap::tm_shape(rivers) + tm_lines(col = \"turquoise\", lwd=0.5) +\n  tmap::tm_shape(lakes) + tm_fill(\"turquoise\") +\n  tmap::tm_basemap(\"Esri.WorldImagery\")",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Topography</span>"
    ]
  },
  {
    "objectID": "04-topography/index.html#process-dem",
    "href": "04-topography/index.html#process-dem",
    "title": "\n4  Topography\n",
    "section": "\n4.2 2. Process DEM",
    "text": "4.2 2. Process DEM\nNote: More efficient conditioning algorithms available with RichDEM library 1\n\n# z = 12: 1-Arc Second \n# z = 11: 3-Arc Second \n# z = 10: 5-Arc Second \n\n#Download and process DEM \ndem = elevatr::get_elev_raster(aoi, z=10,clip=\"locations\")|&gt;\n  terra::rast() |&gt; \n  terra::crop(terra::vect(aoi)) |&gt;\n  flowdem::breach() |&gt;\n  flowdem::fill(epsilon=T) \n\nslope_matrix &lt;- matrix(c(\n  0, 5, 1,    # &lt;5%\n  5, 10, 2,   # 5-10%\n  10, 15, 3,  # 10-15%\n  15, 20, 4,  # 15-20%\n  20, 30, 5,  # 20-30%\n  30, 100, 6  # 30-100% (since you clamped at 100)\n), ncol=3, byrow=TRUE)\n\naspect_matrix &lt;- matrix(c(\n  0, 22.5, 1,      # North\n  22.5, 67.5, 2,   # Northeast  \n  67.5, 112.5, 3,  # East\n  112.5, 157.5, 4, # Southeast\n  157.5, 202.5, 5, # South\n  202.5, 247.5, 6, # Southwest\n  247.5, 292.5, 7, # West\n  292.5, 337.5, 8, # Northwest\n  337.5, 360, 1    # North (wraparound)\n), ncol=3, byrow=TRUE)\n\nslope_deg = terra::terrain(dem, v=\"slope\", unit=\"degrees\", neighbors=8)\nslope_pct = base::tan(slope_deg * pi/180) * 100 \nslope_pct = terra::clamp(slope_pct, lower=0, upper=100)\naspect_deg = terra::terrain(dem, v=\"aspect\", unit=\"degrees\", neighbors=8)\n\nslope      = terra::classify(slope_pct, slope_matrix, include.lowest=TRUE)\naspect     = terra::classify(aspect_deg, aspect_matrix, include.lowest=T)\n\nraster::writeRaster(dem, \"../assets/TIF/dem_5arc_condt_chilwa.tif\", overwrite=T)\nraster::writeRaster(slope, \"../assets/TIF/slope_5arc_condt_chilwa.tif\", overwrite=T)\nraster::writeRaster(aspect, \"../assets/TIF/aspect_5arc_condt_chilwa.tif\", overwrite=T)",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Topography</span>"
    ]
  },
  {
    "objectID": "04-topography/index.html#render-maps",
    "href": "04-topography/index.html#render-maps",
    "title": "\n4  Topography\n",
    "section": "\n4.3 3. Render Maps",
    "text": "4.3 3. Render Maps\n\ndem   = terra::rast(\"../assets/TIF/dem_5arc_condt_chilwa.tif\")\nslope = terra::rast(\"../assets/TIF/slope_5arc_condt_chilwa.tif\")\naspect= terra::rast(\"../assets/TIF/aspect_5arc_condt_chilwa.tif\")\n\nlevels(slope) &lt;- data.frame(ID = 1:6,\n  slope_class = c(\"&lt;5%\", \"5-10%\", \"10-15%\", \"15-20%\", \"20-30%\", \"30-100%\"))\nlevels(aspect) &lt;- data.frame(ID = 1:8,\n  direction = c(\"N\", \"NE\", \"E\", \"SE\", \"S\", \"SW\", \"W\", \"NW\"))\n\ntmap::tmap_mode(\"plot\")\ntmap::tm_shape(dem) + \n  tmap::tm_raster(\n    col.scale = tm_scale_continuous(values = terrain.colors(7)),\n    col.legend = tm_legend(title = \"Elevation (m)\", reverse = T)) + \n  tmap::tm_shape(rivers) + tm_lines(col = \"turquoise\") +\n  tmap::tm_shape(lakes) + tm_fill(\"turquoise\") +\n  tmap::tm_graticules(lines = T, labels.rot = c(0, 90), lwd = 0.2) +\n  tmap::tm_scalebar(position = c(\"LEFT\", \"BOTTOM\"), text.size = 0.5) + \n  tmap::tm_compass(color.dark=\"gray60\",position=c(\"top\",\"left\")) -&gt; tm1_static\n\ntmap::tm_shape(slope) + \n  tmap::tm_raster(\n    col.scale = tm_scale(values = \"viridis\"), \n    col.legend=tm_legend(title=\"Slope (%)\",reverse = T)) + \n  tmap::tm_shape(rivers) + tm_lines(col = \"turquoise\") +\n  tmap::tm_shape(lakes) + tm_fill(\"turquoise\") +\n  tmap::tm_graticules(lines = T, labels.rot = c(0, 90), lwd = 0.2) +\n  tmap::tm_scalebar(position = c(\"LEFT\", \"BOTTOM\"), text.size = 0.5) + \n  tmap::tm_compass(color.dark=\"gray60\",position=c(\"top\",\"left\")) -&gt; tm2_static\n\ntmap::tm_shape(aspect) + \n  tmap::tm_raster(\n    col.scale = tm_scale(values = \"PiYG\"), \n    col.legend=tm_legend(title=\"Aspect\",reverse = F)) + \n  tmap::tm_shape(rivers) + tm_lines(col = \"turquoise\") +\n  tmap::tm_shape(lakes) + tm_fill(\"turquoise\") +\n  tmap::tm_graticules(lines = T, labels.rot = c(0, 90), lwd = 0.2) +\n  tmap::tm_scalebar(position = c(\"LEFT\", \"BOTTOM\"), text.size = 0.5) + \n  tmap::tm_compass(color.dark=\"gray60\",position=c(\"top\",\"left\")) -&gt; tm3_static\n\ntmap::tmap_arrange(tm1_static, tm2_static, tm3_static, nrow=1)\n\n\n\n\n\n\n\nRuntime Log\n\ndevtools::session_info()\n## ─ Session info ───────────────────────────────────────────\n##  setting  value\n##  version  R version 4.3.0 (2023-04-21)\n##  os       macOS 15.7.1\n##  system   aarch64, darwin20\n##  ui       X11\n##  language (EN)\n##  collate  en_US.UTF-8\n##  ctype    en_US.UTF-8\n##  tz       America/Vancouver\n##  date     2025-11-03\n##  pandoc   3.8 @ /opt/local/bin/ (via rmarkdown)\n##  quarto   1.7.33 @ /usr/local/bin/quarto\n## \n## ─ Packages ───────────────────────────────────────────────\n##  package           * version    date (UTC) lib source\n##  abind             * 1.4-8      2024-09-12 [1] CRAN (R 4.3.3)\n##  backports           1.5.0      2024-05-23 [1] CRAN (R 4.3.3)\n##  base64enc           0.1-3      2015-07-28 [1] CRAN (R 4.3.3)\n##  bit                 4.6.0      2025-03-06 [1] CRAN (R 4.3.3)\n##  bit64               4.6.0-1    2025-01-16 [1] CRAN (R 4.3.3)\n##  bitops              1.0-9      2024-10-03 [1] CRAN (R 4.3.3)\n##  boot                1.3-32     2025-08-29 [1] CRAN (R 4.3.0)\n##  brew                1.0-10     2023-12-16 [1] CRAN (R 4.3.3)\n##  brio                1.1.5      2024-04-24 [1] CRAN (R 4.3.3)\n##  broom               1.0.8      2025-03-28 [1] CRAN (R 4.3.3)\n##  bslib             * 0.9.0      2025-01-30 [1] CRAN (R 4.3.3)\n##  cachem              1.1.0      2024-05-16 [1] CRAN (R 4.3.3)\n##  callr               3.7.6      2024-03-25 [1] CRAN (R 4.3.3)\n##  car                 3.1-3      2024-09-27 [1] CRAN (R 4.3.3)\n##  carData             3.0-5      2022-01-06 [1] CRAN (R 4.3.3)\n##  caret               7.0-1      2024-12-10 [1] CRAN (R 4.3.3)\n##  cellranger          1.1.0      2016-07-27 [1] CRAN (R 4.3.0)\n##  class               7.3-23     2025-01-01 [1] CRAN (R 4.3.3)\n##  classInt            0.4-11     2025-01-08 [1] CRAN (R 4.3.3)\n##  cli               * 3.6.5      2025-04-23 [1] CRAN (R 4.3.3)\n##  clue                0.3-66     2024-11-13 [1] CRAN (R 4.3.3)\n##  cluster             2.1.8.1    2025-03-12 [1] CRAN (R 4.3.3)\n##  codetools           0.2-20     2024-03-31 [1] CRAN (R 4.3.1)\n##  colorspace          2.1-1      2024-07-26 [1] CRAN (R 4.3.3)\n##  cols4all          * 0.9        2025-08-28 [1] CRAN (R 4.3.0)\n##  coro                1.1.0      2024-11-05 [1] CRAN (R 4.3.3)\n##  covr              * 3.6.4      2023-11-09 [1] CRAN (R 4.3.1)\n##  cowplot           * 1.2.0      2025-07-07 [1] CRAN (R 4.3.3)\n##  crayon              1.5.3      2024-06-20 [1] CRAN (R 4.3.3)\n##  crosstalk           1.2.2      2025-08-26 [1] CRAN (R 4.3.0)\n##  data.table          1.17.8     2025-07-10 [1] CRAN (R 4.3.3)\n##  DBI                 1.2.3      2024-06-02 [1] CRAN (R 4.3.3)\n##  dbplyr              2.5.1      2025-09-10 [1] CRAN (R 4.3.0)\n##  deldir              2.0-4      2024-02-28 [1] CRAN (R 4.3.3)\n##  dendextend        * 1.19.1     2025-07-15 [1] CRAN (R 4.3.0)\n##  devtools            2.4.5      2022-10-11 [1] CRAN (R 4.3.0)\n##  DiagrammeR        * 1.0.11     2024-02-02 [1] CRAN (R 4.3.1)\n##  dichromat           2.0-0.1    2022-05-02 [1] CRAN (R 4.3.3)\n##  digest            * 0.6.37     2024-08-19 [1] CRAN (R 4.3.3)\n##  doParallel          1.0.17     2022-02-07 [1] CRAN (R 4.3.3)\n##  downlit           * 0.4.4      2024-06-10 [1] CRAN (R 4.3.3)\n##  dplyr             * 1.1.4      2023-11-17 [1] CRAN (R 4.3.1)\n##  dtw               * 1.23-1     2022-09-19 [1] CRAN (R 4.3.3)\n##  dtwclust          * 6.0.0      2024-07-23 [1] CRAN (R 4.3.3)\n##  e1071               1.7-16     2024-09-16 [1] CRAN (R 4.3.3)\n##  elevatr           * 0.99.0     2023-09-12 [1] CRAN (R 4.3.0)\n##  ellipsis            0.3.2      2021-04-29 [1] CRAN (R 4.3.3)\n##  evaluate            1.0.5      2025-08-27 [1] CRAN (R 4.3.0)\n##  exactextractr     * 0.10.0     2023-09-20 [1] CRAN (R 4.3.1)\n##  extrafont           0.19       2023-01-18 [1] CRAN (R 4.3.3)\n##  extrafontdb         1.0        2012-06-11 [1] CRAN (R 4.3.3)\n##  farver              2.1.2      2024-05-13 [1] CRAN (R 4.3.3)\n##  fastmap             1.2.0      2024-05-15 [1] CRAN (R 4.3.3)\n##  flexclust           1.5.0      2025-02-28 [1] CRAN (R 4.3.3)\n##  flowdem           * 0.2        2025-09-14 [1] Github (KennethTM/flowdem@98cdb20)\n##  FNN               * 1.1.4.1    2024-09-22 [1] CRAN (R 4.3.3)\n##  forcats           * 1.0.0      2023-01-29 [1] CRAN (R 4.3.0)\n##  foreach             1.5.2      2022-02-02 [1] CRAN (R 4.3.3)\n##  Formula             1.2-5      2023-02-24 [1] CRAN (R 4.3.3)\n##  fs                  1.6.6      2025-04-12 [1] CRAN (R 4.3.3)\n##  future            * 1.67.0     2025-07-29 [1] CRAN (R 4.3.0)\n##  future.apply        1.20.0     2025-06-06 [1] CRAN (R 4.3.0)\n##  gdalUtilities     * 1.2.5      2023-08-10 [1] CRAN (R 4.3.0)\n##  generics            0.1.4      2025-05-09 [1] CRAN (R 4.3.3)\n##  geodata           * 0.6-2      2024-06-10 [1] CRAN (R 4.3.3)\n##  geojsonsf         * 2.0.3      2022-05-30 [1] CRAN (R 4.3.3)\n##  geos              * 0.2.4      2023-11-30 [1] CRAN (R 4.3.3)\n##  ggmap             * 4.0.1      2025-04-07 [1] CRAN (R 4.3.3)\n##  ggplot2           * 3.5.2      2025-04-09 [1] CRAN (R 4.3.3)\n##  ggplotify         * 0.1.2      2023-08-09 [1] CRAN (R 4.3.0)\n##  ggpubr            * 0.6.1      2025-06-27 [1] CRAN (R 4.3.3)\n##  ggrepel           * 0.9.6      2024-09-07 [1] CRAN (R 4.3.3)\n##  ggsignif            0.6.4      2022-10-13 [1] CRAN (R 4.3.0)\n##  ggspatial         * 1.1.10     2025-08-24 [1] CRAN (R 4.3.0)\n##  ggstats           * 0.10.0     2025-07-02 [1] CRAN (R 4.3.3)\n##  giscoR            * 0.6.1      2025-08-11 [1] Github (rOpenGov/giscoR@adfed30)\n##  globals             0.18.0     2025-05-08 [1] CRAN (R 4.3.0)\n##  glue                1.8.0      2024-09-30 [1] CRAN (R 4.3.3)\n##  gower               1.0.2      2024-12-17 [1] CRAN (R 4.3.3)\n##  gridExtra           2.3        2017-09-09 [1] CRAN (R 4.3.3)\n##  gridGraphics        0.5-1      2020-12-13 [1] CRAN (R 4.3.3)\n##  gtable              0.3.6      2024-10-25 [1] CRAN (R 4.3.3)\n##  hardhat             1.4.2      2025-08-20 [1] CRAN (R 4.3.0)\n##  hdf5r             * 1.3.12     2025-01-20 [1] CRAN (R 4.3.3)\n##  hexbin              1.28.5     2024-11-13 [1] CRAN (R 4.3.3)\n##  hms                 1.1.3      2023-03-21 [1] CRAN (R 4.3.0)\n##  htmltools         * 0.5.8.1    2024-04-04 [1] CRAN (R 4.3.3)\n##  htmlwidgets         1.6.4      2023-12-06 [1] CRAN (R 4.3.1)\n##  httpuv              1.6.16     2025-04-16 [1] CRAN (R 4.3.3)\n##  httr              * 1.4.7      2023-08-15 [1] CRAN (R 4.3.0)\n##  httr2             * 1.2.1      2025-07-22 [1] CRAN (R 4.3.0)\n##  interp              1.1-6      2024-01-26 [1] CRAN (R 4.3.3)\n##  ipred               0.9-15     2024-07-18 [1] CRAN (R 4.3.3)\n##  iterators           1.0.14     2022-02-05 [1] CRAN (R 4.3.3)\n##  jpeg                0.1-11     2025-03-21 [1] CRAN (R 4.3.3)\n##  jquerylib           0.1.4      2021-04-26 [1] CRAN (R 4.3.3)\n##  jsonify             1.2.2      2022-11-09 [1] CRAN (R 4.3.3)\n##  jsonlite          * 2.0.0      2025-03-27 [1] CRAN (R 4.3.3)\n##  KernSmooth          2.23-26    2025-01-01 [1] CRAN (R 4.3.3)\n##  knitr               1.50       2025-03-16 [1] CRAN (R 4.3.3)\n##  later               1.4.4      2025-08-27 [1] CRAN (R 4.3.0)\n##  lattice           * 0.22-7     2025-04-02 [1] CRAN (R 4.3.3)\n##  latticeExtra        0.6-30     2022-07-04 [1] CRAN (R 4.3.3)\n##  lava                1.8.1      2025-01-12 [1] CRAN (R 4.3.3)\n##  lazyeval            0.2.2      2019-03-15 [1] CRAN (R 4.3.3)\n##  leafem            * 0.2.5      2025-08-28 [1] CRAN (R 4.3.0)\n##  leafgl            * 0.2.2      2024-11-13 [1] CRAN (R 4.3.3)\n##  leaflegend          1.2.1      2024-05-09 [1] CRAN (R 4.3.3)\n##  leaflet           * 2.2.2      2024-03-26 [1] CRAN (R 4.3.1)\n##  leaflet.providers * 2.0.0      2023-10-17 [1] CRAN (R 4.3.3)\n##  leafpop             0.1.0      2021-05-22 [1] CRAN (R 4.3.0)\n##  leafsync            0.1.0      2019-03-05 [1] CRAN (R 4.3.0)\n##  libgeos           * 3.11.1-3   2025-03-19 [1] CRAN (R 4.3.3)\n##  lifecycle           1.0.4      2023-11-07 [1] CRAN (R 4.3.3)\n##  listenv             0.9.1      2024-01-29 [1] CRAN (R 4.3.3)\n##  logger              0.4.0      2024-10-22 [1] CRAN (R 4.3.3)\n##  lubridate         * 1.9.4      2024-12-08 [1] CRAN (R 4.3.3)\n##  luz               * 0.5.0      2025-07-29 [1] CRAN (R 4.3.0)\n##  lwgeom            * 0.2-14     2024-02-21 [1] CRAN (R 4.3.1)\n##  magrittr            2.0.4      2025-09-12 [1] CRAN (R 4.3.0)\n##  mapedit           * 0.7.0      2025-04-20 [1] CRAN (R 4.3.3)\n##  maptiles          * 0.10.0     2025-05-07 [1] CRAN (R 4.3.3)\n##  mapview           * 2.11.2     2023-10-13 [1] CRAN (R 4.3.1)\n##  MASS                7.3-60.0.1 2024-01-13 [1] CRAN (R 4.3.1)\n##  Matrix              1.6-5      2024-01-11 [1] CRAN (R 4.3.1)\n##  memoise             2.0.1      2021-11-26 [1] CRAN (R 4.3.3)\n##  mgcv              * 1.9-3      2025-04-04 [1] CRAN (R 4.3.0)\n##  microbenchmark      1.5.0      2024-09-04 [1] CRAN (R 4.3.3)\n##  mime                0.13       2025-03-17 [1] CRAN (R 4.3.3)\n##  miniUI              0.1.2      2025-04-17 [1] CRAN (R 4.3.3)\n##  ModelMetrics        1.2.2.2    2020-03-17 [1] CRAN (R 4.3.3)\n##  modeltools          0.2-24     2025-05-02 [1] CRAN (R 4.3.3)\n##  ncdf4             * 1.24       2025-03-25 [1] CRAN (R 4.3.3)\n##  nlme              * 3.1-168    2025-03-31 [1] CRAN (R 4.3.3)\n##  nnet              * 7.3-20     2025-01-01 [1] CRAN (R 4.3.3)\n##  openxlsx          * 4.2.8      2025-01-25 [1] CRAN (R 4.3.3)\n##  pacman              0.5.1      2019-03-11 [1] CRAN (R 4.3.3)\n##  parallelly          1.45.1     2025-07-24 [1] CRAN (R 4.3.0)\n##  pillar              1.11.0     2025-07-04 [1] CRAN (R 4.3.3)\n##  pkgbuild            1.4.8      2025-05-26 [1] CRAN (R 4.3.3)\n##  pkgconfig           2.0.3      2019-09-22 [1] CRAN (R 4.3.3)\n##  pkgload             1.4.0      2024-06-28 [1] CRAN (R 4.3.3)\n##  plotly            * 4.11.0     2025-06-19 [1] CRAN (R 4.3.3)\n##  plyr                1.8.9      2023-10-02 [1] CRAN (R 4.3.3)\n##  png                 0.1-8      2022-11-29 [1] CRAN (R 4.3.3)\n##  prettyunits         1.2.0      2023-09-24 [1] CRAN (R 4.3.3)\n##  pROC                1.19.0.1   2025-07-31 [1] CRAN (R 4.3.0)\n##  processx            3.8.6      2025-02-21 [1] CRAN (R 4.3.3)\n##  prodlim             2025.04.28 2025-04-28 [1] CRAN (R 4.3.3)\n##  profvis             0.4.0      2024-09-20 [1] CRAN (R 4.3.3)\n##  progress            1.2.3      2023-12-06 [1] CRAN (R 4.3.1)\n##  progressr           0.15.1     2024-11-22 [1] CRAN (R 4.3.3)\n##  PROJ              * 0.6.0      2025-04-03 [1] CRAN (R 4.3.3)\n##  proj4             * 1.0-15     2025-03-21 [1] CRAN (R 4.3.3)\n##  promises            1.3.3      2025-05-29 [1] CRAN (R 4.3.3)\n##  proxy             * 0.4-27     2022-06-09 [1] CRAN (R 4.3.3)\n##  ps                  1.9.1      2025-04-12 [1] CRAN (R 4.3.3)\n##  purrr             * 1.1.0      2025-07-10 [1] CRAN (R 4.3.0)\n##  R6                  2.6.1      2025-02-15 [1] CRAN (R 4.3.3)\n##  randomForest      * 4.7-1.2    2024-09-22 [1] CRAN (R 4.3.3)\n##  rappdirs            0.3.3      2021-01-31 [1] CRAN (R 4.3.3)\n##  raster            * 3.6-32     2025-03-28 [1] CRAN (R 4.3.3)\n##  rasterVis         * 0.51.6     2023-11-01 [1] CRAN (R 4.3.3)\n##  rayshader         * 0.37.3     2024-02-21 [1] CRAN (R 4.3.1)\n##  rayvertex         * 0.12.0     2025-02-03 [1] CRAN (R 4.3.3)\n##  RColorBrewer      * 1.1-3      2022-04-03 [1] CRAN (R 4.3.3)\n##  Rcpp                1.1.0      2025-07-02 [1] CRAN (R 4.3.3)\n##  RcppParallel        5.1.11-1   2025-08-27 [1] CRAN (R 4.3.0)\n##  RCurl               1.98-1.17  2025-03-22 [1] CRAN (R 4.3.3)\n##  readr             * 2.1.5      2024-01-10 [1] CRAN (R 4.3.1)\n##  recipes             1.3.1      2025-05-21 [1] CRAN (R 4.3.3)\n##  remotes             2.5.0      2024-03-17 [1] CRAN (R 4.3.3)\n##  reshape2            1.4.4      2020-04-09 [1] CRAN (R 4.3.0)\n##  rex                 1.2.1      2021-11-26 [1] CRAN (R 4.3.3)\n##  rgl               * 1.3.24     2025-06-25 [1] CRAN (R 4.3.3)\n##  rlang               1.1.6      2025-04-11 [1] CRAN (R 4.3.3)\n##  rmarkdown           2.29       2024-11-04 [1] CRAN (R 4.3.3)\n##  rpart               4.1.24     2025-01-07 [1] CRAN (R 4.3.3)\n##  rsconnect         * 1.5.1      2025-08-28 [1] CRAN (R 4.3.0)\n##  RSpectra            0.16-2     2024-07-18 [1] CRAN (R 4.3.3)\n##  rstatix             0.7.2      2023-02-01 [1] CRAN (R 4.3.0)\n##  RStoolbox         * 1.0.2.1    2025-02-03 [1] CRAN (R 4.3.3)\n##  rstudioapi          0.17.1     2024-10-22 [1] CRAN (R 4.3.3)\n##  rts               * 1.1-14     2023-10-01 [1] CRAN (R 4.3.3)\n##  Rttf2pt1            1.3.12     2023-01-22 [1] CRAN (R 4.3.3)\n##  s2                * 1.1.9      2025-05-23 [1] CRAN (R 4.3.3)\n##  sass                0.4.10     2025-04-11 [1] CRAN (R 4.3.3)\n##  satellite           1.0.6      2025-08-21 [1] CRAN (R 4.3.0)\n##  scales            * 1.4.0      2025-04-24 [1] CRAN (R 4.3.3)\n##  sessioninfo         1.2.3      2025-02-05 [1] CRAN (R 4.3.3)\n##  sf                * 1.0-22     2025-08-25 [1] Github (r-spatial/sf@3660edf)\n##  shiny               1.11.1     2025-07-03 [1] CRAN (R 4.3.3)\n##  shinyjs             2.1.0      2021-12-23 [1] CRAN (R 4.3.0)\n##  shinyWidgets        0.9.0      2025-02-21 [1] CRAN (R 4.3.3)\n##  sp                * 2.2-0      2025-02-01 [1] CRAN (R 4.3.3)\n##  spacesXYZ           1.6-0      2025-06-06 [1] CRAN (R 4.3.3)\n##  spData            * 2.3.4      2025-01-08 [1] CRAN (R 4.3.3)\n##  spdep             * 1.4-1      2025-08-31 [1] CRAN (R 4.3.0)\n##  stars             * 0.6-8      2025-02-01 [1] CRAN (R 4.3.3)\n##  stringi             1.8.7      2025-03-27 [1] CRAN (R 4.3.3)\n##  stringr           * 1.5.2      2025-09-08 [1] CRAN (R 4.3.0)\n##  supercells        * 1.0.0      2024-02-11 [1] CRAN (R 4.3.1)\n##  survival            3.8-3      2024-12-17 [1] CRAN (R 4.3.3)\n##  svglite             2.2.1      2025-05-12 [1] CRAN (R 4.3.3)\n##  systemfonts         1.2.3      2025-04-30 [1] CRAN (R 4.3.3)\n##  terra             * 1.8-60     2025-07-21 [1] CRAN (R 4.3.0)\n##  terrainr          * 0.7.6      2025-07-25 [1] CRAN (R 4.3.0)\n##  testthat          * 3.2.3      2025-01-13 [1] CRAN (R 4.3.3)\n##  textshaping         1.0.3      2025-09-02 [1] CRAN (R 4.3.0)\n##  tibble            * 3.3.0      2025-06-08 [1] CRAN (R 4.3.3)\n##  tidyr             * 1.3.1      2024-01-24 [1] CRAN (R 4.3.1)\n##  tidyselect          1.2.1      2024-03-11 [1] CRAN (R 4.3.1)\n##  tidyterra         * 0.7.2      2025-04-14 [1] CRAN (R 4.3.3)\n##  tidyverse         * 2.0.0      2023-02-22 [1] CRAN (R 4.3.0)\n##  timechange          0.3.0      2024-01-18 [1] CRAN (R 4.3.3)\n##  timeDate            4041.110   2024-09-22 [1] CRAN (R 4.3.3)\n##  tmap              * 4.1        2025-05-12 [1] CRAN (R 4.3.3)\n##  tmaptools         * 3.2        2025-01-13 [1] CRAN (R 4.3.3)\n##  torch               0.16.0     2025-08-21 [1] CRAN (R 4.3.0)\n##  tzdb                0.5.0      2025-03-15 [1] CRAN (R 4.3.3)\n##  unifir              0.2.4      2024-02-01 [1] CRAN (R 4.3.3)\n##  units               0.8-7      2025-03-11 [1] CRAN (R 4.3.3)\n##  urlchecker          1.0.1      2021-11-30 [1] CRAN (R 4.3.3)\n##  usethis             3.1.0      2024-11-26 [1] CRAN (R 4.3.3)\n##  uuid                1.2-1      2024-07-29 [1] CRAN (R 4.3.3)\n##  vctrs               0.6.5      2023-12-01 [1] CRAN (R 4.3.3)\n##  viridis             0.6.5      2024-01-29 [1] CRAN (R 4.3.1)\n##  viridisLite         0.4.2      2023-05-02 [1] CRAN (R 4.3.3)\n##  visNetwork          2.1.2      2022-09-29 [1] CRAN (R 4.3.0)\n##  withr               3.0.2      2024-10-28 [1] CRAN (R 4.3.3)\n##  wk                  0.9.4      2024-10-11 [1] CRAN (R 4.3.3)\n##  xfun                0.53       2025-08-19 [1] CRAN (R 4.3.0)\n##  xgboost           * 1.7.11.1   2025-05-15 [1] CRAN (R 4.3.3)\n##  XML                 3.99-0.18  2025-01-01 [1] CRAN (R 4.3.3)\n##  xtable              1.8-4      2019-04-21 [1] CRAN (R 4.3.3)\n##  xts               * 0.14.1     2024-10-15 [1] CRAN (R 4.3.3)\n##  yaml                2.3.10     2024-07-26 [1] CRAN (R 4.3.3)\n##  yulab.utils         0.2.1      2025-08-19 [1] CRAN (R 4.3.0)\n##  zeallot             0.2.0      2025-05-27 [1] CRAN (R 4.3.3)\n##  zip                 2.3.3      2025-05-13 [1] CRAN (R 4.3.3)\n##  zoo               * 1.8-14     2025-04-10 [1] CRAN (R 4.3.3)\n## \n##  [1] /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/library\n##  * ── Packages attached to the search path.\n## \n## ──────────────────────────────────────────────────────────",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Topography</span>"
    ]
  },
  {
    "objectID": "04-topography/index.html#footnotes",
    "href": "04-topography/index.html#footnotes",
    "title": "\n4  Topography\n",
    "section": "",
    "text": "Breach-fill algorithm by Lindsay’s paper (2016) “Efficient hybrid breaching-filling sink removal methods for flow path enforcement in digital elevation models: Efficient Hybrid Sink Removal Methods for Flow Path Enforcement: (Hydrological Processes 30, 846–857. doi:10.1002/hyp.10648) -&gt; flowdem::comp_breach_lindsay2016(dem)↩︎",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Topography</span>"
    ]
  },
  {
    "objectID": "05-climate/index.html",
    "href": "05-climate/index.html",
    "title": "\n5  Climate\n",
    "section": "",
    "text": "5.1 1. Import AOI Data\ndownload.file(\n  url      = \"https://data.hydrosheds.org/file/HydroBASINS/customized_with_lakes/hybas_lake_na_lev06_v1c.zip\",\n  destfile = \"../assets/SHP/watersheds_na_l6.zip\",\n  mode     = \"wb\"\n  )\n\nunzip(\n  zipfile = \"../assets/SHP/watersheds_na_l6.zip\",\n  exdir   = \"../assets/SHP/\"\n  )\n\nxy         = \"49.95,-119.43\"\nwatersheds = sf::st_read(\"../assets/SHP/watersheds_na_l6/hybas_lake_na_lev06_v1c.shp\")\naoi_xy     = sf::st_read(\"../assets/SHP/aoi_xy.shp\")\naoi        = watersheds |&gt; sf::st_intersection(aoi_xy) \nsf::st_write(aoi, \"../assets/SHP/aoi_watershed.shp\")\n\ntmap::tmap_mode(\"view\")\ntmap::tm_shape(aoi) + tmap::tm_borders(col=\"purple\", lwd=2) +\n  tmap::tm_scalebar(position=c(\"RIGHT\", \"BOTTOM\"), text.size = .5) +\n  tmap::tm_title(\"AOI Waterhsed\", size=.8)",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Climate</span>"
    ]
  },
  {
    "objectID": "05-climate/index.html#import-dem-data",
    "href": "05-climate/index.html#import-dem-data",
    "title": "\n5  Climate\n",
    "section": "\n5.2 2. Import DEM Data",
    "text": "5.2 2. Import DEM Data\nNote: More efficient conditioning algorithms available with RichDEM library 1\n\n# z = 12: 1-Arc Second \n# z = 11: 3-Arc Second \n# z = 10: 5-Arc Second \n#Download and process DEM \ndem = elevatr::get_elev_raster(aoi, z=10,clip=\"locations\")|&gt;\n  terra::rast() |&gt; \n  terra::crop(terra::vect(aoi)) |&gt;\n  flowdem::breach() |&gt;\n  flowdem::fill(epsilon=T) \n\nraster::writeRaster(dem, \"../assets/TIF/dem_5arc_condt_kelowna.tif\", overwrite=T)",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Climate</span>"
    ]
  },
  {
    "objectID": "05-climate/index.html#import-climate-data",
    "href": "05-climate/index.html#import-climate-data",
    "title": "\n5  Climate\n",
    "section": "\n5.3 3. Import Climate Data",
    "text": "5.3 3. Import Climate Data\nClimate data, a fundamental input for wildfire weather calculations, is sourced from Environment and Climate Change Canada using the weathercan package. This approach replaces the manual data sourcing from platforms with reproducible, verifiable solution. The workflow begins by searching for all weather stations within a specified radius of the AOI. Hourly data for these stations is downloaded for the defined date range and then aggregated to a single mean value for each station for the target period. The cleaned, point-based spatial data is converted into continuous raster layers for each input variable, which are derived using Inverse Distance Weighting (IDW) method via a gstat model and the terra::interpolate function. The resulting outputs of mean daily temperature, precipitation, relative humidity, and wind speed are then masked to the AOI and saved for use in the next stages of the analysis.\n\n# Search weather stations\nstations_100km = weathercan::stations_search(\n  coords  = c(49.95,-119.43), \n  interval= \"day\",\n  dist    = 100)\n\n# Parse by station\nstations_ids_unique &lt;- stations_100km |&gt;\n  dplyr::pull(station_id) |&gt; unique()\n\n# Download data for all selected stations\nclimate_tbl &lt;- weathercan::weather_dl(\n  station_ids = stations_ids_unique,\n  start = \"2021-06-01\",\n  end = \"2021-10-01\",\n  interval = \"hour\") # relative humidity in hourly only\n\n# Aggregate by station\naggregated_data &lt;- climate_tbl |&gt;\n  dplyr::group_by(station_id, lat, lon) |&gt;\n  dplyr::summarise(\n    mean_temp = mean(temp, na.rm = TRUE),\n    mean_prec = mean(prec_amt, na.rm = TRUE),\n    mean_rh   = mean(rel_hum, na.rm = TRUE),\n    mean_ws   = mean(wind_spd, na.rm = TRUE)\n  ) |&gt;\n  dplyr::ungroup()\n\n# Convert to spatial and filter missing stations\nclimate_sf &lt;- aggregated_data |&gt;\n  dplyr::filter(\n    !is.nan(mean_temp),\n    !is.nan(mean_prec),\n    !is.nan(mean_rh),\n    !is.nan(mean_ws)\n  ) |&gt;\n  sf::st_as_sf(\n    coords = c(\"lon\", \"lat\"),\n    crs = 4326\n  ) |&gt;\n  sf::st_transform(\"EPSG:3857\")\n\n# Derive raster template to interpolate on top of\nraster_template &lt;- terra::rast(\"../assets/TIF/elevation.tif\")\n\n# Derive function to handle `sf` weather station data\ninterpolate_stations &lt;- function(model, x, crs, ...) {\n    v &lt;- st_as_sf(x, coords = c(\"x\", \"y\"), crs = crs)\n    p &lt;- predict(model, v, ...)\n    as.data.frame(p)[, 1:2]\n  }\n\n# Create Inverse Distance Weighting models using gstat.pkg\ntemp_idw &lt;- gstat(\n  formula = mean_temp ~ 1, \n  locations = climate_sf,\n  nmax = 8, \n  set = list(idp = 2.0) \n  )\n\nprec_idw &lt;- gstat(\n  formula = mean_prec ~ 1, \n  locations = climate_sf,\n  nmax = 8, \n  set = list(idp = 2.0) \n  )\n\nrh_idw &lt;- gstat(\n  formula = mean_rh ~ 1, \n  locations = climate_sf,\n  nmax = 8, \n  set = list(idp = 2.0) \n  )\n\nws_idw &lt;- gstat(\n  formula = mean_ws ~ 1, \n  locations = climate_sf,\n  nmax = 8, \n  set = list(idp = 2.0) \n  )\n\n\n# Spatially interpolate using terra.pkg\ntemp_rast &lt;- terra::interpolate(\n  object = raster_template,\n  model = temp_idw,\n  fun = interpolate_stations,\n  crs = \"EPSG:3857\",\n  debug.level = 0\n)\n\nprec_rast &lt;- terra::interpolate(\n  object = raster_template,\n  model = prec_idw,\n  fun = interpolate_stations,\n  crs = \"EPSG:3857\",\n  debug.level = 0\n)\n\nrh_rast &lt;- terra::interpolate(\n  object = raster_template,\n  model = rh_idw,\n  fun = interpolate_stations,\n  crs = \"EPSG:3857\",\n  debug.level = 0\n)\n\nws_rast &lt;- terra::interpolate(\n  object = raster_template,\n  model = ws_idw,\n  fun = interpolate_stations,\n  crs = \"EPSG:3857\",\n  debug.level = 0\n)\n\n# Tidy, save, and visualize\ntemp    = terra::mask(temp_rast, terra::vect(sf::st_transform(aoi, \"EPSG:3857\")))\nprec    = terra::mask(prec_rast, terra::vect(sf::st_transform(aoi, \"EPSG:3857\")))\nrh      = terra::mask(rh_rast, terra::vect(sf::st_transform(aoi, \"EPSG:3857\")))\nws      = terra::mask(ws_rast, terra::vect(sf::st_transform(aoi, \"EPSG:3857\")))\n\nterra::writeRaster(temp, \"../assets/TIF/temp.tif\", overwrite=T)\nterra::writeRaster(prec, \"../assets/TIF/prec.tif\", overwrite=T)\nterra::writeRaster(rh, \"../assets/TIF/rh.tif\", overwrite=T)\nterra::writeRaster(ws, \"../assets/TIF/ws.tif\", overwrite=T)",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Climate</span>"
    ]
  },
  {
    "objectID": "05-climate/index.html#render-maps",
    "href": "05-climate/index.html#render-maps",
    "title": "\n5  Climate\n",
    "section": "\n5.4 4. Render Maps",
    "text": "5.4 4. Render Maps\n\n\ntmap::tmap_mode(\"plot\")\ntmap::tm_shape(temp)+ tm_raster(style= \"cont\", \n  title=\"Mean Daily Temperature (°C 2m AGL)\", palette=\"Oranges\")+\n  tmap::tm_shape(aoi)+ tm_borders(col=\"purple\", lwd = 2) +\n  tmap::tm_compass(color.dark=\"gray60\",text.color=\"gray60\",position=c(\"RIGHT\",\"top\"))+\n  tmap::tm_graticules(lines=T,labels.rot=c(0,90),lwd=0.2) +\n  tmap::tm_scale_bar(c(0, 10, 20, 40), position = c(\"RIGHT\", \"BOTTOM\"), text.size = .5) -&gt; tm1\n\ntmap::tm_shape(prec)+ tm_raster(style= \"cont\", \n  title=\"Mean Daily Precipitation (mm^3/day)\", palette=\"Oranges\") +\n  tmap::tm_shape(aoi)+ tm_borders(col=\"purple\", lwd = 2) +\n  tmap::tm_compass(color.dark=\"gray60\",text.color=\"gray60\",position=c(\"RIGHT\",\"top\"))+\n  tmap::tm_graticules(lines=T,labels.rot=c(0,90),lwd=0.2) +\n  tmap::tm_scale_bar(c(0, 10, 20, 40), position = c(\"RIGHT\", \"BOTTOM\"), text.size = .5) -&gt; tm2\n  \ntmap::tm_shape(rh)+ tm_raster(style= \"cont\", \n  title=\"Relative Humidity (NCDC 2m AGL)\", palette=\"Oranges\") +\n  tmap::tm_shape(aoi)+ tm_borders(col=\"purple\", lwd = 2) +\n  tmap::tm_compass(color.dark=\"gray60\",text.color=\"gray60\",position=c(\"RIGHT\",\"top\"))+\n  tmap::tm_graticules(lines=T,labels.rot=c(0,90),lwd=0.2) +\n  tmap::tm_scale_bar(c(0, 10, 20, 40), position = c(\"RIGHT\", \"BOTTOM\"), text.size = .5) -&gt; tm3\n\ntmap::tm_shape(ws)+ tm_raster(style= \"cont\", \n  title=\"Wind Speed (m/s 10m AGL)\", palette=\"Oranges\") +\n  tmap::tm_shape(aoi)+ tm_borders(col=\"purple\", lwd = 2) +\n  tmap::tm_compass(color.dark=\"gray60\",text.color=\"gray60\",position=c(\"RIGHT\",\"top\"))+\n  tmap::tm_graticules(lines=T,labels.rot=c(0,90),lwd=0.2) +\n  tmap::tm_scale_bar(c(0, 10, 20, 40), position = c(\"RIGHT\", \"BOTTOM\"), text.size = .5) -&gt; tm4\n\ntmap::tmap_arrange(tm1, tm2, tm3, tm4, nrow=2)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nRuntime Log\n\ndevtools::session_info()\n## ─ Session info ───────────────────────────────────────────\n##  setting  value\n##  version  R version 4.3.0 (2023-04-21)\n##  os       macOS 15.7.1\n##  system   aarch64, darwin20\n##  ui       X11\n##  language (EN)\n##  collate  en_US.UTF-8\n##  ctype    en_US.UTF-8\n##  tz       America/Vancouver\n##  date     2025-11-03\n##  pandoc   3.8 @ /opt/local/bin/ (via rmarkdown)\n##  quarto   1.7.33 @ /usr/local/bin/quarto\n## \n## ─ Packages ───────────────────────────────────────────────\n##  package           * version   date (UTC) lib source\n##  abind               1.4-8     2024-09-12 [1] CRAN (R 4.3.3)\n##  backports           1.5.0     2024-05-23 [1] CRAN (R 4.3.3)\n##  base64enc           0.1-3     2015-07-28 [1] CRAN (R 4.3.3)\n##  bibtex            * 0.5.1     2023-01-26 [1] CRAN (R 4.3.3)\n##  brew                1.0-10    2023-12-16 [1] CRAN (R 4.3.3)\n##  bslib               0.9.0     2025-01-30 [1] CRAN (R 4.3.3)\n##  cachem              1.1.0     2024-05-16 [1] CRAN (R 4.3.3)\n##  cartogram           0.3.0     2023-05-26 [1] CRAN (R 4.3.0)\n##  cffdrs            * 1.9.2     2025-08-22 [1] CRAN (R 4.3.0)\n##  chromote          * 0.5.1     2025-04-24 [1] CRAN (R 4.3.3)\n##  class               7.3-23    2025-01-01 [1] CRAN (R 4.3.3)\n##  classInt            0.4-11    2025-01-08 [1] CRAN (R 4.3.3)\n##  cli                 3.6.5     2025-04-23 [1] CRAN (R 4.3.3)\n##  codetools           0.2-20    2024-03-31 [1] CRAN (R 4.3.1)\n##  colorspace          2.1-1     2024-07-26 [1] CRAN (R 4.3.3)\n##  cols4all          * 0.9       2025-08-28 [1] CRAN (R 4.3.0)\n##  coro                1.1.0     2024-11-05 [1] CRAN (R 4.3.3)\n##  crosstalk           1.2.2     2025-08-26 [1] CRAN (R 4.3.0)\n##  curl              * 7.0.0     2025-08-19 [1] CRAN (R 4.3.0)\n##  data.table          1.17.8    2025-07-10 [1] CRAN (R 4.3.3)\n##  DBI                 1.2.3     2024-06-02 [1] CRAN (R 4.3.3)\n##  deldir              2.0-4     2024-02-28 [1] CRAN (R 4.3.3)\n##  devtools          * 2.4.5     2022-10-11 [1] CRAN (R 4.3.0)\n##  dichromat           2.0-0.1   2022-05-02 [1] CRAN (R 4.3.3)\n##  digest              0.6.37    2024-08-19 [1] CRAN (R 4.3.3)\n##  doParallel          1.0.17    2022-02-07 [1] CRAN (R 4.3.3)\n##  dplyr             * 1.1.4     2023-11-17 [1] CRAN (R 4.3.1)\n##  e1071               1.7-16    2024-09-16 [1] CRAN (R 4.3.3)\n##  elevatr           * 0.99.0    2023-09-12 [1] CRAN (R 4.3.0)\n##  ellipsis            0.3.2     2021-04-29 [1] CRAN (R 4.3.3)\n##  ellmer            * 0.2.1     2025-06-03 [1] CRAN (R 4.3.3)\n##  evaluate            1.0.5     2025-08-27 [1] CRAN (R 4.3.0)\n##  farver              2.1.2     2024-05-13 [1] CRAN (R 4.3.3)\n##  fastmap             1.2.0     2024-05-15 [1] CRAN (R 4.3.3)\n##  FNN                 1.1.4.1   2024-09-22 [1] CRAN (R 4.3.3)\n##  foreach             1.5.2     2022-02-02 [1] CRAN (R 4.3.3)\n##  fs                  1.6.6     2025-04-12 [1] CRAN (R 4.3.3)\n##  generics            0.1.4     2025-05-09 [1] CRAN (R 4.3.3)\n##  geonetwork        * 0.6.0     2025-07-23 [1] CRAN (R 4.3.0)\n##  ggplot2           * 3.5.2     2025-04-09 [1] CRAN (R 4.3.3)\n##  glue                1.8.0     2024-09-30 [1] CRAN (R 4.3.3)\n##  gstat             * 2.1-4     2025-07-10 [1] CRAN (R 4.3.3)\n##  gtable              0.3.6     2024-10-25 [1] CRAN (R 4.3.3)\n##  hexbin              1.28.5    2024-11-13 [1] CRAN (R 4.3.3)\n##  htmltools         * 0.5.8.1   2024-04-04 [1] CRAN (R 4.3.3)\n##  htmlwidgets         1.6.4     2023-12-06 [1] CRAN (R 4.3.1)\n##  httpuv              1.6.16    2025-04-16 [1] CRAN (R 4.3.3)\n##  httr2             * 1.2.1     2025-07-22 [1] CRAN (R 4.3.0)\n##  igraph              2.1.4     2025-01-23 [1] CRAN (R 4.3.3)\n##  interp              1.1-6     2024-01-26 [1] CRAN (R 4.3.3)\n##  intervals           0.15.5    2024-08-23 [1] CRAN (R 4.3.3)\n##  iterators           1.0.14    2022-02-05 [1] CRAN (R 4.3.3)\n##  janitor           * 2.2.1     2024-12-22 [1] CRAN (R 4.3.3)\n##  jpeg                0.1-11    2025-03-21 [1] CRAN (R 4.3.3)\n##  jquerylib           0.1.4     2021-04-26 [1] CRAN (R 4.3.3)\n##  jsonlite            2.0.0     2025-03-27 [1] CRAN (R 4.3.3)\n##  kableExtra        * 1.4.0     2024-01-24 [1] CRAN (R 4.3.1)\n##  KernSmooth          2.23-26   2025-01-01 [1] CRAN (R 4.3.3)\n##  knitr             * 1.50      2025-03-16 [1] CRAN (R 4.3.3)\n##  later               1.4.4     2025-08-27 [1] CRAN (R 4.3.0)\n##  lattice           * 0.22-7    2025-04-02 [1] CRAN (R 4.3.3)\n##  latticeExtra        0.6-30    2022-07-04 [1] CRAN (R 4.3.3)\n##  leafem              0.2.5     2025-08-28 [1] CRAN (R 4.3.0)\n##  leaflegend          1.2.1     2024-05-09 [1] CRAN (R 4.3.3)\n##  leaflet             2.2.2     2024-03-26 [1] CRAN (R 4.3.1)\n##  leaflet.providers   2.0.0     2023-10-17 [1] CRAN (R 4.3.3)\n##  leafpop             0.1.0     2021-05-22 [1] CRAN (R 4.3.0)\n##  leafsync            0.1.0     2019-03-05 [1] CRAN (R 4.3.0)\n##  lifecycle           1.0.4     2023-11-07 [1] CRAN (R 4.3.3)\n##  logger              0.4.0     2024-10-22 [1] CRAN (R 4.3.3)\n##  lubridate           1.9.4     2024-12-08 [1] CRAN (R 4.3.3)\n##  lutz              * 0.3.2     2023-10-17 [1] CRAN (R 4.3.3)\n##  lwgeom              0.2-14    2024-02-21 [1] CRAN (R 4.3.1)\n##  magrittr            2.0.4     2025-09-12 [1] CRAN (R 4.3.0)\n##  mapedit           * 0.7.0     2025-04-20 [1] CRAN (R 4.3.3)\n##  maptiles            0.10.0    2025-05-07 [1] CRAN (R 4.3.3)\n##  mapview           * 2.11.2    2023-10-13 [1] CRAN (R 4.3.1)\n##  memoise             2.0.1     2021-11-26 [1] CRAN (R 4.3.3)\n##  microbenchmark      1.5.0     2024-09-04 [1] CRAN (R 4.3.3)\n##  mime                0.13      2025-03-17 [1] CRAN (R 4.3.3)\n##  miniUI              0.1.2     2025-04-17 [1] CRAN (R 4.3.3)\n##  ncdf4             * 1.24      2025-03-25 [1] CRAN (R 4.3.3)\n##  OpenStreetMap     * 0.4.0     2023-10-12 [1] CRAN (R 4.3.1)\n##  openxlsx          * 4.2.8     2025-01-25 [1] CRAN (R 4.3.3)\n##  osmdata           * 0.2.5     2023-08-14 [1] CRAN (R 4.3.0)\n##  packcircles         0.3.7     2024-11-21 [1] CRAN (R 4.3.3)\n##  pacman              0.5.1     2019-03-11 [1] CRAN (R 4.3.3)\n##  pandoc            * 0.2.0     2023-08-24 [1] CRAN (R 4.3.3)\n##  pandocfilters     * 0.1-6     2022-08-11 [1] CRAN (R 4.3.3)\n##  pillar              1.11.0    2025-07-04 [1] CRAN (R 4.3.3)\n##  pkgbuild            1.4.8     2025-05-26 [1] CRAN (R 4.3.3)\n##  pkgconfig           2.0.3     2019-09-22 [1] CRAN (R 4.3.3)\n##  pkgload             1.4.0     2024-06-28 [1] CRAN (R 4.3.3)\n##  plyr                1.8.9     2023-10-02 [1] CRAN (R 4.3.3)\n##  png                 0.1-8     2022-11-29 [1] CRAN (R 4.3.3)\n##  processx            3.8.6     2025-02-21 [1] CRAN (R 4.3.3)\n##  profvis             0.4.0     2024-09-20 [1] CRAN (R 4.3.3)\n##  progressr           0.15.1    2024-11-22 [1] CRAN (R 4.3.3)\n##  PROJ              * 0.6.0     2025-04-03 [1] CRAN (R 4.3.3)\n##  proj4               1.0-15    2025-03-21 [1] CRAN (R 4.3.3)\n##  promises            1.3.3     2025-05-29 [1] CRAN (R 4.3.3)\n##  proxy               0.4-27    2022-06-09 [1] CRAN (R 4.3.3)\n##  ps                  1.9.1     2025-04-12 [1] CRAN (R 4.3.3)\n##  purrr               1.1.0     2025-07-10 [1] CRAN (R 4.3.0)\n##  R6                  2.6.1     2025-02-15 [1] CRAN (R 4.3.3)\n##  rappdirs            0.3.3     2021-01-31 [1] CRAN (R 4.3.3)\n##  raster            * 3.6-32    2025-03-28 [1] CRAN (R 4.3.3)\n##  rasterVis         * 0.51.6    2023-11-01 [1] CRAN (R 4.3.3)\n##  RColorBrewer        1.1-3     2022-04-03 [1] CRAN (R 4.3.3)\n##  Rcpp                1.1.0     2025-07-02 [1] CRAN (R 4.3.3)\n##  remotes             2.5.0     2024-03-17 [1] CRAN (R 4.3.3)\n##  renv              * 1.1.5     2025-07-24 [1] CRAN (R 4.3.0)\n##  reproj            * 0.7.0     2024-06-11 [1] CRAN (R 4.3.3)\n##  rJava               1.0-11    2024-01-26 [1] CRAN (R 4.3.3)\n##  rlang               1.1.6     2025-04-11 [1] CRAN (R 4.3.3)\n##  rmapshaper        * 0.5.0     2023-04-11 [1] CRAN (R 4.3.0)\n##  rmarkdown         * 2.29      2024-11-04 [1] CRAN (R 4.3.3)\n##  rstudioapi          0.17.1    2024-10-22 [1] CRAN (R 4.3.3)\n##  s2                  1.1.9     2025-05-23 [1] CRAN (R 4.3.3)\n##  S7                  0.2.0     2024-11-07 [1] CRAN (R 4.3.3)\n##  sass                0.4.10    2025-04-11 [1] CRAN (R 4.3.3)\n##  satellite           1.0.6     2025-08-21 [1] CRAN (R 4.3.0)\n##  scales              1.4.0     2025-04-24 [1] CRAN (R 4.3.3)\n##  sessioninfo         1.2.3     2025-02-05 [1] CRAN (R 4.3.3)\n##  sf                * 1.0-22    2025-08-25 [1] Github (r-spatial/sf@3660edf)\n##  shiny               1.11.1    2025-07-03 [1] CRAN (R 4.3.3)\n##  shinyWidgets        0.9.0     2025-02-21 [1] CRAN (R 4.3.3)\n##  snakecase           0.11.1    2023-08-27 [1] CRAN (R 4.3.0)\n##  sp                * 2.2-0     2025-02-01 [1] CRAN (R 4.3.3)\n##  spacesXYZ           1.6-0     2025-06-06 [1] CRAN (R 4.3.3)\n##  spacetime           1.3-3     2025-02-13 [1] CRAN (R 4.3.3)\n##  stars               0.6-8     2025-02-01 [1] CRAN (R 4.3.3)\n##  stringi             1.8.7     2025-03-27 [1] CRAN (R 4.3.3)\n##  stringr             1.5.2     2025-09-08 [1] CRAN (R 4.3.0)\n##  svglite             2.2.1     2025-05-12 [1] CRAN (R 4.3.3)\n##  systemfonts         1.2.3     2025-04-30 [1] CRAN (R 4.3.3)\n##  terra             * 1.8-60    2025-07-21 [1] CRAN (R 4.3.0)\n##  textshaping         1.0.3     2025-09-02 [1] CRAN (R 4.3.0)\n##  tibble              3.3.0     2025-06-08 [1] CRAN (R 4.3.3)\n##  tidyselect          1.2.1     2024-03-11 [1] CRAN (R 4.3.1)\n##  timechange          0.3.0     2024-01-18 [1] CRAN (R 4.3.3)\n##  tinytex           * 0.57      2025-04-15 [1] CRAN (R 4.3.3)\n##  tmap              * 4.1       2025-05-12 [1] CRAN (R 4.3.3)\n##  tmap.cartogram    * 0.2       2025-05-14 [1] CRAN (R 4.3.3)\n##  tmap.glyphs       * 0.1       2025-05-30 [1] CRAN (R 4.3.3)\n##  tmap.networks     * 0.1       2025-05-30 [1] CRAN (R 4.3.3)\n##  tmaptools         * 3.2       2025-01-13 [1] CRAN (R 4.3.3)\n##  units               0.8-7     2025-03-11 [1] CRAN (R 4.3.3)\n##  urlchecker          1.0.1     2021-11-30 [1] CRAN (R 4.3.3)\n##  useful            * 1.2.6.1   2023-10-24 [1] CRAN (R 4.3.1)\n##  usethis           * 3.1.0     2024-11-26 [1] CRAN (R 4.3.3)\n##  uuid                1.2-1     2024-07-29 [1] CRAN (R 4.3.3)\n##  V8                  6.0.4     2025-06-04 [1] CRAN (R 4.3.3)\n##  vctrs               0.6.5     2023-12-01 [1] CRAN (R 4.3.3)\n##  viridisLite         0.4.2     2023-05-02 [1] CRAN (R 4.3.3)\n##  weathercan        * 0.7.5     2025-08-26 [1] https://ropensci.r-universe.dev (R 4.3.0)\n##  websocket           1.4.4     2025-04-10 [1] CRAN (R 4.3.3)\n##  withr               3.0.2     2024-10-28 [1] CRAN (R 4.3.3)\n##  wk                  0.9.4     2024-10-11 [1] CRAN (R 4.3.3)\n##  xfun                0.53      2025-08-19 [1] CRAN (R 4.3.0)\n##  XML                 3.99-0.18 2025-01-01 [1] CRAN (R 4.3.3)\n##  xml2                1.4.0     2025-08-20 [1] CRAN (R 4.3.0)\n##  xtable              1.8-4     2019-04-21 [1] CRAN (R 4.3.3)\n##  xts                 0.14.1    2024-10-15 [1] CRAN (R 4.3.3)\n##  yaml                2.3.10    2024-07-26 [1] CRAN (R 4.3.3)\n##  zip                 2.3.3     2025-05-13 [1] CRAN (R 4.3.3)\n##  zoo                 1.8-14    2025-04-10 [1] CRAN (R 4.3.3)\n## \n##  [1] /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/library\n##  * ── Packages attached to the search path.\n## \n## ──────────────────────────────────────────────────────────",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Climate</span>"
    ]
  },
  {
    "objectID": "05-climate/index.html#footnotes",
    "href": "05-climate/index.html#footnotes",
    "title": "\n5  Climate\n",
    "section": "",
    "text": "Breach-fill algorithm by Lindsay’s paper (2016) “Efficient hybrid breaching-filling sink removal methods for flow path enforcement in digital elevation models: Efficient Hybrid Sink Removal Methods for Flow Path Enforcement: (Hydrological Processes 30, 846–857. doi:10.1002/hyp.10648) -&gt; flowdem::comp_breach_lindsay2016(dem)↩︎",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Climate</span>"
    ]
  },
  {
    "objectID": "06-demography/index.html",
    "href": "06-demography/index.html",
    "title": "\n6  Demography\n",
    "section": "",
    "text": "6.1 1. AOIs & projection\ncrs_master &lt;- st_crs(\"epsg:4326\")\naoi_site   = sf::read_sf(\"../assets/inputs/chilwa_watershed_4326.shp\") |&gt;\n  st_cast() |&gt; st_transform(crs_master)\naoi_country &lt;- giscoR::gisco_get_countries(country = \"Malawi\", resolution = \"3\") |&gt;\n  st_cast() |&gt; st_transform(crs_master)\naoi_region &lt;- giscoR::gisco_get_countries(\n  country = c(\"Malawi\", \"Zambia\", \"Tanzania\", \"Mozambique\"), resolution = \"3\") |&gt;\n  st_cast() |&gt; st_transform(crs_master)\n\n# Interactive map mode: \"view\"\ntmap::tmap_mode(\"view\")\ntmap::tm_shape(aoi_region) +\n  tmap::tm_borders(lwd = 1, col = \"green\") +\n  tmap::tm_shape(aoi_country) +\n  tmap::tm_borders(lwd = 2, col = \"red\")",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Demography</span>"
    ]
  },
  {
    "objectID": "06-demography/index.html#download-population-data",
    "href": "06-demography/index.html#download-population-data",
    "title": "\n6  Demography\n",
    "section": "\n6.2 2. Download population data",
    "text": "6.2 2. Download population data\n\n# Suitable global population data (1x1km resolution is easy convert to pp/km^2)\n#url &lt;- \"https://jeodpp.jrc.ec.europa.eu/ftp/jrc-opendata/GHSL/GHS_POP_GLOBE_R2023A/GHS_POP_E2025_GLOBE_R2023A_54009_1000/V1-0/GHS_POP_E2025_GLOBE_R2023A_54009_1000_V1_0.zip\"\n# file_name = \"GHS_POP_E2025_GLOBE_R2023A_54009_1000_V1_0.tif\"\n# download.file(url = url, path = getwd(), destfile = file_name)\npop = terra::rast(\"../../datasets/POP/GHS_POP_E2025_GLOBE_R2023A_54009_1000_V1_0.tif\")\npop = terra::project(pop, \"EPSG:4326\") # reproject to fix NAs\npop = terra::crop(pop, aoi_country, snap = \"in\", mask = T)\nnames(pop)[1] &lt;- \"density_km\" # number of persons per sq kilometer\n\ntmap::tm_shape(aoi_country) +\n  tmap::tm_borders(lwd = 0) +\n  tmap::tm_shape(pop) +\n  tm_raster(\n    style           = \"fixed\",\n    alpha           = 1,\n    palette         = \"OrRd\",\n    title           = \"People/Km^2\",\n    breaks          = c(0, 0.01, 10, 100, 200, 1000, 2000, 50000)\n  )\n\nraster::writeRaster(pop, \"../../datasets/POP/GHG_POP_Malawi_4326.tif\", overwrite=T)",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Demography</span>"
    ]
  },
  {
    "objectID": "06-demography/index.html#customize-layout",
    "href": "06-demography/index.html#customize-layout",
    "title": "\n6  Demography\n",
    "section": "\n6.3 3. Customize layout",
    "text": "6.3 3. Customize layout\n\n# static mapping mode\ntmap::tmap_mode(\"plot\") \n\ntmap::tm_shape(aoi_country) +\n  tmap::tm_borders(lwd = 0) +\n  tmap::tm_shape(pop) +\n  tm_raster(\n    style           = \"fixed\",\n    alpha           = 1,\n    palette         = \"OrRd\",\n    title           = \"People/Km^2\",\n    breaks          = c(0, 0.01, 10, 100, 200, 1000, 2000, 50000)\n  ) +\n  tmap::tm_shape(aoi_region) +\n  tmap::tm_borders(lwd = 0.5, col = \"black\") +\n  tmap::tm_shape(aoi_site) +\n  tmap::tm_borders(lwd = 1, col = \"red\", fill_alpha = 0.5) +\n  tmap::tm_graticules(\n    lines           = T, \n    labels.rot      = c(0, 90), \n    lwd             = 0.2\n    ) +\n  tmap::tm_scalebar(\n    breaks          = c(0, 50, 100, 200),\n    position        = c(\"RIGHT\", \"BOTTOM\"),\n    text.size       = 0.5\n    ) +\n  tmap::tm_compass(\n    type            = \"4star\",\n    size            = 1,\n    color.dark      = \"gray60\",\n    text.color      = \"gray60\",\n    position        = c(\"LEFT\", \"top\")\n    ) +\n  tmap::tm_credits(\n    text            = \"EPSG:4326\", \n    color           = \"gray60\",\n    size            = 0.5,\n    position        = c(\"left\", \"BOTTOM\")\n    ) +\n  tmap::tm_layout(\n    main.title      = \"Population Density\",\n    title.size      = 1,\n    title.position  = c(\"right\", \"top\"),\n    legend.outside  = FALSE,\n    legend.position = c(\"left\", \"bottom\"),\n    legend.text.size= 0.5,\n    legend.title.size = 0.5\n    ) -&gt; map_population\nmap_population\n\n\n\nFigure 1: Population Map",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Demography</span>"
    ]
  },
  {
    "objectID": "06-demography/index.html#save-output",
    "href": "06-demography/index.html#save-output",
    "title": "\n6  Demography\n",
    "section": "\n6.4 4. Save output",
    "text": "6.4 4. Save output\n\ntmap::tmap_save(map_population, \"../assets/outputs/04-population-map.png\", asp = 0, dpi = 600)\n\n\ndevtools::session_info()\n## ─ Session info ───────────────────────────────────────────\n##  setting  value\n##  version  R version 4.3.0 (2023-04-21)\n##  os       macOS 15.7.1\n##  system   aarch64, darwin20\n##  ui       X11\n##  language (EN)\n##  collate  en_US.UTF-8\n##  ctype    en_US.UTF-8\n##  tz       America/Vancouver\n##  date     2025-11-03\n##  pandoc   3.8 @ /opt/local/bin/ (via rmarkdown)\n##  quarto   1.7.33 @ /usr/local/bin/quarto\n## \n## ─ Packages ───────────────────────────────────────────────\n##  package            * version    date (UTC) lib source\n##  abind              * 1.4-8      2024-09-12 [1] CRAN (R 4.3.3)\n##  ape                  5.8-1      2024-12-16 [1] CRAN (R 4.3.3)\n##  assertthat           0.2.1      2019-03-21 [1] CRAN (R 4.3.3)\n##  backports            1.5.0      2024-05-23 [1] CRAN (R 4.3.3)\n##  base64enc            0.1-3      2015-07-28 [1] CRAN (R 4.3.3)\n##  bit                  4.6.0      2025-03-06 [1] CRAN (R 4.3.3)\n##  bit64                4.6.0-1    2025-01-16 [1] CRAN (R 4.3.3)\n##  bitops               1.0-9      2024-10-03 [1] CRAN (R 4.3.3)\n##  boot                 1.3-32     2025-08-29 [1] CRAN (R 4.3.0)\n##  brew                 1.0-10     2023-12-16 [1] CRAN (R 4.3.3)\n##  brio                 1.1.5      2024-04-24 [1] CRAN (R 4.3.3)\n##  broom                1.0.8      2025-03-28 [1] CRAN (R 4.3.3)\n##  bslib              * 0.9.0      2025-01-30 [1] CRAN (R 4.3.3)\n##  cachem               1.1.0      2024-05-16 [1] CRAN (R 4.3.3)\n##  callr                3.7.6      2024-03-25 [1] CRAN (R 4.3.3)\n##  car                  3.1-3      2024-09-27 [1] CRAN (R 4.3.3)\n##  carData              3.0-5      2022-01-06 [1] CRAN (R 4.3.3)\n##  caret              * 7.0-1      2024-12-10 [1] CRAN (R 4.3.3)\n##  class                7.3-23     2025-01-01 [1] CRAN (R 4.3.3)\n##  classInt             0.4-11     2025-01-08 [1] CRAN (R 4.3.3)\n##  cli                * 3.6.5      2025-04-23 [1] CRAN (R 4.3.3)\n##  clue                 0.3-66     2024-11-13 [1] CRAN (R 4.3.3)\n##  cluster              2.1.8.1    2025-03-12 [1] CRAN (R 4.3.3)\n##  coda                 0.19-4.1   2024-01-31 [1] CRAN (R 4.3.3)\n##  codetools            0.2-20     2024-03-31 [1] CRAN (R 4.3.1)\n##  colorspace           2.1-1      2024-07-26 [1] CRAN (R 4.3.3)\n##  cols4all           * 0.9        2025-08-28 [1] CRAN (R 4.3.0)\n##  contfrac             1.1-12     2018-05-17 [1] CRAN (R 4.3.3)\n##  coro                 1.1.0      2024-11-05 [1] CRAN (R 4.3.3)\n##  corpcor              1.6.10     2021-09-16 [1] CRAN (R 4.3.3)\n##  countrycode          1.6.1      2025-03-31 [1] CRAN (R 4.3.3)\n##  covr               * 3.6.4      2023-11-09 [1] CRAN (R 4.3.1)\n##  cowplot            * 1.2.0      2025-07-07 [1] CRAN (R 4.3.3)\n##  crayon               1.5.3      2024-06-20 [1] CRAN (R 4.3.3)\n##  crosstalk            1.2.2      2025-08-26 [1] CRAN (R 4.3.0)\n##  cubature             2.1.4      2025-06-02 [1] CRAN (R 4.3.3)\n##  data.table           1.17.8     2025-07-10 [1] CRAN (R 4.3.3)\n##  DBI                  1.2.3      2024-06-02 [1] CRAN (R 4.3.3)\n##  deldir               2.0-4      2024-02-28 [1] CRAN (R 4.3.3)\n##  dendextend         * 1.19.1     2025-07-15 [1] CRAN (R 4.3.0)\n##  deSolve              1.40       2023-11-27 [1] CRAN (R 4.3.3)\n##  devtools             2.4.5      2022-10-11 [1] CRAN (R 4.3.0)\n##  DiagrammeR         * 1.0.11     2024-02-02 [1] CRAN (R 4.3.1)\n##  dichromat            2.0-0.1    2022-05-02 [1] CRAN (R 4.3.3)\n##  digest             * 0.6.37     2024-08-19 [1] CRAN (R 4.3.3)\n##  doParallel           1.0.17     2022-02-07 [1] CRAN (R 4.3.3)\n##  downlit            * 0.4.4      2024-06-10 [1] CRAN (R 4.3.3)\n##  dplyr              * 1.1.4      2023-11-17 [1] CRAN (R 4.3.1)\n##  dtw                * 1.23-1     2022-09-19 [1] CRAN (R 4.3.3)\n##  dtwclust           * 6.0.0      2024-07-23 [1] CRAN (R 4.3.3)\n##  e1071              * 1.7-16     2024-09-16 [1] CRAN (R 4.3.3)\n##  easypackages         0.1.0      2016-12-05 [1] CRAN (R 4.3.0)\n##  elevatr            * 0.99.0     2023-09-12 [1] CRAN (R 4.3.0)\n##  ellipsis             0.3.2      2021-04-29 [1] CRAN (R 4.3.3)\n##  elliptic             1.4-0      2019-03-14 [1] CRAN (R 4.3.3)\n##  evaluate             1.0.5      2025-08-27 [1] CRAN (R 4.3.0)\n##  exactextractr      * 0.10.0     2023-09-20 [1] CRAN (R 4.3.1)\n##  extrafont            0.19       2023-01-18 [1] CRAN (R 4.3.3)\n##  extrafontdb          1.0        2012-06-11 [1] CRAN (R 4.3.3)\n##  farver               2.1.2      2024-05-13 [1] CRAN (R 4.3.3)\n##  fastmap              1.2.0      2024-05-15 [1] CRAN (R 4.3.3)\n##  flexclust            1.5.0      2025-02-28 [1] CRAN (R 4.3.3)\n##  FNN                * 1.1.4.1    2024-09-22 [1] CRAN (R 4.3.3)\n##  forcats            * 1.0.0      2023-01-29 [1] CRAN (R 4.3.0)\n##  foreach              1.5.2      2022-02-02 [1] CRAN (R 4.3.3)\n##  Formula              1.2-5      2023-02-24 [1] CRAN (R 4.3.3)\n##  fs                   1.6.6      2025-04-12 [1] CRAN (R 4.3.3)\n##  future             * 1.67.0     2025-07-29 [1] CRAN (R 4.3.0)\n##  future.apply         1.20.0     2025-06-06 [1] CRAN (R 4.3.0)\n##  FuzzyNumbers         0.4-7      2021-11-15 [1] CRAN (R 4.3.3)\n##  FuzzyNumbers.Ext.2   3.2        2017-09-05 [1] CRAN (R 4.3.3)\n##  gdalUtilities      * 1.2.5      2023-08-10 [1] CRAN (R 4.3.0)\n##  generics             0.1.4      2025-05-09 [1] CRAN (R 4.3.3)\n##  geojsonsf          * 2.0.3      2022-05-30 [1] CRAN (R 4.3.3)\n##  geos               * 0.2.4      2023-11-30 [1] CRAN (R 4.3.3)\n##  ggmap              * 4.0.1      2025-04-07 [1] CRAN (R 4.3.3)\n##  ggplot2            * 3.5.2      2025-04-09 [1] CRAN (R 4.3.3)\n##  ggplotify          * 0.1.2      2023-08-09 [1] CRAN (R 4.3.0)\n##  ggpubr             * 0.6.1      2025-06-27 [1] CRAN (R 4.3.3)\n##  ggrepel            * 0.9.6      2024-09-07 [1] CRAN (R 4.3.3)\n##  ggsignif             0.6.4      2022-10-13 [1] CRAN (R 4.3.0)\n##  ggspatial          * 1.1.10     2025-08-24 [1] CRAN (R 4.3.0)\n##  ggstats            * 0.10.0     2025-07-02 [1] CRAN (R 4.3.3)\n##  giscoR             * 0.6.1      2025-08-11 [1] Github (rOpenGov/giscoR@adfed30)\n##  globals              0.18.0     2025-05-08 [1] CRAN (R 4.3.0)\n##  glue                 1.8.0      2024-09-30 [1] CRAN (R 4.3.3)\n##  gmm                  1.9-1      2025-08-26 [1] CRAN (R 4.3.0)\n##  gower                1.0.2      2024-12-17 [1] CRAN (R 4.3.3)\n##  gridExtra            2.3        2017-09-09 [1] CRAN (R 4.3.3)\n##  gridGraphics         0.5-1      2020-12-13 [1] CRAN (R 4.3.3)\n##  gtable               0.3.6      2024-10-25 [1] CRAN (R 4.3.3)\n##  hardhat              1.4.2      2025-08-20 [1] CRAN (R 4.3.0)\n##  hdf5r              * 1.3.12     2025-01-20 [1] CRAN (R 4.3.3)\n##  hexbin               1.28.5     2024-11-13 [1] CRAN (R 4.3.3)\n##  hms                  1.1.3      2023-03-21 [1] CRAN (R 4.3.0)\n##  htmltools          * 0.5.8.1    2024-04-04 [1] CRAN (R 4.3.3)\n##  htmlwidgets          1.6.4      2023-12-06 [1] CRAN (R 4.3.1)\n##  httpuv               1.6.16     2025-04-16 [1] CRAN (R 4.3.3)\n##  httr               * 1.4.7      2023-08-15 [1] CRAN (R 4.3.0)\n##  httr2              * 1.2.1      2025-07-22 [1] CRAN (R 4.3.0)\n##  hypergeo             1.2-14     2025-03-24 [1] CRAN (R 4.3.3)\n##  interp               1.1-6      2024-01-26 [1] CRAN (R 4.3.3)\n##  ipred                0.9-15     2024-07-18 [1] CRAN (R 4.3.3)\n##  iterators            1.0.14     2022-02-05 [1] CRAN (R 4.3.3)\n##  jpeg                 0.1-11     2025-03-21 [1] CRAN (R 4.3.3)\n##  jquerylib            0.1.4      2021-04-26 [1] CRAN (R 4.3.3)\n##  jsonlite           * 2.0.0      2025-03-27 [1] CRAN (R 4.3.3)\n##  KernSmooth           2.23-26    2025-01-01 [1] CRAN (R 4.3.3)\n##  knitr                1.50       2025-03-16 [1] CRAN (R 4.3.3)\n##  kohonen            * 3.0.12     2023-06-09 [1] CRAN (R 4.3.3)\n##  later                1.4.4      2025-08-27 [1] CRAN (R 4.3.0)\n##  lattice            * 0.22-7     2025-04-02 [1] CRAN (R 4.3.3)\n##  latticeExtra         0.6-30     2022-07-04 [1] CRAN (R 4.3.3)\n##  lava                 1.8.1      2025-01-12 [1] CRAN (R 4.3.3)\n##  lazyeval             0.2.2      2019-03-15 [1] CRAN (R 4.3.3)\n##  leafem             * 0.2.5      2025-08-28 [1] CRAN (R 4.3.0)\n##  leafgl             * 0.2.2      2024-11-13 [1] CRAN (R 4.3.3)\n##  leaflegend           1.2.1      2024-05-09 [1] CRAN (R 4.3.3)\n##  leaflet            * 2.2.2      2024-03-26 [1] CRAN (R 4.3.1)\n##  leaflet.providers    2.0.0      2023-10-17 [1] CRAN (R 4.3.3)\n##  leafpop              0.1.0      2021-05-22 [1] CRAN (R 4.3.0)\n##  leafsync             0.1.0      2019-03-05 [1] CRAN (R 4.3.0)\n##  libgeos            * 3.11.1-3   2025-03-19 [1] CRAN (R 4.3.3)\n##  lifecycle            1.0.4      2023-11-07 [1] CRAN (R 4.3.3)\n##  listenv              0.9.1      2024-01-29 [1] CRAN (R 4.3.3)\n##  logger               0.4.0      2024-10-22 [1] CRAN (R 4.3.3)\n##  lubridate          * 1.9.4      2024-12-08 [1] CRAN (R 4.3.3)\n##  luz                * 0.5.0      2025-07-29 [1] CRAN (R 4.3.0)\n##  lwgeom             * 0.2-14     2024-02-21 [1] CRAN (R 4.3.1)\n##  magrittr             2.0.4      2025-09-12 [1] CRAN (R 4.3.0)\n##  mapedit            * 0.7.0      2025-04-20 [1] CRAN (R 4.3.3)\n##  maptiles           * 0.10.0     2025-05-07 [1] CRAN (R 4.3.3)\n##  mapview            * 2.11.2     2023-10-13 [1] CRAN (R 4.3.1)\n##  MASS                 7.3-60.0.1 2024-01-13 [1] CRAN (R 4.3.1)\n##  Matrix               1.6-5      2024-01-11 [1] CRAN (R 4.3.1)\n##  matrixcalc           1.0-6      2022-09-14 [1] CRAN (R 4.3.3)\n##  MCMCglmm             2.36       2024-05-06 [1] CRAN (R 4.3.1)\n##  memoise              2.0.1      2021-11-26 [1] CRAN (R 4.3.3)\n##  mgcv               * 1.9-3      2025-04-04 [1] CRAN (R 4.3.0)\n##  microbenchmark       1.5.0      2024-09-04 [1] CRAN (R 4.3.3)\n##  mime                 0.13       2025-03-17 [1] CRAN (R 4.3.3)\n##  miniUI               0.1.2      2025-04-17 [1] CRAN (R 4.3.3)\n##  ModelMetrics         1.2.2.2    2020-03-17 [1] CRAN (R 4.3.3)\n##  modeltools           0.2-24     2025-05-02 [1] CRAN (R 4.3.3)\n##  MomTrunc             6.1        2024-10-28 [1] CRAN (R 4.3.3)\n##  mvtnorm              1.3-3      2025-01-10 [1] CRAN (R 4.3.3)\n##  ncdf4              * 1.24       2025-03-25 [1] CRAN (R 4.3.3)\n##  nlme               * 3.1-168    2025-03-31 [1] CRAN (R 4.3.3)\n##  nnet               * 7.3-20     2025-01-01 [1] CRAN (R 4.3.3)\n##  openxlsx           * 4.2.8      2025-01-25 [1] CRAN (R 4.3.3)\n##  parallelly           1.45.1     2025-07-24 [1] CRAN (R 4.3.0)\n##  pillar               1.11.0     2025-07-04 [1] CRAN (R 4.3.3)\n##  pkgbuild             1.4.8      2025-05-26 [1] CRAN (R 4.3.3)\n##  pkgconfig            2.0.3      2019-09-22 [1] CRAN (R 4.3.3)\n##  pkgload              1.4.0      2024-06-28 [1] CRAN (R 4.3.3)\n##  plotly             * 4.11.0     2025-06-19 [1] CRAN (R 4.3.3)\n##  plyr                 1.8.9      2023-10-02 [1] CRAN (R 4.3.3)\n##  png                  0.1-8      2022-11-29 [1] CRAN (R 4.3.3)\n##  prettyunits          1.2.0      2023-09-24 [1] CRAN (R 4.3.3)\n##  pROC                 1.19.0.1   2025-07-31 [1] CRAN (R 4.3.0)\n##  processx             3.8.6      2025-02-21 [1] CRAN (R 4.3.3)\n##  prodlim              2025.04.28 2025-04-28 [1] CRAN (R 4.3.3)\n##  profvis              0.4.0      2024-09-20 [1] CRAN (R 4.3.3)\n##  progress             1.2.3      2023-12-06 [1] CRAN (R 4.3.1)\n##  progressr            0.15.1     2024-11-22 [1] CRAN (R 4.3.3)\n##  PROJ               * 0.6.0      2025-04-03 [1] CRAN (R 4.3.3)\n##  proj4              * 1.0-15     2025-03-21 [1] CRAN (R 4.3.3)\n##  promises             1.3.3      2025-05-29 [1] CRAN (R 4.3.3)\n##  proxy              * 0.4-27     2022-06-09 [1] CRAN (R 4.3.3)\n##  ps                   1.9.1      2025-04-12 [1] CRAN (R 4.3.3)\n##  purrr              * 1.1.0      2025-07-10 [1] CRAN (R 4.3.0)\n##  R6                   2.6.1      2025-02-15 [1] CRAN (R 4.3.3)\n##  randomForest       * 4.7-1.2    2024-09-22 [1] CRAN (R 4.3.3)\n##  rappdirs             0.3.3      2021-01-31 [1] CRAN (R 4.3.3)\n##  raster             * 3.6-32     2025-03-28 [1] CRAN (R 4.3.3)\n##  rasterVis          * 0.51.6     2023-11-01 [1] CRAN (R 4.3.3)\n##  rayshader          * 0.37.3     2024-02-21 [1] CRAN (R 4.3.1)\n##  rbibutils            2.3        2024-10-04 [1] CRAN (R 4.3.3)\n##  RColorBrewer       * 1.1-3      2022-04-03 [1] CRAN (R 4.3.3)\n##  Rcpp               * 1.1.0      2025-07-02 [1] CRAN (R 4.3.3)\n##  RcppArmadillo      * 14.6.0-1   2025-07-02 [1] CRAN (R 4.3.3)\n##  RcppCensSpatial    * 0.3.0      2022-06-27 [1] CRAN (R 4.3.0)\n##  RcppEigen          * 0.3.4.0.2  2024-08-24 [1] CRAN (R 4.3.3)\n##  RcppParallel       * 5.1.11-1   2025-08-27 [1] CRAN (R 4.3.0)\n##  RCurl                1.98-1.17  2025-03-22 [1] CRAN (R 4.3.3)\n##  Rdpack               2.6.4      2025-04-09 [1] CRAN (R 4.3.3)\n##  reactable          * 0.4.4      2023-03-12 [1] CRAN (R 4.3.0)\n##  readr              * 2.1.5      2024-01-10 [1] CRAN (R 4.3.1)\n##  recipes              1.3.1      2025-05-21 [1] CRAN (R 4.3.3)\n##  relliptical          1.3.0      2024-02-07 [1] CRAN (R 4.3.1)\n##  remotes              2.5.0      2024-03-17 [1] CRAN (R 4.3.3)\n##  reproj             * 0.7.0      2024-06-11 [1] CRAN (R 4.3.3)\n##  reshape2             1.4.4      2020-04-09 [1] CRAN (R 4.3.0)\n##  rex                  1.2.1      2021-11-26 [1] CRAN (R 4.3.3)\n##  rgl                * 1.3.24     2025-06-25 [1] CRAN (R 4.3.3)\n##  rlang                1.1.6      2025-04-11 [1] CRAN (R 4.3.3)\n##  rmarkdown            2.29       2024-11-04 [1] CRAN (R 4.3.3)\n##  rpart                4.1.24     2025-01-07 [1] CRAN (R 4.3.3)\n##  rsconnect          * 1.5.1      2025-08-28 [1] CRAN (R 4.3.0)\n##  RSpectra             0.16-2     2024-07-18 [1] CRAN (R 4.3.3)\n##  rstatix              0.7.2      2023-02-01 [1] CRAN (R 4.3.0)\n##  RStoolbox          * 1.0.2.1    2025-02-03 [1] CRAN (R 4.3.3)\n##  rstudioapi           0.17.1     2024-10-22 [1] CRAN (R 4.3.3)\n##  rts                * 1.1-14     2023-10-01 [1] CRAN (R 4.3.3)\n##  Rttf2pt1             1.3.12     2023-01-22 [1] CRAN (R 4.3.3)\n##  Ryacas0              0.4.4      2023-01-12 [1] CRAN (R 4.3.3)\n##  s2                 * 1.1.9      2025-05-23 [1] CRAN (R 4.3.3)\n##  sandwich             3.1-1      2024-09-15 [1] CRAN (R 4.3.3)\n##  sass                 0.4.10     2025-04-11 [1] CRAN (R 4.3.3)\n##  satellite            1.0.6      2025-08-21 [1] CRAN (R 4.3.0)\n##  scales             * 1.4.0      2025-04-24 [1] CRAN (R 4.3.3)\n##  sessioninfo          1.2.3      2025-02-05 [1] CRAN (R 4.3.3)\n##  settings             0.2.7      2021-05-07 [1] CRAN (R 4.3.3)\n##  sf                 * 1.0-22     2025-08-25 [1] Github (r-spatial/sf@3660edf)\n##  shiny                1.11.1     2025-07-03 [1] CRAN (R 4.3.3)\n##  shinyjs              2.1.0      2021-12-23 [1] CRAN (R 4.3.0)\n##  shinyWidgets         0.9.0      2025-02-21 [1] CRAN (R 4.3.3)\n##  sits               * 1.5.2      2025-02-12 [1] CRAN (R 4.3.3)\n##  sp                 * 2.2-0      2025-02-01 [1] CRAN (R 4.3.3)\n##  spacesXYZ            1.6-0      2025-06-06 [1] CRAN (R 4.3.3)\n##  spData             * 2.3.4      2025-01-08 [1] CRAN (R 4.3.3)\n##  spdep              * 1.4-1      2025-08-31 [1] CRAN (R 4.3.0)\n##  stars              * 0.6-8      2025-02-01 [1] CRAN (R 4.3.3)\n##  StempCens            1.2.0      2025-06-11 [1] CRAN (R 4.3.3)\n##  stringi              1.8.7      2025-03-27 [1] CRAN (R 4.3.3)\n##  stringr            * 1.5.2      2025-09-08 [1] CRAN (R 4.3.0)\n##  supercells         * 1.0.0      2024-02-11 [1] CRAN (R 4.3.1)\n##  survival             3.8-3      2024-12-17 [1] CRAN (R 4.3.3)\n##  svglite              2.2.1      2025-05-12 [1] CRAN (R 4.3.3)\n##  systemfonts          1.2.3      2025-04-30 [1] CRAN (R 4.3.3)\n##  tensorA              0.36.2.1   2023-12-13 [1] CRAN (R 4.3.3)\n##  terra              * 1.8-60     2025-07-21 [1] CRAN (R 4.3.0)\n##  terrainr           * 0.7.6      2025-07-25 [1] CRAN (R 4.3.0)\n##  testthat           * 3.2.3      2025-01-13 [1] CRAN (R 4.3.3)\n##  textshaping          1.0.3      2025-09-02 [1] CRAN (R 4.3.0)\n##  tibble             * 3.3.0      2025-06-08 [1] CRAN (R 4.3.3)\n##  tidyr              * 1.3.1      2024-01-24 [1] CRAN (R 4.3.1)\n##  tidyselect           1.2.1      2024-03-11 [1] CRAN (R 4.3.1)\n##  tidyterra          * 0.7.2      2025-04-14 [1] CRAN (R 4.3.3)\n##  tidyverse          * 2.0.0      2023-02-22 [1] CRAN (R 4.3.0)\n##  timechange           0.3.0      2024-01-18 [1] CRAN (R 4.3.3)\n##  timeDate             4041.110   2024-09-22 [1] CRAN (R 4.3.3)\n##  tlrmvnmvt            1.1.2      2022-06-09 [1] CRAN (R 4.3.3)\n##  tmap               * 4.1        2025-05-12 [1] CRAN (R 4.3.3)\n##  tmaptools          * 3.2        2025-01-13 [1] CRAN (R 4.3.3)\n##  tmvtnorm             1.6        2023-12-05 [1] CRAN (R 4.3.3)\n##  torch                0.16.0     2025-08-21 [1] CRAN (R 4.3.0)\n##  tzdb                 0.5.0      2025-03-15 [1] CRAN (R 4.3.3)\n##  unifir               0.2.4      2024-02-01 [1] CRAN (R 4.3.3)\n##  units                0.8-7      2025-03-11 [1] CRAN (R 4.3.3)\n##  urlchecker           1.0.1      2021-11-30 [1] CRAN (R 4.3.3)\n##  usethis              3.1.0      2024-11-26 [1] CRAN (R 4.3.3)\n##  uuid                 1.2-1      2024-07-29 [1] CRAN (R 4.3.3)\n##  vctrs                0.6.5      2023-12-01 [1] CRAN (R 4.3.3)\n##  viridis              0.6.5      2024-01-29 [1] CRAN (R 4.3.1)\n##  viridisLite          0.4.2      2023-05-02 [1] CRAN (R 4.3.3)\n##  visNetwork           2.1.2      2022-09-29 [1] CRAN (R 4.3.0)\n##  withr                3.0.2      2024-10-28 [1] CRAN (R 4.3.3)\n##  wk                   0.9.4      2024-10-11 [1] CRAN (R 4.3.3)\n##  xfun                 0.53       2025-08-19 [1] CRAN (R 4.3.0)\n##  xgboost            * 1.7.11.1   2025-05-15 [1] CRAN (R 4.3.3)\n##  XML                  3.99-0.18  2025-01-01 [1] CRAN (R 4.3.3)\n##  xml2                 1.4.0      2025-08-20 [1] CRAN (R 4.3.0)\n##  xtable               1.8-4      2019-04-21 [1] CRAN (R 4.3.3)\n##  xts                * 0.14.1     2024-10-15 [1] CRAN (R 4.3.3)\n##  yaml                 2.3.10     2024-07-26 [1] CRAN (R 4.3.3)\n##  yulab.utils          0.2.1      2025-08-19 [1] CRAN (R 4.3.0)\n##  zeallot              0.2.0      2025-05-27 [1] CRAN (R 4.3.3)\n##  zip                  2.3.3      2025-05-13 [1] CRAN (R 4.3.3)\n##  zoo                * 1.8-14     2025-04-10 [1] CRAN (R 4.3.3)\n## \n##  [1] /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/library\n##  * ── Packages attached to the search path.\n## \n## ──────────────────────────────────────────────────────────",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Demography</span>"
    ]
  },
  {
    "objectID": "references/index.html",
    "href": "references/index.html",
    "title": "Appendix A — References",
    "section": "",
    "text": "Barnes, R. (2016). RichDEM: Terrain analysis software. http://github.com/r-barnes/richdem\n\n\nBarnes, R., Lehman, C., & Mulla, D. (2014). Priority-flood: An\noptimal depression-filling and watershed-labeling algorithm for digital\nelevation models. Computers & Geosciences, 62,\n117–127.\n\n\ncontributors, G. (2020). GDAL/OGR geospatial data abstraction\nsoftware library. Open Source Geospatial Foundation. https://gdal.org\n\n\nHasan, M. M., Ullah, M. S., Saha, A. K., & Amin, M. M. (2021).\nComparing the performances of multiple rainfall-runoff models of a karst\nwatershed. Asian-Australasian Journal of Bioscience and\nBiotechnology, 6(1), 26–39.\n\n\nHijmans, R. J. (2025). Terra: Spatial data analysis. https://CRAN.R-project.org/package=terra\n\n\nHollister, J., Shah, T., Nowosad, J., Robitaille, A. L., Beck, M. W.,\n& Johnson, M. (2023). Elevatr: Access elevation data from\nvarious APIs. https://doi.org/10.5281/zenodo.8335450\n\n\nLehner, B., Messager, M. L., Korver, M. C., & Linke, S. (2022).\nGlobal hydro-environmental lake characteristics at high spatial\nresolution. Scientific Data, 9(1), 351.\n\n\nLi, Y., Huang, C., Wang, N., Chen, Y., Zhang, S., & Duan, H. (2025).\nEnhanced understanding of hydrological connectivity among lakes on the\nqiangtang plateau. International Journal of Digital Earth,\n18(1), 2450845.\n\n\nLindsay, J. B. (2016). Efficient hybrid breaching-filling sink removal\nmethods for flow path enforcement in digital elevation models.\nHydrological Processes, 30(6), 846–857.\n\n\nLindsay, J. B., & Creed, I. F. (2005). Removal of artifact\ndepressions from digital elevation models: Towards a minimum impact\napproach. Hydrological Processes: An International Journal,\n19(16), 3113–3126.\n\n\nLindsay, J. B., & Creed, I. F. (2006). Distinguishing actual and\nartefact depressions in digital elevation data. Computers &\nGeosciences, 32(8), 1192–1204.\n\n\nMartinsen, K. T. (2023). Flowdem: Flow routing on digital elevation\nmodels.\n\n\nO’Callaghan, J. F., & Mark, D. M. (1984). The extraction of drainage\nnetworks from digital elevation data. Computer Vision, Graphics, and\nImage Processing, 28(3), 323–344.\n\n\nPebesma, E., & Bivand, R. (2023a). Spatial data\nscience: With applications in r. https://doi.org/10.1201/9780429459016\n\n\nPebesma, E., & Bivand, R. (2023b). Spatial data\nscience: With applications in r. 352. https://doi.org/10.1201/9780429459016\n\n\nStrahler, A. N. (1957). Quantitative analysis of watershed\ngeomorphology. Eos, Transactions American Geophysical Union,\n38(6), 913–920.\n\n\nWang, L., & Liu, H. (2006). An efficient method for identifying and\nfilling surface depressions in digital elevation models for hydrologic\nanalysis and modelling. International Journal of Geographical\nInformation Science, 20(2), 193–213.\n\n\nWu, Q., & Brown, A. (2025). ’Whitebox’: ’WhiteboxTools’ r\nfrontend. https://CRAN.R-project.org/package=whitebox\n\n\nWu, Q., Liu, H., Wang, S., Yu, B., Beck, R., & Hinkel, K. (2015). A\nlocalized contour tree method for deriving geometric and topological\nproperties of complex surface depressions based on high-resolution\ntopographical data. International Journal of Geographical\nInformation Science, 29(12), 2041–2060.\n\n\nZhang, J., Condon, L. E., Tran, H., & Maxwell, R. M. (2020). A\nnational topographic dataset for hydrological modeling over contiguous\nunited states. Earth System Science Data Discussions,\n2020, 1–26.",
    "crumbs": [
      "Appendices",
      "<span class='chapter-number'>A</span>  <span class='chapter-title'>References</span>"
    ]
  }
]